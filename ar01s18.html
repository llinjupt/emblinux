<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>18. &#26102;&#38047;&#31649;&#29702;</title><link rel="stylesheet" href="styles.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="index.html" title="Linux&#20869;&#26680;&#23398;&#20064;&#21644;&#30740;&#31350;&#21450;&#23884;&#20837;&#24335;(ARM)&#23398;&#20064;&#21644;&#30740;&#31350;&#30340;&#24320;&#25918;&#25991;&#26723;"><link rel="up" href="index.html" title="Linux&#20869;&#26680;&#23398;&#20064;&#21644;&#30740;&#31350;&#21450;&#23884;&#20837;&#24335;(ARM)&#23398;&#20064;&#21644;&#30740;&#31350;&#30340;&#24320;&#25918;&#25991;&#26723;"><link rel="prev" href="ar01s17.html" title="17. &#20869;&#26680;&#21442;&#25968;&#35299;&#26512;"><link rel="next" href="ar01s19.html" title="19. &#20869;&#26680;&#36890;&#30693;&#38142;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">18. &#26102;&#38047;&#31649;&#29702;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s17.html">&#19978;&#19968;&#39029;</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s19.html">&#19979;&#19968;&#39029;</a></td></tr></table><hr></div><div class="sect1" title="18. &#26102;&#38047;&#31649;&#29702;"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idp81434876"></a>18. &#26102;&#38047;&#31649;&#29702;</h2></div></div></div>
<div class="sect2" title="18.1. &#22522;&#26412;&#27010;&#24565;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81440668"></a>18.1. &#22522;&#26412;&#27010;&#24565;</h3></div></div></div>
<p>&#39537;&#21160;&#25968;&#23383;&#30005;&#36335;&#36816;&#36716;&#26159;&#30340;&#26102;&#38047;&#20449;&#21495;&#65292;&#23427;&#23601;&#20687;&#20154;&#30340;&#24515;&#33039;&#19968;&#26679;&#65292;&#21482;&#26377;&#26102;&#38047;&#30340;&#36339;&#21160;&#65292;&#26102;&#24207;&#30005;&#36335;&#25165;&#20250;&#34987;&#39537;&#21160;&#65292;&#23436;&#25104;&#35745;&#26102;&#65292;&#21516;&#27493;&#65292;&#35745;&#25968;&#31561;&#65292;&#32780;&#36825;&#20123;&#22522;&#26412;&#30340;&#30005;&#36335;&#36339;&#21464;&#21160;&#20316;&#21448;&#34987;&#36827;&#19968;&#27493;&#32452;&#25104;&#26356;&#20026;&#22797;&#26434;&#30340;&#35745;&#31639;&#30005;&#36335;&#65306;CPU&#12290;ARM CPU&#26680;&#26159;&#29992;&#26102;&#24207;&#20449;&#21495;&#26469;&#39537;&#21160;&#30340;&#65292;&#32780;&#26680;&#24515;&#22806;&#30340;&#22823;&#22810;&#25968;&#23376;&#27169;&#22359;&#65306;&#20869;&#23384;&#25511;&#21046;&#30005;&#36335;&#65292;&#20013;&#26029;&#25511;&#21046;&#22120;&#31561;&#31561;&#21516;&#26679;&#26159;&#30001;&#26102;&#24207;&#20449;&#21495;&#26469;&#39537;&#21160;&#30340;&#65307;&#21478;&#22806;&#22823;&#22810;&#25968;&#30340;&#22806;&#37096;&#35774;&#22791;&#20063;&#38656;&#35201;&#26102;&#24207;&#39537;&#21160;&#65306;&#20869;&#23384;&#65292;&#30913;&#30424;&#25511;&#21046;&#22120;&#31561;&#31561;&#12290;&#21482;&#26159;&#23427;&#20204;&#30340;&#19981;&#21516;&#22312;&#20110;&#26102;&#24207;&#20449;&#21495;&#30340;&#39057;&#29575;&#12290;</p>
<p>
&#22312;S3C6410 &#20013;&#29983;&#25104;&#25152;&#38656;&#30340;&#31995;&#32479;&#26102;&#38047;&#20449;&#21495;&#65292;&#29992;&#20110;CPU &#30340;ARMCLK, AXI/AHB &#24635;&#32447;&#22806;&#35774;&#30340;HCLK&#21644;APB&#24635;&#32447;&#22806;&#35774;&#30340;PCLK&#12290;&#25152;&#20197;&#22312;S3C6410 &#20013;&#26377;&#19977;&#20010;PLL(&#38145;&#30456;&#29615;&#30005;&#36335;)&#12290;&#20026;&#20102;&#36827;&#19968;&#27493;&#20102;&#35299;PLL&#30340;&#21407;&#29702;&#65292;&#20808;&#20174;&#26368;&#21407;&#22987;&#30340;&#26102;&#38047;&#21457;&#29983;&#22120;&#26230;&#25391;&#35828;&#36215;&#12290;
</p>
<div class="sect3" title="18.1.1. &#22806;&#37096;&#26102;&#38047;&#65306;&#26230;&#25391;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81442236"></a>18.1.1. &#22806;&#37096;&#26102;&#38047;&#65306;&#26230;&#25391;</h4></div></div></div>
&#21487;&#20197;&#35828;&#26159;&#26102;&#38047;&#20449;&#21495;&#30340;&#28304;&#22836;&#65292;&#26230;&#25391;&#36825;&#31181;&#22806;&#37096;&#22120;&#20214;&#21487;&#20197;&#20135;&#29983;&#31283;&#23450;&#30340;&#30005;&#27969;&#27874;&#24418;&#12290;&#26230;&#25391;&#26159;&#19968;&#22359;&#29305;&#23450;&#23610;&#23544;&#30340;&#39640;&#32431;&#24230;&#30707;&#33521;&#26230;&#20307;&#21152;&#19968;&#20123;&#30005;&#36335;&#30340;&#23567;&#22120;&#26448;&#65292;&#20294;&#26159;&#23427;&#21482;&#38656;&#35201;&#36755;&#20837;&#24456;&#23567;&#30340;&#30005;&#27969;&#23601;&#33021;&#25345;&#32493;&#36755;&#20986;&#31283;&#23450;&#30340;&#26102;&#38047;&#27874;&#24418;&#12290;&#19979;&#22270;&#20013;&#30340;&#26230;&#25391;&#36755;&#20986;32.768KHz&#30340;&#26102;&#38047;&#20449;&#21495;&#65306;
<div class="figure"><a name="idp81442516"></a><p class="title"><b>&#22270; 96. &#23454;&#26102;&#26102;&#38047;&#30005;&#36335;&#20013;&#30340;&#26230;&#25391;</b></p><div class="figure-contents"><div><img src="images/flap.gif" alt="&#23454;&#26102;&#26102;&#38047;&#30005;&#36335;&#20013;&#30340;&#26230;&#25391;"></div></div></div><br class="figure-break">
&#30707;&#33521;&#26230;&#20307;&#26377;&#19968;&#20010;&#22855;&#29305;&#30340;&#29305;&#24615;&#65292;&#22914;&#26524;&#32473;&#23427;&#26045;&#21152;&#30005;&#21387;&#65292;&#23427;&#23601;&#20250;&#20135;&#29983;&#26426;&#26800;&#25391;&#33633;&#65307;&#21453;&#20043;&#65292;&#22914;&#26524;&#32473;&#23427;&#26426;&#26800;&#21147;&#65292;&#23427;&#21448;&#20250;&#20135;&#29983;&#30005;&#27969;&#65292;&#36825;&#31181;&#29305;&#24615;&#21483;&#21387;&#30005;&#25928;&#24212;&#12290;&#26356;&#22855;&#22937;&#30340;&#26159;&#22914;&#22312;&#26497;&#26495;&#38388;&#25152;&#21152;&#30340;&#26159;&#20132;&#21464;&#30005;&#21387;&#65292;&#23601;&#20250;&#20135;&#29983;&#26426;&#26800;&#21464;&#24418;&#25391;&#21160;&#65292;&#21516;&#26102;&#26426;&#26800;&#21464;&#24418;&#25391;&#21160;&#21448;&#20250;&#20135;&#29983;&#20132;&#21464;&#30005;&#22330;&#12290;&#19968;&#33324;&#26469;&#35828;&#65292;&#36825;&#31181;&#26426;&#26800;&#25391;&#21160;&#30340;&#25391;&#24133;&#26159;&#27604;&#36739;&#23567;&#30340;&#65292;&#20854;&#25391;&#21160;&#39057;&#29575;&#21364;&#26159;&#24456;&#31283;&#23450;&#30340;&#12290;&#24403;&#22806;&#21152;&#20132;&#21464;&#30005;&#21387;&#30340;&#39057;&#29575;&#19982;&#26230;&#29255;&#30340;&#22266;&#26377;&#39057;&#29575;&#65288;&#20915;&#23450;&#20110;&#26230;&#29255;&#30340;&#23610;&#23544;&#65289;&#30456;&#31561;&#26102;&#65292;&#26426;&#26800;&#25391;&#21160;&#30340;&#24133;&#24230;&#23558;&#24613;&#21095;&#22686;&#21152;&#65292;&#36825;&#31181;&#29616;&#35937;&#31216;&#20026;&#21387;&#30005;&#35856;&#25391;&#65292;&#22240;&#27492;&#30707;&#33521;&#26230;&#25391;&#21448;&#31216;&#20026;&#30707;&#33521;&#26230;&#20307;&#35856;&#25391;&#22120;&#12290;&#20854;&#29305;&#28857;&#26159;&#39057;&#29575;&#31283;&#23450;&#24230;&#24456;&#39640;&#12290;&#30707;&#33521;&#38047;&#23601;&#26159;&#20351;&#29992;&#36825;&#20010;&#21407;&#29702;&#21046;&#32780;&#25104;&#12290;
<p>
&#24403;&#26230;&#29255;&#20135;&#29983;&#35856;&#25391;&#65292;&#23601;&#20250;&#20135;&#29983;&#19968;&#20010;&#31283;&#23450;&#30340;&#27874;&#24133;&#26174;&#33879;&#30340;&#27874;&#24418;&#65292;&#21482;&#35201;&#25345;&#32493;&#30340;&#20379;&#30005;&#65292;&#36825;&#31181;&#30005;&#33021;&#21040;&#26426;&#26800;&#33021;&#20877;&#21040;&#30005;&#33021;&#30340;&#36716;&#25442;&#23601;&#20250;&#35753;&#27874;&#24418;&#19981;&#26029;&#29983;&#25104;&#12290;&#22312;&#35201;&#27714;&#24471;&#21040;&#39640;&#31283;&#23450;&#39057;&#29575;&#30340;&#30005;&#36335;&#20013;&#65292;&#24517;&#39035;&#20351;&#29992;&#30707;&#33521;&#26230;&#20307;&#25391;&#33633;&#30005;&#36335;&#12290;&#30707;&#33521;&#26230;&#20307;&#20855;&#26377;&#39640;&#21697;&#36136;&#22240;&#25968;&#65292;&#25391;&#33633;&#30005;&#36335;&#37319;&#29992;&#20102;&#24658;&#28201;&#12289; &#21387;&#31561;&#26041;&#24335;&#20197;&#21518;&#65292;&#25391;&#33633;&#39057;&#29575;&#31283;&#23450;&#24230;&#21487;&#20197;&#36798;&#21040; 10^(-9)&#33267;10^(-11)&#12290;&#21487;&#34987;&#24191;&#27867;&#24212;&#29992;&#22312;&#36890;&#35759;&#12289;&#26102;&#38047;&#12289;&#25163;&#34920;&#12289;&#35745;&#31639;&#26426;&#38656;&#35201;&#39640;&#31283;&#23450;&#20449;&#21495;&#30340;&#22330;&#21512;&#12290;
</p>
<p>
&#26230;&#25391;&#22312;&#25968;&#23383;&#30005;&#36335;&#30340;&#20316;&#29992;&#23601;&#26159;&#25552;&#20379;&#19968;&#20010;&#22522;&#20934;&#26102;&#38388;&#65292;&#25110;&#32773;&#26159;&#22522;&#26412;&#26102;&#24207;&#20449;&#21495;&#12290;&#25968;&#23383;&#30005;&#36335;&#37117;&#26159;&#25353;&#26102;&#24207;&#30340;&#36827;&#34892;&#24037;&#20316;&#30340;&#65292;&#22312;&#26576;&#20010;&#26102;&#21051;&#19987;&#38376;&#23436;&#25104;&#29305;&#23450;&#30340;&#20219;&#21153;,&#22240;&#27492;&#20960;&#20046;&#27599;&#20010;&#30005;&#36335;&#37117;&#26377;&#20250;&#25509;&#25910;&#22806;&#37096;&#26102;&#38047;&#20449;&#21495;&#30340;&#31649;&#33050;&#65292;&#20063;&#21363;&#30005;&#36335;&#20043;&#38388;&#30340;&#22788;&#29702;&#38656;&#35201;&#21516;&#27493;&#30340;&#26102;&#24207;&#12290;&#22914;&#26524;&#36825;&#20010;&#26102;&#24207;&#20449;&#21495;&#21457;&#29983;&#28151;&#20081;&#65292;&#25972;&#20010;&#30005;&#36335;&#23601;&#24037;&#20316;&#19981;&#27491;&#24120;&#20102;&#12290; &#22312;&#19968;&#20010;&#25972;&#20307;&#35774;&#22791;&#37324;&#65292;&#22914;&#24320;&#21457;&#26495;,&#25110; PC &#20027;&#26495;&#65292;&#25152;&#26377;&#30005;&#36335;&#36890;&#24120;&#20849;&#20139;&#19968;&#20010;&#26230;&#25391;&#65292;&#20415;&#20110;&#21508;&#37096;&#20998;&#20445;&#25345;&#21516;&#27493;&#12290;&#26377;&#20123;&#36890;&#35759;&#31995;&#32479;&#30340;&#22522;&#39057;&#21644;&#23556;&#39057;&#20351;&#29992;&#19981;&#21516;&#30340;&#26230;&#25391;&#65292;&#32780;&#36890;&#36807;&#30005;&#23376;&#35843;&#25972;&#39057;&#29575;&#30340;&#26041;&#27861;&#20445;&#25345;&#21516;&#27493;&#12290;
</p>
</div>
<div class="sect3" title="18.1.2. &#20869;&#37096;&#26102;&#38047;&#65306;&#31995;&#32479;&#20027;&#39057;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81445836"></a>18.1.2. &#20869;&#37096;&#26102;&#38047;&#65306;&#31995;&#32479;&#20027;&#39057;</h4></div></div></div>
<p>
&#19968;&#33324;&#26230;&#25391;&#31216;&#20026;&#22806;&#37096;&#26102;&#38047;&#65292;&#23427;&#38656;&#35201;&#25226;&#20449;&#21495;&#24341;&#20837;&#25968;&#23383;&#30005;&#36335;&#32473;CPU&#21644;&#20854;&#23427;&#27169;&#22359;&#20351;&#29992;&#65292;&#23616;&#38480;&#20110;&#26448;&#26009;&#30340;&#29289;&#29702;&#29305;&#24615;&#19968;&#33324;&#30340;&#26230;&#25391;&#30340;&#39057;&#29575;&#24182;&#19981;&#26159;&#22826;&#39640;&#65292;&#22914;S3C2440/S3C6410&#19978;&#30340;&#26230;&#25391;&#30340;&#39057;&#29575;&#19968;&#33324;&#26159;12MHz/20MHz&#65292;&#32780;&#23545;&#30340;&#24212;&#30340;CPU&#38656;&#35201;&#20351;&#29992;&#30340;&#26102;&#38047;&#20449;&#21495;&#39640;&#36798;400MHz/600MHz&#65292;&#25110;&#32773;&#26356;&#39640;&#12290;&#27492;&#26102;&#65292;&#38656;&#35201;&#25226;&#36739;&#20302;&#30340;&#22806;&#37096;&#26102;&#38047;&#20449;&#21495;&#22686;&#21152;&#39057;&#29575;&#21040;CPU&#21487;&#20197;&#25509;&#21463;&#30340;&#39057;&#29575;&#12290;&#36825;&#31216;&#20026;<span class="emphasis"><em>&#20493;&#39057;</em></span>&#12290;S3C6410&#30340;&#20027;&#39057;&#26368;&#39640;&#21487;&#21040;667Mhz.
</p>
<p>
&#20493;&#39057;&#30340;&#21151;&#33021;&#26159;&#30001;&#19968;&#31181;&#29305;&#27530;&#30005;&#36335;&#8212;&#8212;&#38145;&#30456;&#29615;&#30005;&#36335;&#26469;&#23436;&#25104;&#30340;&#12290; PLL&#38145;&#30456;&#29615;&#30005;&#36335;(Phase-Locked Loop)&#22522;&#26412;&#19978;&#26159;&#19968;&#20010;&#38381;&#29615;&#30340;&#21453;&#39304;&#25511;&#21046;&#31995;&#32479;&#65292;&#23427;&#21487;&#20197;&#20351;PLL &#30340;&#36755;&#20986;&#19982;&#19968;&#20010;&#21442;&#32771;&#20449;&#21495;&#20445;&#25345;&#22266;&#23450;&#30340;&#30456;&#20301;&#20851;&#31995;&#12290;PLL&#22312;&#30005;&#36335;&#20013;&#30340;&#20316;&#29992;&#20043;&#19968;&#26159;&#36215;&#21040;&#20493;&#39057;&#30340;&#20316;&#29992;&#65306;&#21363;&#21487;&#20197;&#36755;&#20986;&#31995;&#32479;&#26102;&#38047;&#30340;&#22266;&#23450;&#20493;&#25968;&#39057;&#29575;&#12290;&#25152;&#20197;&#36825;&#37324;&#23427;&#36215;&#21040;&#20493;&#39057;&#22120;&#30340;&#20316;&#29992;&#12290;
</p>
<p>
&#22240;&#20026;&#22312;ARM   CPU&#21551;&#21160;&#21518;&#65292;&#26368;&#24320;&#22987;&#24517;&#39035;&#20570;&#30340;&#20107;&#24773;&#26159;&#37197;&#32622;&#20493;&#39057;&#30340;&#27604;&#29575;&#12290;&#36825;&#26679;&#24403;&#22806;&#37096;&#26102;&#38047;&#39057;&#29575;&#19968;&#23450;&#30340;&#24773;&#20917;&#19979;&#65292;&#25353;&#29031;&#20493;&#39057;&#30340;&#27604;&#20363;,&#23601;&#21487;&#20197;&#24471;&#21040;CPU&#30340;&#39057;&#29575;&#65292;&#19968;&#20010;&#31995;&#32479;&#20986;&#20110;&#19981;&#21516;&#30446;&#30340;&#21487;&#33021;&#20250;&#20197;&#19981;&#21516;&#39057;&#29575;&#36816;&#34892;&#65292;&#20302;&#39057;&#36816;&#31639;&#36895;&#24230;&#24930;&#20294;&#26159;&#30465;&#30005;&#65292;&#39640;&#39057;&#36895;&#24230;&#24555;&#20294;&#33021;&#32791;&#22823;&#12290;&#25152;&#20197;&#21487;&#20197;&#35843;&#33410;&#20493;&#39057;&#22120;&#30340;&#20493;&#25968;&#26469;&#35843;&#33410;CPU&#30340;&#24037;&#20316;&#39057;&#29575;&#12290;&#20294;&#26159;CPU&#26412;&#36523;&#26159;&#26377;&#19968;&#20010;&#26368;&#39640;&#21487;&#20197;&#25903;&#25345;&#30340;&#39057;&#29575;&#65292;&#22914;&#26524;&#24378;&#34892;&#37197;&#32622;&#25104;&#39640;&#20110;&#35813;&#39057;&#29575;&#30340;&#36895;&#24230;&#36816;&#34892;&#65292;&#23601;&#26159;&#20154;&#20204;&#31216;&#30340;&#36229;&#39057;&#12290;&#26377;&#21487;&#33021;&#24102;&#21152;&#36895;CPU&#32769;&#21270;&#65292;&#36816;&#34892;&#26102;&#25955;&#28909;&#22686;&#21152;&#30340;&#38382;&#39064;&#12290;&#23545;&#20110;S3C6410&#26469;&#35828;&#65292;&#36825;&#20010;&#39057;&#29575;&#23601;&#26159;ARMCLK&#12290;
</p>
</div>
<div class="sect3" title="18.1.3. &#35774;&#22791;&#39057;&#29575;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81447900"></a>18.1.3. &#35774;&#22791;&#39057;&#29575;</h4></div></div></div>
<p>
&#22312;SOC&#30340;CPU&#19978;&#65292;&#38500;&#20102;CPU&#20869;&#26680;&#20197;&#22806;&#65292;&#22312;&#19968;&#20010;&#29289;&#29702;&#33455;&#29255;&#19978;,&#36824;&#26377;&#19968;&#20123;&#20854;&#23427;&#27169;&#22359;&#12290;&#20197;S3C6410&#20026;&#20363;,&#23427;&#24102;&#20102;I2C,UART,USB HOST&#31561;&#22810;&#20010;&#27169;&#22359;&#65292;&#36825;&#19968;&#20123;&#27169;&#22359;&#36890;&#36807;AHB&#24635;&#32447;&#19982;CPU&#20869;&#26680;&#30456;&#36830;&#12290;&#23427;&#20204;&#21516;&#26679;&#38656;&#35201;&#26102;&#38047;&#20449;&#21495;&#26469;&#39537;&#21160;&#12290;&#20294;&#26159;ARM&#30340;&#20027;&#39057;&#20449;&#21495;ARMCLK&#30456;&#23545;&#36825;&#19968;&#20123;&#27169;&#22359;&#26469;&#35828;&#65292;&#26174;&#24471;&#36807;&#39640;&#12290;&#36825;&#20010;&#26102;&#20505;CPU&#20869;&#26680;&#20250;&#25552;&#20379;&#20004;&#31181;&#36739;&#20302;&#39057;&#29575;&#30340;&#26102;&#38047;&#20449;&#21495;&#65306;HCLK&#21644;PCLK&#20004;&#31181;&#26102;&#38047;&#20449;&#21495;&#32473;&#35774;&#22791;&#20351;&#29992;&#12290;
</p>
<p>
&#20294;&#26159;&#23545;&#19968;&#20123;&#20302;&#39057;&#27169;&#22359;&#65292;PCLK&#30340;&#39057;&#29575;&#20173;&#28982;&#26174;&#24471;&#36807;&#39640;&#65292;&#36825;&#26102;&#38656;&#35201;&#27169;&#22359;&#33258;&#24049;&#20351;&#29992;<span class="emphasis"><em>&#20998;&#39057;&#22120;</em></span>(divider)&#26469;&#25226;&#39057;&#29575;&#36827;&#19968;&#27493;&#38477;&#20302;&#12290;&#38477;&#21040;&#22810;&#23569;&#20540;&#19968;&#33324;&#21462;&#20915;&#20110;&#36719;&#20214;&#30340;&#38656;&#27714;&#65292;&#22240;&#27492;&#21508;&#20010;&#27169;&#22359;&#30340;&#20998;&#39057;&#21442;&#25968;&#19968;&#33324;&#37117;&#26159;&#21487;&#20197;&#35843;&#25972;&#30340;&#12290;&#22240;&#27492;&#21021;&#22987;&#21270;&#30456;&#20851;&#27169;&#22359;&#26102;&#65292;&#36719;&#20214;&#20570;&#19968;&#20214;&#37325;&#35201;&#20107;&#20214;&#23601;&#26159;&#35774;&#32622;&#20998;&#39057;&#21442;&#25968;&#12290;
</p>
<p>
 &#22312;&#26377;&#19968;&#20123;&#27169;&#22359;&#65292;&#22914;&#26524;&#38656;&#35201;&#32534;&#31243;&#26469;&#35774;&#23450;&#20998;&#39057;&#30340;&#27604;&#29575;&#65292;&#36890;&#24120;&#26159;&#29992;Prescaler&#21363;&#39044;&#20998;&#39057;&#22240;&#23376;&#36825;&#20010;&#21442;&#25968;&#26469;&#35774;&#23450;&#20998;&#39057;&#21518;&#30340;&#20540;&#65292;&#20551;&#35774;&#36755;&#20837;&#39057;&#29575;&#26159;Fin,&#20998;&#39057;&#21518;&#36755;&#20986;&#30340;&#39057;&#29575;&#26159;Fout, &#32780;&#19977;&#32773;&#26377;&#22914;&#19979;&#20851;&#31995;
</p><pre class="programlisting">
Fout = Fin /(Prescaler + 1 )
</pre><p>	
&#22312;&#26576;&#19968;&#20123;&#27169;&#22359;&#37324;&#65292;&#20998;&#39057;&#21518;&#30340;&#39057;&#29575;&#20173;&#28982;&#26159;&#22826;&#39640;&#65292;&#21487;&#33021;&#38656;&#35201;&#20877;&#27425;&#20998;&#39057;&#65292;&#36825;&#26102;&#20998;&#39057;&#30340;&#21442;&#25968;&#19968;&#33324;&#31216;&#20026;divider value&#12290;&#36825;&#26679;&#20844;&#24335;&#21464;&#25104;
</p><pre class="programlisting">
Fout = Fin /(Prescaler + 1 )/divider 
</pre><p>
&#20493;&#39057;&#21644;&#20998;&#39057;&#30340;&#20851;&#31995;&#23601;&#20687;&#20379;&#30005;&#31995;&#32479;&#65306;&#26230;&#25391;&#23601;&#26159;&#21457;&#30005;&#31449;&#65292;&#23427;&#36890;&#36807;PLL&#20493;&#39057;&#21518;&#21464;&#25104;&#39640;&#21387;&#30005;&#65292;&#32473;CPU&#20256;&#36755;&#20351;&#29992;&#65292;&#32780;&#27169;&#22359;&#21448;&#20351;&#29992;&#20998;&#39057;&#22120;&#25226;&#39640;&#21387;&#30005;&#38477;&#19979;&#26469;&#32473;&#33258;&#24049;&#20351;&#29992;&#12290;
</p>
</div>
</div>
<div class="sect2" title="18.2. S3C6410 PLL"><div class="titlepage"><div><div><h3 class="title"><a name="idp81451940"></a>18.2. S3C6410 PLL</h3></div></div></div>
<p>S3C6410&#25552;&#20379;&#19977;&#31181;PLL:APLL(ARM PLL)&#65292;MPLL(Main PLL)&#21644;EPLL(Extra PLL)&#12290;&#23427;&#20204;&#25552;&#39640;&#19981;&#21516;&#20493;&#25968;&#26469;&#32473;&#19981;&#21516;&#27169;&#22359;&#26469;&#20351;&#29992;&#12290;&#29702;&#35770;&#19978;PLL&#21487;&#20197;&#20493;&#39057;&#21040;1.6GHz.
</p><div class="figure"><a name="pll"></a><p class="title"><b>&#22270; 97. &#20174;PLL &#36755;&#20986;&#26102;&#38047;&#21457;&#29983;&#22120;</b></p><div class="figure-contents"><div><img src="images/time_pll.gif" alt="&#20174;PLL &#36755;&#20986;&#26102;&#38047;&#21457;&#29983;&#22120;"></div></div></div><p><br class="figure-break">
S3C6410&#30340;&#26102;&#38047;&#28304;&#21487;&#20197;&#20351;&#29992;&#22806;&#37096;&#26230;&#25391;&#65288;XXTIpll&#65289;&#65292;&#20063;&#21487;&#20197;&#20351;&#29992;&#22806;&#37096;&#26102;&#38047;&#65288;XEXTCLK&#65289;&#20004;&#31181;&#26041;&#24335;&#36755;&#20837;&#26102;&#38047;&#20449;&#21495;&#12290;&#23427;&#30001;&#36339;&#32447;OM[0]&#20915;&#23450;&#65292;&#36825;&#19968;&#20301;&#20026;0&#65292;&#36873;&#25321;XXTIpll&#65292;&#21542;&#21017;&#36873;&#25321;XEXTCLK&#12290;&#36890;&#24120;&#20250;&#36873;&#25321;&#22806;&#37096;&#26230;&#25391;&#12290;
</p>
<p>
S3C6410&#30340;&#19977;&#20010;PLL&#65306;
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">APLL &#29992;&#20110;ARM CPU&#26680;&#24515;&#26102;&#38047;&#65292;&#20063;&#21363;&#24120;&#35828;&#30340;CPU&#20027;&#39057;&#12290;</li><li class="listitem">MPLL &#20135;&#29983;&#20027;&#31995;&#32479;&#26102;&#38047;&#65292;&#29992;&#20110;&#25805;&#20316;AXI&#65292;AHB &#21644;APB &#24635;&#32447;&#25805;&#20316;&#12290;</li><li class="listitem">EPLL &#20135;&#29983;&#30340;&#26102;&#38047;&#20027;&#35201;&#29992;&#20110;&#22806;&#35774;IPs&#65292;&#20363;&#22914;&#65292;UART&#65292;IIS &#21644;IIC &#31561;&#31561;&#12290;</li></ul></div><p>
&#22270;&#20013;&#30340;MUX&#20026;&#25968;&#25454;&#36873;&#25321;&#22120;&#65288;Multiplexer&#65289;&#65292;&#25351;&#20174;&#22810;&#36335;&#36755;&#20837;&#20449;&#21495;&#20013;&#26377;&#36873;&#25321;&#24615;&#30340;&#36873;&#20013;&#26576;&#19968;&#36335;&#20449;&#21495;&#36865;&#21040;&#36755;&#20986;&#31471;&#30340;&#32452;&#21512;&#36923;&#36753;&#30005;&#36335;&#12290;&#22270;&#20013;&#22343;&#20026;&#20026;2&#36873;1&#25968;&#25454;&#36873;&#25321;&#22120;&#12290;CLK_SRC &#23492;&#23384;&#22120;&#30340;&#26368;&#20302;&#19977;&#20301;&#36890;&#36807;&#25511;&#21046;&#19977;&#32452;&#36873;&#25321;&#22120;&#26469;&#36873;&#25321;&#26102;&#38047;&#28304;&#12290;&#24403;&#20301;&#20026;0&#26102;&#65292;&#21017;&#36755;&#20837;&#26102;&#38047;&#32469;&#36807;PLL&#30005;&#36335;&#12290;APLL&#30340;&#21407;&#29702;&#22270;&#22914;&#19979;&#25152;&#31034;&#65292;MPLL&#21644;EPLL&#21407;&#29702;&#19982;&#27492;&#31867;&#20284;&#12290;
</p><div class="figure"><a name="idp81455460"></a><p class="title"><b>&#22270; 98. APLL&#21457;&#29983;&#22120;&#21407;&#29702;&#22270;</b></p><div class="figure-contents"><div><img src="images/pll.gif" alt="APLL&#21457;&#29983;&#22120;&#21407;&#29702;&#22270;"></div></div></div><p><br class="figure-break">
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#39044;&#20998;&#39057;&#22120;(Pre-Divider)&#29992;&#26469;&#23545;&#36755;&#20837;&#30340;&#39057;&#29575;Fin&#36827;&#34892;&#39044;&#20808;&#20998;&#39057;&#65292;&#36890;&#24120;&#36825;&#20010;&#36755;&#20837;&#36890;&#36807;&#26230;&#25391;XXTIpll&#26469;&#36755;&#20837;&#12290;</li><li class="listitem">&#30456;&#20301;&#39057;&#29575;&#26816;&#27979;&#22120;(Phase Frequency Detector)&#29992;&#26469;&#26816;&#27979;&#36755;&#20837;&#26102;&#38047;&#20449;&#21495;&#30340;&#30456;&#20301;&#21644;&#39057;&#29575;&#65292;&#23427;&#29992;&#26469;&#25511;&#21046;&#30005;&#33655;&#27893;&#20135;&#29983;&#23545;&#24212;&#30340;&#30005;&#21387;&#12290;</li><li class="listitem">&#30005;&#33655;&#27893;(Cahre Pump)&#29992;&#26469;&#23558;&#36755;&#20837;&#39057;&#29575;&#21644;&#30456;&#20301;&#30340;&#21464;&#21270;&#36716;&#21270;&#20026;&#30005;&#21387;&#30340;&#21464;&#21270;&#12290;</li><li class="listitem">&#21387;&#25511;&#25391;&#33633;&#22120;VOC(Voltage Controlled Oscillator)&#29992;&#26469;&#23454;&#29616;&#30005;&#21387;&#21040;&#39057;&#29575;&#30340;&#36716;&#21270;&#12290;</li><li class="listitem">&#20027;&#20998;&#39057;&#22120;(Main Divider)&#29992;&#26469;&#23558;&#36755;&#20986;&#30340;&#39057;&#29575;&#36827;&#34892;&#20998;&#39057;&#65292;&#24182;&#21453;&#39304;&#21040;&#30456;&#20301;&#39057;&#29575;&#26816;&#27979;&#22120;&#30340;&#36755;&#20837;&#20013;&#65292;&#25152;&#20197;&#23427;&#36215;&#21040;&#20102;&#20493;&#39057;&#30340;&#20316;&#29992;&#12290;</li><li class="listitem">&#23450;&#20301;&#22120;(Scaler)&#23558;VOC&#36755;&#20986;&#30340;&#39057;&#29575;Fvco&#20877;&#27425;&#20998;&#39057;&#21518;&#36755;&#20986;Fout&#12290;</li></ul></div><p>
&#19981;&#21516;&#30340;&#20998;&#39057;&#22120;&#30001;&#19981;&#21516;&#30340;&#23492;&#23384;&#22120;&#25110;&#32773;&#23492;&#23384;&#22120;&#20301;&#26469;&#25511;&#21046;&#20998;&#39057;&#30340;&#38500;&#25968;&#65292;S3C6410&#25552;&#20379;&#20102;34&#20010;&#29305;&#27530;&#21151;&#33021;&#23492;&#23384;&#22120;SFR(Special Functional Register)&#26469;&#25511;&#21046;PLL&#65292;&#26102;&#38047;&#21457;&#29983;&#22120;&#65292;&#30005;&#28304;&#31649;&#29702;&#37096;&#20998;&#21644;&#20854;&#20182;&#31995;&#32479;&#30340;&#21442;&#25968;&#12290;&#23545;&#20110;PLL&#26469;&#35828;&#26377;&#19971;&#20010;&#23492;&#23384;&#22120;&#26469;&#37197;&#32622;&#23427;&#20204;&#65306;
</p><pre class="programlisting">
&#23492;&#23384;&#22120;       &#22320;&#22336;     &#35835;/&#20889;       &#25551;&#36848;                   &#22797;&#20301;&#20540;
APLL_LOCK 0x7E00_F000 &#35835;/&#20889; &#25511;&#21046;PLL &#38145;&#23450;&#26399;APLL&#12290;    0x0000_FFFF
MPLL_LOCK 0x7E00_F004 &#35835;/&#20889; &#25511;&#21046;PLL &#38145;&#23450;&#26399;MPLL&#12290;    0x0000_FFFF
EPLL_LOCK 0x7E00_F008 &#35835;/&#20889; &#25511;&#21046;PLL &#38145;&#23450;&#26399;EPLL&#12290;    0x0000_FFFF
APLL_CON  0x7E00_F00C &#35835;/&#20889; &#25511;&#21046;PLL &#36755;&#20986;&#39057;&#29575; APLL&#12290; 0x0190_0302
MPLL_CON  0x7E00_F00C &#35835;/&#20889; &#25511;&#21046;PLL &#36755;&#20986;&#39057;&#29575; MPLL&#12290; 0x0214_0603
EPLL_CON0 0x7E00_F00C &#35835;/&#20889; &#25511;&#21046;PLL &#36755;&#20986;&#39057;&#29575; EPLL&#12290; 0x0020_0102
EPLL_CON1 0x7E00_F00C &#35835;/&#20889; &#25511;&#21046;PLL &#36755;&#20986;&#39057;&#29575; EPLL&#12290; 0x0000_9111
</pre><p>
&#20174;&#21629;&#21517;&#21487;&#20197;&#24471;&#30693;&#23427;&#20204;&#20998;&#21035;&#23545;&#24212;&#21040;APLL&#65292;MPLL&#21644;EPLL&#12290;&#23545;&#20110;APLL&#21644;MPLL&#65292;PDIV&#65292;MDIV&#21644;SDIV&#21442;&#25968;&#19982;Fin&#21644;Fout&#30340;&#20851;&#31995;&#26377;&#20197;&#19979;&#20844;&#24335;&#30830;&#23450;&#65292;&#32780;&#23545;&#20110;EPLL&#21017;&#36824;&#26377;&#20854;&#20182;&#20998;&#39057;&#22120;&#38656;&#35201;&#37197;&#32622;&#12290;
</p><pre class="programlisting">
Fout = MDIV * Fin / (PDIV * 2SDIV)
&#36825;&#37324;&#65292;&#29992;&#20110;APLL &#21644;MPLL &#30340; MDIV&#65292;PDIV&#65292;SDIV &#24517;&#39035;&#31526;&#21512;&#20197;&#19979;&#26465;&#20214;&#65306;
MDIV: 56 &#8804; MDIV &#8804; 1023
PDIV: 1 &#8804; PDIV &#8804; 63
SDIV: 0 &#8804; SDIV &#8804; 5
FVCO (=MDIV X FIN / PDIV): 1000MHz &#8804; FVCO &#8804; 1600MHz
FOUT: 31.25MHz &#8804; FVCO &#8804; 1600MHz
</pre><p>
APLL&#21644;MPLL&#30340;&#25511;&#21046;&#23492;&#23384;&#22120;&#23545;&#24212;&#30340;&#21508;&#25511;&#21046;&#27604;&#29305;&#20301;&#26159;&#19968;&#33268;&#30340;&#65292;&#22914;&#19979;&#25152;&#31034;&#65306;
</p><pre class="programlisting">
APLL_CON/MPLL_CON &#20301;       &#25551;&#36848;                            &#21021;&#22987;&#29366;&#24577;
ENABLE           [31]    PLL &#20351;&#33021;&#25511;&#21046;&#65288;0&#65306;&#31105;&#29992;&#65292;1&#65306;&#20351;&#33021;&#65289;&#12290; 0
RESERVED        [30:26]      &#20445;&#30041;&#12290;                         0x00
MDIV            [25:16]  PLL &#30340;M &#20998;&#39057;&#20540;&#12290;                   0x190 / 0x214
RESERVED        [15:14]      &#20445;&#30041;&#12290;                         0x0
PDIV            [13:8]   PLL &#30340;P &#20998;&#39057;&#20540;&#12290;                   0x3 / 0x6
RESERVED        [7:3]        &#20445;&#30041;&#12290;                         0x00
SDIV            [2:0]    PLL &#30340;S &#20998;&#39057;&#20540;&#12290;                   0x2 / 0x3
</pre><p>
&#22914;&#26524;&#36755;&#20837;&#26102;&#38047;&#39057;&#29575;&#26159;12MHz&#65292;&#21017;APLL_CON / MPLL_CON &#30340;&#22797;&#20301;&#20540;&#20998;&#21035;&#20135;&#29983;400MHz &#21644;133MHz &#30340;&#36755;&#20986;&#26102;&#38047;&#12290;S3C6410 CPU&#21487;&#20197;&#25903;&#25345;&#26368;&#39640;&#39057;&#29575;666MHz&#12290;&#23545;&#20110;APLL&#65292;MPLL&#21644;EPLL&#30340;&#20998;&#39057;&#20540;&#19981;&#26159;&#22312;Linux&#20013;&#35774;&#23450;&#30340;&#65292;&#32780;&#26159;&#22312;&#31995;&#32479;&#24341;&#23548;&#26102;&#30340;Bootloader&#20013;&#35774;&#23450;&#30340;&#65292;&#22914;&#26524;&#19981;&#35774;&#23450;&#65292;&#31995;&#32479;&#23558;&#20351;&#29992;&#22797;&#20301;&#20540;&#12290;ENABLE&#20301;&#29992;&#26469;&#20351;&#33021;&#35813;PLL&#65292;&#19968;&#26086;&#20351;&#33021;&#65292;&#21017;&#32463;&#21382;&#36807;APLL_LOCK/MPLL_LOCK&#20010;&#21608;&#26399;&#21518;APLL/EPLL&#21017;&#36755;&#20986;&#26032;&#26102;&#38047;&#20449;&#21495;&#12290;
</p>
<p>
</p><pre class="programlisting">
include/configs/smdk6410.h
//#define CONFIG_CLK_800_133_66
//#define CONFIG_CLK_666_133_66
#define CONFIG_CLK_532_133_66
......
//#define CONFIG_CLK_OTHERS
</pre><p>
Uboot&#20013;&#25552;&#20379;&#20102;&#20960;&#31867;&#31995;&#32479;&#26102;&#38047;&#30340;&#35774;&#23450;&#65292;&#27604;&#22914;&#35774;&#23450;ARMCLK&#20026;532&#65292;666&#31561;&#12290;&#22914;&#26524;&#36873;&#25321;&#20102;CONFIG_CLK_532_133_66&#65292;&#21017;&#24847;&#21619;&#30528;&#37197;&#32622;ARMCLK&#20026;532MHz&#65292;HCLK&#20026;133MHz&#65292;PCLK&#20026;66MHz&#12290;
</p><pre class="programlisting">
/* input clock of PLL */
#define CONFIG_SYS_CLK_FREQ  12000000 /* the SMDK6400 has 12MHz input clock */

#elif defined(CONFIG_CLK_532_133_66) /* FIN 12MHz, Fout 532MHz */
#define APLL_MDIV       266
#define APLL_PDIV       3
#define APLL_SDIV       1
#define CONFIG_SYNC_MODE
</pre><p>
&#36825;&#37324;&#30340;&#20998;&#39057;&#21442;&#25968;&#35201;&#26681;&#25454;&#25552;&#20379;&#30340;Fin&#39057;&#29575;&#21644;&#38656;&#27714;&#30340;Fout&#39057;&#29575;&#26469;&#21010;&#20998;&#12290;&#36825;&#37324;&#20381;&#25454;&#36755;&#20837;12MHz&#65292;&#36755;&#20986;532MHz&#26469;&#35774;&#23450;&#36825;&#20123;&#21442;&#25968;&#12290;
</p><pre class="programlisting">
#define set_pll(mdiv, pdiv, sdiv)       (1&lt;&lt;31 | mdiv&lt;&lt;16 | pdiv&lt;&lt;8 | sdiv)
#define APLL_VAL        set_pll(APLL_MDIV, APLL_PDIV, APLL_SDIV)
</pre><p>
set_pll&#23439;&#29992;&#26469;&#29983;&#25104;APLL_CON&#23492;&#23384;&#22120;&#25152;&#38656;&#35201;&#30340;&#20540;APLL_VAL&#65292;&#28982;&#21518;&#22312;Uboot&#20013;&#23545;&#35813;&#23492;&#23384;&#22120;&#35774;&#23450;&#12290;
</p><pre class="programlisting">
board/samsung/smdk6410/lowlevel_init.S
  ldr     r1, =APLL_VAL
  str     r1, [r0, #APLL_CON_OFFSET]
  ldr     r1, =MPLL_VAL
  str     r1, [r0, #MPLL_CON_OFFSET]
</pre><p>
&#22312;Uboot&#30340;&#21021;&#22987;&#21270;&#20195;&#30721;&#20013;&#65292;&#36890;&#36807;ldr&#21644;str&#25351;&#20196;&#26469;&#35774;&#32622;&#36825;&#20123;&#20540;&#65292;&#23545;&#20110;MPLL_VAL&#26469;&#35828;&#22914;&#19979;&#25152;&#31034;&#65306;
</p><pre class="programlisting">
/* fixed MPLL 533MHz */
#define MPLL_MDIV       266
#define MPLL_PDIV       3
#define MPLL_SDIV       1

#define MPLL_VAL        set_pll(MPLL_MDIV, MPLL_PDIV, MPLL_SDIV)
</pre><p>
&#34987;&#25512;&#33616;APLL/MPLL&#21442;&#25968;&#20540;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;
</p><div class="figure"><a name="idp81465292"></a><p class="title"><b>&#22270; 99. APLL/MPLL&#21442;&#32771;&#20540;</b></p><div class="figure-contents"><div><img src="images/time_apll.gif" alt="APLL/MPLL&#21442;&#32771;&#20540;"></div></div></div><p><br class="figure-break">
EPLL&#30340;&#23492;&#23384;&#22120;&#25511;&#21046;&#35201;&#22797;&#26434;&#19968;&#20123;&#65292;&#23427;&#26377;&#20004;&#20010;&#25511;&#21046;&#23492;&#23384;&#22120;EPLL_CON0&#21644;EPLL_CON1&#65292;EPLL_CON0&#21644;APLL_CON&#23492;&#23384;&#22120;&#30340;&#21151;&#33021;&#31867;&#20284;&#65306;
</p><pre class="programlisting">
EPLL_CON0       &#20301;               &#25551;&#36848;                         &#21021;&#22987;&#29366;&#24577;
ENABLE         [31]        PLL &#20351;&#33021;&#25511;&#21046;&#65288;0&#65306;&#31105;&#29992;&#65292;1&#65306;&#20351;&#33021;&#65289;&#12290;    0
RESERVED       [30:24]     &#20445;&#30041;&#12290;                                0x00
MDIV           [23:16]     PLL &#30340;M &#20998;&#39057;&#20540;&#12290;                      0x20
RESERVED       [15:14]     &#20445;&#30041;&#12290;                                0x0
PDIV           [13:8]      PLL &#30340;P &#20998;&#39057;&#20540;&#12290;                      0x1
RESERVED       [7:3]       &#20445;&#30041;&#12290;                                0x00
SDIV           [2:0]       PLL &#30340;S &#20998;&#39057;&#20540;&#12290;                      0x2
</pre><p>
</p><pre class="programlisting">
EPLL_CON1    &#20301;     &#25551;&#36848;             &#21021;&#22987;&#29366;&#24577;
RESERVED  [31:16]  &#20445;&#30041;&#12290;            0x0000
KDIV      [15:0]   PLL &#30340;K &#20998;&#39057;&#20540;&#12290;  0x9111
</pre><p>
&#23545;&#20110;EPLL&#65292;PDIV&#65292;MDIV&#65292;SDIV&#21644;KDIV&#21442;&#25968;&#19982;Fin&#21644;Fout&#30340;&#20851;&#31995;&#26377;&#20197;&#19979;&#20844;&#24335;&#30830;&#23450;&#65306;
</p><pre class="programlisting">
Fout = (MDIV + KDIV / 2^16) * Fin / (PDIV * 2^SDIV)
&#36825;&#37324;&#65292;&#29992;&#20110;APLL &#21644;MPLL &#30340; MDIV&#65292;PDIV&#65292;SDIV &#24517;&#39035;&#31526;&#21512;&#20197;&#19979;&#26465;&#20214;&#65306;
MDIV: 13 &#8804; MDIV &#8804; 255
PDIV: 1 &#8804; PDIV &#8804; 63
KDIV: 0 &#8804; KDIV &#8804; 65535
SDIV: 0 &#8804; SDIV &#8804; 5
Fvco (= (MDIV + KDIV / 2^16) × Fin / PDIV) : 250MHz &#8804; Fvco &#8804; 600MHz
Fout : 16MHz &#8804; Fout &#8804; 600MHz
</pre><p>
&#22914;&#26524;&#35774;&#23450;MDIV&#20026;32&#65292;PDIV&#20026;2&#65292;SDIV&#20026;1&#65292;KDIV&#20026;0&#65292;&#21017;EPLL&#36755;&#20986;Fout&#20026;(32 + 0/2^16) * 12MHz /(2 * 2^1) = 96MHz&#12290;&#23545;&#24212;&#30340;&#27719;&#32534;&#20195;&#30721;&#22914;&#19979;&#65306;
</p><pre class="programlisting">
ldr     r1, =0x80200203                 /* FOUT of EPLL is 96MHz */
str     r1, [r0, #EPLL_CON0_OFFSET]
ldr     r1, =0x0
str     r1, [r0, #EPLL_CON1_OFFSET]
</pre><p>
&#34987;&#25512;&#33616;EPLL&#21442;&#25968;&#20540;&#22914;&#19979;&#22270;&#25152;&#31034;&#65306;
</p><div class="figure"><a name="idp81469084"></a><p class="title"><b>&#22270; 100. EPLL&#21442;&#32771;&#20540;</b></p><div class="figure-contents"><div><img src="images/time_epll.gif" alt="EPLL&#21442;&#32771;&#20540;"></div></div></div><p><br class="figure-break">
&#24403;&#36755;&#20837;&#39057;&#29575;&#34987;&#25913;&#21464;&#25110;&#26159;&#20998;&#39057;&#20540;&#34987;&#25913;&#21464;&#26102;&#65292;PLL&#35201;&#27714;&#38145;&#21608;&#26399;&#12290;PLL_LOCK&#23492;&#23384;&#22120;&#25351;&#23450;&#36825;&#20010;&#38145;&#21608;&#26399;&#12290;&#22312;&#36825;&#20010;&#21608;&#26399;&#20869;&#65292;&#21508;&#20010;&#23376;&#31995;&#32479;&#30340;&#26102;&#38047;&#20449;&#21495;&#34987;&#38145;&#23450;&#20026;0&#12290;
</p><div class="figure"><a name="idp81469940"></a><p class="title"><b>&#22270; 101. PLL&#38145;&#23450;&#21608;&#26399;&#31034;&#24847;&#22270;</b></p><div class="figure-contents"><div><img src="images/time_lock.gif" alt="PLL&#38145;&#23450;&#21608;&#26399;&#31034;&#24847;&#22270;"></div></div></div><p><br class="figure-break">
</p><pre class="programlisting">
APLL_LOCK/MPLL_LOCK/EPLL_LOCK    &#20301;    &#25551;&#36848;                                &#21021;&#22987;&#29366;&#24577; 
RESERVED                      [31:16]  &#20445;&#30041;&#12290;                              0x0000
PLL_LOCKTIME                  [15:0]  &#22312;&#35268;&#23450;&#26399;&#38388;&#21518;&#20135;&#29983;&#19968;&#20010;&#31283;&#23450;&#30340;&#26102;&#38047;&#36755;&#20986;&#12290; 0xFFFF
</pre><p>
PLL_LOCK&#23492;&#23384;&#22120;&#25351;&#23450;&#30340;&#38145;&#21608;&#26399;&#26159;&#26681;&#25454;Fin&#26469;&#30830;&#23450;&#30340;&#65292;&#38145;&#23450;&#21608;&#26399;&#26377;&#19968;&#20010;&#26368;&#23567;&#38145;&#23450;&#26102;&#38388;&#65292;&#20063;&#21363;&#35774;&#23450;&#20540;&#24517;&#39035;&#22823;&#20110;&#35813;&#26102;&#38388;&#65292;PLL&#25165;&#26377;&#31283;&#23450;&#30340;&#36755;&#20986;&#12290;
</p><div class="figure"><a name="idp81470876"></a><p class="title"><b>&#22270; 102. &#38145;&#23450;&#21608;&#26399;</b></p><div class="figure-contents"><div><img src="images/time_period.gif" alt="&#38145;&#23450;&#21608;&#26399;"></div></div></div><p><br class="figure-break">
&#22914;&#22270;&#25152;&#31034;&#65292;&#22914;&#26524;Fin&#20026;12MHz&#65292;&#21017;&#38145;&#23450;&#21608;&#26399;&#25968;&#20026;300 / (1 * 10 ^ 6 / (12 * 10 ^ 6)) = 3600&#65292;&#21313;&#20845;&#36827;&#21046;&#34920;&#31034;&#20026;0xE10&#65292;&#30001;&#20110;&#35201;&#20445;&#35777;&#31283;&#23450;&#36755;&#20986;&#65292;&#25152;&#20197;&#32473;&#20986;&#30340;&#26368;&#23567;&#35774;&#23450;&#20540;&#20026;0xE11&#12290;&#22312;Uboot&#20013;&#23427;&#20204;&#34987;&#35774;&#32622;&#25104;&#20102;&#26368;&#22823;&#20540;0xffff&#65306;
</p><pre class="programlisting">
include/s3c6410.h
/* Clock &amp; Power Controller for mDirac3*/
#define APLL_LOCK_OFFSET        0x00
#define MPLL_LOCK_OFFSET        0x04
#define EPLL_LOCK_OFFSET        0x08

board/samsung/smdk6410/lowlevel_init.S
system_clock_init:
  ldr     r0, =ELFIN_CLOCK_POWER_BASE     @0x7e00f000
......
  mov     r1, #0xff00
  orr     r1, r1, #0xff
  str     r1, [r0, #APLL_LOCK_OFFSET]
  str     r1, [r0, #MPLL_LOCK_OFFSET]
  str     r1, [r0, #EPLL_LOCK_OFFSET]
</pre><p>
&#26174;&#28982;&#36825;&#37324;&#30340;&#20559;&#31227;&#20998;&#21035;&#23545;&#24212;&#21040;APLL_LOCK&#65292;MPLL_LOCK&#21644;EPLL_LOCK&#23492;&#23384;&#22120;&#12290;&#36825;&#19968;&#38145;&#21608;&#26399;&#23545;LCD&#26174;&#31034;&#22120;&#35774;&#22791;&#26377;&#26126;&#26174;&#24433;&#21709;&#12290;
</p>
</div>
<div class="sect2" title="18.3. S3C6410 CLK"><div class="titlepage"><div><div><h3 class="title"><a name="idp81473268"></a>18.3. S3C6410 CLK</h3></div></div></div>
<p>
PLL&#30340;&#23384;&#22312;&#21487;&#20197;&#33719;&#21462;&#27604;&#36755;&#20837;&#39640;&#25968;&#20493;&#30340;&#31283;&#23450;&#26102;&#38047;&#20449;&#21495;&#65292;&#20294;&#26159;ARM CPU&#30340;&#21508;&#20010;&#23376;&#31995;&#32479;IPs&#21644;&#22806;&#22260;&#35774;&#22791;&#26080;&#27861;&#30452;&#25509;&#20351;&#29992;&#22914;&#27492;&#39640;&#39057;&#29575;&#30340;&#26102;&#38047;&#20449;&#21495;&#65292;&#25152;&#20197;&#24517;&#39035;&#36827;&#34892;&#20998;&#39057;&#65292;&#19981;&#21516;&#30340;&#20998;&#39057;&#21442;&#25968;&#23558;&#33719;&#24471;&#19981;&#21516;&#30340;&#26102;&#38047;&#20449;&#21495;&#12290;&#32780;&#19968;&#20010;PLL&#30340;&#36755;&#20986;&#21487;&#20197;&#36890;&#36807;&#19981;&#21516;&#30340;&#20998;&#39057;&#22120;&#33719;&#21462;&#22810;&#20010;&#26102;&#38047;&#20449;&#21495;&#12290;
</p><div class="figure"><a name="gate"></a><p class="title"><b>&#22270; 103. ARM &#21644;&#24635;&#32447;&#26102;&#38047;&#21457;&#29983;&#22120;</b></p><div class="figure-contents"><div><img src="images/time_clk.gif" alt="ARM &#21644;&#24635;&#32447;&#26102;&#38047;&#21457;&#29983;&#22120;"></div></div></div><p><br class="figure-break">
&#20197;&#19979;&#30340;&#21465;&#36848;&#20013;&#22343;&#20551;&#35774;CLK_SRC&#22343;&#36873;&#36890;PLL&#26102;&#38047;&#20449;&#21495;&#12290;
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">ARMCLK&#65292;&#21069;&#38754;&#25552;&#21040;S3C6410&#30340;APLL&#29992;&#20110;ARM CPU&#26680;&#24515;&#26102;&#38047;&#65292;&#20174;&#22270;&#20013;&#21487;&#20197;&#30475;&#20986;&#65292;APLL&#30340;&#36755;&#20986;&#36824;&#35201;&#32463;&#36807;DIVarm&#20998;&#39057;&#22120;&#25165;&#20250;&#24471;&#21040;ARMCLK&#12290;</li><li class="listitem">MPLL &#20135;&#29983;&#20027;&#31995;&#32479;&#26102;&#38047;&#65292;&#29992;&#20110;&#25805;&#20316;AXI&#65292;AHB &#21644;APB &#24635;&#32447;&#25805;&#20316;&#12290;&#25152;&#20197;HCLK&#65292;PCLK&#22343;&#26377;&#23427;&#29983;&#25104;&#65292;&#21478;&#22806;&#23427;&#36824;&#36127;&#36131;&#22810;&#23186;&#20307;&#35299;&#30721;&#22120;CLKJPEG&#31561;&#23376;&#31995;&#32479;&#30340;&#26102;&#38047;&#20449;&#21495;&#12290;MPLL&#30340;HCLKX2 &#26102;&#38047;&#25552;&#20379;&#32473;&#20004;&#20010;DDR &#25511;&#21046;&#22120;&#65292;DDR0 &#21644;DDR1&#20351;&#29992;&#12290;&#25805;&#20316;&#36895;&#24230;&#21487;&#20197;&#36798;&#21040;&#26368;&#39640;266MHz&#65292;&#36890;&#36807;DDR &#25511;&#21046;&#22120;&#21457;&#36865;&#21644;&#25509;&#25910;&#25968;&#25454;&#12290;&#24403;&#25805;&#20316;&#27809;&#26377;&#34987;&#35831;&#27714;&#26102;&#65292;&#27599;&#20010;HCLKX2 &#26102;&#38047;&#21487;&#29420;&#31435;&#22320;&#23631;&#34109;&#65292;&#20197;&#20943;&#23569;&#22810;&#20313;&#30340;&#21151;&#29575;&#32791;&#25955;&#22312;&#26102;&#38047;&#20998;&#37197;&#32593;&#32476;&#19978;&#12290;</li><li class="listitem">&#27880;&#24847;&#20854;&#20013;&#30340;XXX_GATE&#23492;&#23384;&#22120;&#65292;&#23427;&#20204;&#29992;&#20110;&#23631;&#34109;&#25110;&#32773;&#20351;&#33021;&#35813;&#26102;&#38047;&#20449;&#21495;&#12290;HCLKX2&#30340;&#20998;&#39057;&#22120;&#20026;DIVHCLKX2&#65292;HCLK&#21644;PCLK&#31561;&#30340;&#26102;&#38047;&#28304;&#20063;&#21462;&#33258;&#35813;&#20998;&#39057;&#22120;&#30340;&#36755;&#20986;&#65292;&#24182;&#19988;&#26377;&#21508;&#33258;&#30340;&#20998;&#39057;&#22120;DIVHCLK&#21644;DIVPCLK&#31561;&#30456;&#23545;&#24212;&#12290;&#23427;&#20204;&#20998;&#21035;&#23545;&#24212;AXI/AHB&#21644;APB&#24635;&#32447;&#26102;&#38047;&#12290;</li></ul></div><p>
&#36830;&#25509;&#21040;APB&#24635;&#32447;&#30340;&#22806;&#35774;&#22343;&#20174;PCLK&#26102;&#38047;&#26469;&#20877;&#27425;&#20998;&#39057;&#24471;&#21040;&#23545;&#24212;&#30340;&#25152;&#38656;&#26102;&#38047;&#65292;&#27604;&#22914;Camera I/F &#26102;&#38047;&#21457;&#29983;&#22120;&#65292;OneNAND &#26102;&#38047;&#21457;&#29983;&#22120;&#31561;&#12290;
</p>
<p>
EPLL &#20135;&#29983;&#30340;&#26102;&#38047;&#20027;&#35201;&#29992;&#20110;&#38750;APB&#24635;&#32447;&#22806;&#35774;&#12290;&#23427;&#20135;&#29983;SCLK&#20449;&#21495;&#65292;&#20294;&#26159;&#30001;&#20110;&#35832;&#22810;&#22806;&#35774;&#23545;&#26102;&#38047;&#30340;&#35201;&#27714;&#21508;&#24322;&#65292;&#23548;&#33268;&#22823;&#22810;&#25968;&#22806;&#35774;&#37117;&#38656;&#35201;&#23545;SCLK&#20449;&#21495;&#20877;&#27425;&#20998;&#39057;&#12290;&#27604;&#22914;&#22810;&#26684;&#24335;&#32534;&#35299;&#30721;&#22120;(MFC)&#65292;UART&#65292;SPI &#21644;MMC &#30340;&#26102;&#38047;&#21457;&#29983;&#22120;&#31561;&#12290;&#26377;&#20123;&#35774;&#22791;&#21487;&#33021;&#38656;&#35201;&#22810;&#36335;&#26102;&#38047;&#20449;&#21495;&#65292;&#27492;&#26102;&#21487;&#33021;&#20174;HCLK&#21644;SCLK&#21462;&#22810;&#36335;&#20998;&#39057;&#26102;&#38047;&#12290;MFC &#22312;&#38500;&#20102;HCLK &#21644; PCLK &#22806;&#65292;&#23601;&#36824;&#38656;&#35201;&#19968;&#20010;&#29305;&#27530;&#26102;&#38047;&#12290;
</p><div class="figure"><a name="idp81476980"></a><p class="title"><b>&#22270; 104. MFC&#30340;&#29305;&#27530;&#26102;&#38047;&#20449;&#21495;</b></p><div class="figure-contents"><div><img src="images/time_mfc.gif" alt="MFC&#30340;&#29305;&#27530;&#26102;&#38047;&#20449;&#21495;"></div></div></div><p><br class="figure-break">
&#26174;&#28982;&#20301;&#25968;&#20247;&#22810;&#30340;&#20998;&#39057;&#22120;&#28385;&#36275;&#20102;&#21508;&#31867;&#24635;&#32447;&#21644;&#35774;&#22791;&#30340;&#38656;&#27714;&#65292;&#20294;&#26159;&#23545;&#36825;&#20123;&#20998;&#39057;&#22120;&#25552;&#20379;&#21442;&#25968;&#35774;&#23450;&#21364;&#38656;&#35201;&#35880;&#24910;&#20174;&#20107;&#12290;&#22909;&#22312;S3C6410&#23558;&#36825;&#20123;&#20998;&#39057;&#22120;&#30340;&#21442;&#25968;&#35774;&#23450;&#32479;&#19968;&#25918;&#22312;CLK_DIV0&#65292;CLK_DIV1 &#21644;CLK_DIV2 &#19977;&#20010;&#23492;&#23384;&#22120;&#20013;&#36827;&#34892;&#32479;&#19968;&#25511;&#21046;&#12290;&#36890;&#24120;&#36825;&#20123;&#21442;&#25968;&#34987;&#21629;&#21517;&#20026;XXX_RATIO&#12290;
</p>
<p>
CLK_DIV0 &#20027;&#35201;&#25511;&#21046;&#31995;&#32479;&#26102;&#38047;&#21644;&#22810;&#23186;&#20307;IP &#30340;&#29305;&#27530;&#26102;&#38047;&#12290;APLL &#21644;MPLL &#30340;&#36755;&#20986;&#39057;&#29575;&#26159;&#36890;&#36807;ARM_RATIO &#21644;
MPLL_RATIO &#36827;&#34892;&#20998;&#39057;&#30340;&#12290;HCLKX2&#65292;&#36890;&#36807;HCLKX2_RATIO &#36827;&#34892;&#20998;&#39057;&#12290;&#30001;&#20110;&#35813;&#26102;&#38047;&#26159;&#20854;&#20182;&#25805;&#20316;&#31995;&#32479;&#26102;&#38047;&#30340;&#22522;&#30784;&#26102;&#38047;&#65292;&#25152;&#20197;&#26377;&#25805;&#20316;&#39057;&#29575;&#30340;&#23616;&#38480;&#24615;&#12290;HCLKX2&#65292;HCLK &#21644;PCLK &#30340;&#26368;&#22823;&#25805;&#20316;&#39057;&#29575;&#20998;&#21035;&#20026;266MHz&#65292;133MHz &#21644;66MHz&#12290;NAND&#65292;SECUR
&#21644;JPEG &#30340;&#26102;&#38047;&#25805;&#20316;&#19981;&#33021;&#36229;&#36807;66MHz&#12290;MFC &#21644;CAM &#26102;&#38047;&#25805;&#20316;&#19981;&#33021;&#25805;&#36807;133MHz&#12290;&#27492;&#26102;&#38047;&#25805;&#20316;&#30340;&#26465;&#20214;&#24517;&#39035;&#28385;&#36275;
CLK_DIV0 &#30340;&#37197;&#32622;&#12290;
</p><pre class="programlisting">
CLK_DIV0             &#20301;                         &#25551;&#36848;                         &#21021;&#22987;&#29366;&#24577;
MFC_RATIO          [31:28]                MFC&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290;
                                    CLKMFC = CLKMFCIN / (MFC_RATIO + 1)        0x0
JPEG_RATIO         [27:24]     JPEG&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#65292;&#24517;&#39035;&#26159;&#22855;&#25968;&#20540;&#12290;
                               &#25442;&#21477;&#35805;&#35828;&#65292;S3C6410&#20165;&#25903;&#25345;&#20598;&#25968;&#20998;&#39057;&#27604;&#20363;&#12290;
                                CLKJPEG = HCLKX2 / (JPEG_RATIO + 1)            0x1
CAM_RATIO          [23:20]         CAM&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290;
                                   CLKCAM = HCLKX2 / (CAM_RATIO + 1)           0x0
SECUR_RATIO        [19:18]       &#23433;&#20840;&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#65292;&#24517;&#39035;&#26159;0x1&#25110;0x3&#12290; 
                                 CLKSECUR = HCLKX2 / (SECUR_RATIO + 1)         0x1
ONENAND_RATIO      [17:16]          OneNAND&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290; 
                               CLKONENAND = HCLKX2 / (ONENAND_RATIO + 1)       0x1
PCLK_RATIO         [15:12] PCLK &#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;, &#23427;&#24517;&#39035;&#26159;&#22855;&#25968;&#20540;&#12290;&#25442;&#21477;&#35805;&#35828;&#65292;
                             S3C6410 &#20165;&#25903;&#25345;&#20598;&#25968;&#20998;&#39057;&#27604;&#20363;&#12290;PCLK = HCLKX2 /
                                  (PCLK_RATIO + 1)                             0x1
HCLKX2_RATIO       [11:9]          HCLKX2&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290;
                               HCLKX2 = HCLKX2IN / (HCLKX2_RATIO + 1)          0x0
HCLK_RATIO         [8]             HCLK&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290;
                               HCLK = HCLKX2 / (HCLK_RATIO + 1)                0
RESERVED           [7:5]                         &#20445;&#30041;&#12290;                        0x0
MPLL_RATIO         [4]               DIVMPLL &#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290;
                               DOUTMPLL = MOUTMPLL / (MPLL_RATIO + 1)          0
RESERVED           [3]                        &#20445;&#30041;&#12290;                           0
ARM_RATIO          [2:0]            DIVARM &#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290; 
                              ARMCLK = DOUTAPLL / (ARM_RATIO + 1)              0x0
</pre><p>
CLK_DIV1 &#25511;&#21046;MMC&#65292;LCD&#65292;TV &#23450;&#26631;&#22120;&#21644;UHOST &#26102;&#38047;&#12290;CLK_DIV2 &#25511;&#21046;SPI&#65292;AUDIO&#65292;UART&#21644;IrDA &#26102;&#38047;&#12290;&#23545;&#20110;&#36825;&#20004;&#20010;&#23492;&#23384;&#22120;&#26631;&#24535;&#30340;&#35814;&#32454;&#25551;&#36848;&#35831;&#21442;&#32771;&#30456;&#20851;&#25991;&#26723;&#12290;
</p>
<p>
&#22312;Uboot&#20013;&#20165;&#20165;&#23545;&#24403;&#21069;&#38454;&#27573;&#38656;&#35201;&#20351;&#29992;&#30340;&#25110;&#32773;&#38656;&#35201;&#25913;&#21464;&#26102;&#38047;&#20998;&#39057;&#21442;&#25968;&#30340;&#23492;&#23384;&#22120;&#20301;&#36827;&#34892;&#20102;&#35774;&#32622;&#65292;&#21253;&#25324;ARM_RATIO&#65292;MPLL_RATIO&#65292;ONENAND_RATIO&#65292;SECUR_RATIO&#21644;MFC_RATIO&#65292;&#29305;&#27530;&#35774;&#22791;&#30340;&#26102;&#38047;&#23558;&#30001;&#23545;&#24212;&#30340;&#39537;&#21160;&#22312;Linux&#20869;&#26680;&#20013;&#23545;&#20854;&#21021;&#22987;&#21270;&#25110;&#32773;&#20877;&#27425;&#35843;&#25972;&#12290;
</p><pre class="programlisting">
include/configs/smdk6410.h
#if defined(CONFIG_CLK_800_133_66)
......
#else
#define Startup_APLLdiv         0
#define Startup_HCLKx2div       1
#endif


#define Startup_PCLKdiv         3
#define Startup_HCLKdiv         1
#define Startup_MPLLdiv         1

#define CLK_DIV_VAL     ((Startup_PCLKdiv&lt;&lt;12)|(Startup_HCLKx2div&lt;&lt;9)|(Startup_HCLKdiv&lt;&lt;8)
                        |(Startup_MPLLdiv&lt;&lt;4)|Startup_APLLdiv)
</pre><p>
CLK_DIV_VAL&#21442;&#25968;&#26412;&#36136;&#19978;&#20063;&#26159;&#21463;&#21040;CONFIG_CLK_532_133_66&#36825;&#20010;&#23439;&#26469;&#25511;&#21046;&#30340;&#12290;
</p><pre class="programlisting">
include/s3c6410.h
#define CLK_DIV0_OFFSET         0x20
#define CLK_DIV1_OFFSET         0x24
#define CLK_DIV2_OFFSET         0x28

board/samsung/smdk6410/lowlevel_init.S
ldr     r1, [r0, #CLK_DIV0_OFFSET]      /*Set Clock Divider*/
bic     r1, r1, #0x30000
bic     r1, r1, #0xff00
bic     r1, r1, #0xff
ldr     r2, =CLK_DIV_VAL
orr     r1, r1, r2
str     r1, [r0, #CLK_DIV0_OFFSET]
</pre><p>
&#23545;&#20998;&#39057;&#23492;&#23384;&#22120;&#30340;&#25805;&#20316;&#19982;PLL&#30340;&#20998;&#39057;&#35774;&#23450;&#31867;&#20284;&#65292;&#37117;&#20250;&#23545;&#36755;&#20986;&#27874;&#24418;&#20135;&#29983;&#25200;&#21160;&#65292;&#25152;&#20197;&#38656;&#35201;&#19968;&#20010;&#31283;&#23450;&#21608;&#26399;&#12290;&#36825;&#20010;&#21608;&#26399;&#26159;&#19981;&#22266;&#23450;&#30340;&#65292;&#22312;&#20856;&#22411;&#30340;&#20363;&#23376;&#20013;&#22823;&#32422;&#26159;10&#65374;20 &#26102;&#38047;&#21608;&#26399;&#12290;&#22240;&#27492;&#65292;&#22914;&#26524;&#19968;&#20123;IP &#36816;&#34892;&#65292;&#24517;&#39035;&#29305;&#21035;&#27880;&#24847;&#27604;&#29575;&#25913;&#21464;&#30340;&#21608;&#26399;&#12290;&#21542;&#21017;&#65292;IP &#25805;&#20316;&#23558;&#22833;&#36133;&#12290;&#25152;&#20197;&#22914;&#26524;&#38656;&#35201;&#25913;&#21464;&#20998;&#39057;&#22120;&#21442;&#25968;&#65292;&#24517;&#39035;&#32771;&#34385;&#21040;&#23545;&#22806;&#35774;&#30340;&#24433;&#21709;&#65292;&#36890;&#24120;&#22312;&#22806;&#35774;&#20851;&#38381;&#29366;&#24577;&#19979;&#36827;&#34892;&#65292;&#25110;&#32773;&#22312;&#21551;&#21160;&#26102;&#21021;&#22987;&#21270;&#65292;&#20197;&#21518;&#19981;&#20877;&#25913;&#21464;&#12290;
</p><div class="figure"><a name="idp81483268"></a><p class="title"><b>&#22270; 105. &#31995;&#32479;&#26102;&#38047;&#27604;&#20363;&#21464;&#21270;&#26102;&#27874;&#24418;</b></p><div class="figure-contents"><div><img src="images/time_divide.gif" alt="&#31995;&#32479;&#26102;&#38047;&#27604;&#20363;&#21464;&#21270;&#26102;&#27874;&#24418;"></div></div></div><p><br class="figure-break">
ARMCLK&#30340;&#26368;&#22823;&#39057;&#29575;&#20026;666MHz&#12290;HCLKX2&#65292;HCLK &#21644;PCLK &#30340;&#26368;&#22823;&#25805;&#20316;&#39057;&#29575;&#20998;&#21035;&#20026;266MHz&#65292;133MHz &#21644;66MHz&#12290;NAND&#65292;SECUR
&#21644;JPEG &#30340;&#26102;&#38047;&#25805;&#20316;&#19981;&#33021;&#36229;&#36807;66MHz&#12290;MFC &#21644;CAM &#26102;&#38047;&#25805;&#20316;&#19981;&#33021;&#25805;&#36807;133MHz&#12290;&#37197;&#32622;&#20998;&#39057;&#22120;&#21442;&#25968;&#26102;&#24517;&#39035;&#28385;&#36275;&#36825;&#20123;&#35201;&#27714;&#65292;&#23613;&#31649;ARM&#20869;&#26680;&#21487;&#20197;&#36229;&#39057;&#36816;&#34892;&#65292;&#20294;&#36825;&#21487;&#33021;&#24433;&#21709;CPU&#30340;&#31283;&#23450;&#21644;&#20351;&#29992;&#23551;&#21629;&#12290;
</p>
</div>
<div class="sect2" title="18.4. &#36873;&#25321;&#26102;&#38047;&#28304;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81484756"></a>18.4. &#36873;&#25321;&#26102;&#38047;&#28304;</h3></div></div></div>
<p>
&#22238;&#21040;&#24320;&#22987;&#30340;<a class="xref" href="ar01s18.html#pll" title="&#22270; 97. &#20174;PLL &#36755;&#20986;&#26102;&#38047;&#21457;&#29983;&#22120;">&#22270; 97 &#8220;&#20174;PLL &#36755;&#20986;&#26102;&#38047;&#21457;&#29983;&#22120;&#8221;</a>&#65292;&#25968;&#25454;&#36873;&#25321;&#22120;&#29992;&#26469;&#23545;&#22810;&#36335;&#36755;&#20837;&#20449;&#21495;&#36873;&#25321;&#24182;&#36755;&#20986;&#20854;&#19968;&#65292;&#36825;&#37324;&#23427;&#36215;&#21040;&#23545;&#26102;&#38047;&#20449;&#21495;&#30340;&#36873;&#25321;&#20316;&#29992;&#12290;S3C6410 &#26377;&#24456;&#22810;&#26102;&#38047;&#28304;&#65292;&#21253;&#25324;&#22806;&#37096;&#25391;&#33633;&#22120;&#65292;&#22806;&#37096;&#26102;&#38047;&#65292;&#20197;&#21450;&#30001;&#36825;&#20123;&#26102;&#38047;&#27966;&#29983;&#20986;&#30340;&#19977;&#20010;PLL &#36755;&#20986;&#21644;&#20854;&#20182;&#26102;&#38047;&#28304;&#12290;CLK_SRC &#23492;&#23384;&#22120;&#29992;&#20110;&#25511;&#21046;&#27599;&#20010;&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#26102;&#38047;&#28304;&#12290;&#23427;&#30340;&#22797;&#20301;&#20540;&#20026;0x00000000&#65292;&#36825;&#37324;&#21015;&#20986;PLL&#36755;&#20986;&#25511;&#21046;&#20301;&#65306;
</p><pre class="programlisting">
CLK_SRC   &#20301;               &#25551;&#36848;                     &#21021;&#22987;&#29366;&#24577;
UART_SEL [13]  &#25511;&#21046;MUXUART0&#65292;&#23427;&#26159;UART&#30340;&#26102;&#38047;&#28304;&#12290;
               (0&#65306;MOUTEPLL, 1&#65306;DOUTMPLL)            0
EPLL_SEL [2] &#25511;&#21046;MUXEPLL (0&#65306;FINEPLL, 1&#65306;FOUTEPLL)&#12290; 0
MPLL_SEL [1] &#25511;&#21046;MUXMPLL (0&#65306;FINMPLL, 1&#65306;FOUTMPLL)&#12290; 0
APLL_SEL [0] &#25511;&#21046;MUXAPLL (0&#65306;FINAPLL, 1&#65306;FOUTAPLL)&#12290; 0
</pre><p>	
Uboot&#20013;&#36873;&#36890;&#20102;PLL&#26102;&#38047;&#20449;&#21495;&#30340;&#36755;&#20986;&#65292;&#24182;&#19988;&#26681;&#25454;&#26159;&#21542;&#37197;&#32622;UART(Universal Asynchronous Receiver/Transmitter&#65292;&#36890;&#29992;&#24322;&#27493;&#25509;&#25910;/&#21457;&#36865;&#35013;&#32622;)&#20018;&#21475;&#20174;DIVMPLL&#30340;&#36755;&#20986;&#21462;&#20449;&#21495;&#65292;&#36824;&#26159;&#20174;EPLL&#36755;&#20986;&#21462;&#20449;&#21495;&#12290;
</p><pre class="programlisting">
#define CLK_SRC_OFFSET          0x1C

board/samsung/smdk6410/lowlevel_init.S
   ldr     r1, [r0, #CLK_SRC_OFFSET]  /* APLL, MPLL, EPLL select to Fout */
#if defined(CONFIG_CLKSRC_CLKUART)
  ldr     r2, =0x2007
#else
  ldr     r2, =0x7
#endif
  orr     r1, r1, r2
  str     r1, [r0, #CLK_SRC_OFFSET]
</pre><p>
</p>
</div>
<div class="sect2" title="18.5. &#36873;&#36890;&#26102;&#38047;&#28304;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81488196"></a>18.5. &#36873;&#36890;&#26102;&#38047;&#28304;</h3></div></div></div>
<p>
&#26102;&#38047;&#28304;&#36873;&#36890;&#25511;&#21046;&#29992;&#26469;&#23631;&#34109;&#25110;&#32773;&#36873;&#36890;&#26102;&#38047;&#20449;&#21495;&#65292;&#36890;&#24120;&#23427;&#20301;&#20110;&#26102;&#38047;&#20135;&#29983;&#30005;&#36335;&#30340;&#26368;&#21518;&#19968;&#32423;&#65292;&#21482;&#26377;&#36873;&#36890;&#26102;&#38047;&#25165;&#33021;&#20351;&#35774;&#22791;&#27491;&#24120;&#24037;&#20316;&#65292;&#22788;&#20110;&#33410;&#30465;&#30005;&#28304;&#30340;&#32771;&#34385;&#65292;&#26377;&#20123;&#35774;&#22791;&#21487;&#33021;&#22312;&#26576;&#20123;&#24773;&#20917;&#19979;&#20572;&#27490;&#36816;&#34892;&#65292;&#27492;&#26102;&#21017;&#21487;&#20197;&#36890;&#36807;&#23631;&#34109;&#25805;&#20316;&#65292;&#26469;&#20572;&#27490;&#35813;&#35774;&#22791;&#26102;&#38047;&#12290;&#21442;&#32771;<a class="xref" href="ar01s18.html#gate" title="&#22270; 103. ARM &#21644;&#24635;&#32447;&#26102;&#38047;&#21457;&#29983;&#22120;">&#22270; 103 &#8220;ARM &#21644;&#24635;&#32447;&#26102;&#38047;&#21457;&#29983;&#22120;&#8221;</a>&#65292;&#23427;&#29992;&#38376;&#30005;&#36335;&#26469;&#23454;&#29616;&#12290;&#36890;&#24120;&#34987;&#21629;&#21517;&#20026;XXX_GATE&#12290;S3C6410&#25552;&#20379;HCLK_GATE&#65292;PCLK_GATE&#21644;SCLK_GATE&#19977;&#20010;&#23492;&#23384;&#22120;&#25511;&#21046;&#26102;&#38047;&#31105;&#29992;/&#20351;&#33021;&#25805;&#20316;&#12290;
</p>
<p>
HCLK_GATE&#25511;&#21046;&#25152;&#26377;Ips&#30340;HCLK&#65292;&#22914;&#26524;&#21306;&#22495;&#20026;&#8216;1&#8217;&#65292;&#21017;HCLK&#34987;&#25552;&#20379;&#65292;&#21542;&#21017;&#65292;HCLK&#34987;&#23631;&#34109;&#12290;&#24403;S3C6410
&#36716;&#25442;&#25104;&#25481;&#30005;&#27169;&#24335;&#26102;&#65292;&#31995;&#32479;&#25511;&#21046;&#22120;&#26816;&#26597;&#19968;&#20123;&#27169;&#22359;&#65288;IROM&#65292;MEM0&#65292;MEM1&#21644;MFC&#27169;&#22359;&#65289;&#30340;&#29366;&#24577;&#12290;&#22240;&#27492;&#65292;&#20301;25&#65292;22&#65292;21&#65292;0&#24517;&#39035;&#20026;&#8216;1&#8217;&#65292;&#20197;&#31526;&#21512;&#25481;&#30005;&#30340;&#35201;&#27714;&#12290;
</p>
<p>
PCLK_GATE &#25511;&#21046;&#25152;&#26377;Ips&#30340;PCLK&#65292;&#27604;&#22914;PWM&#23450;&#26102;&#22120;&#30340;&#26102;&#38047;&#28304;&#12290;SCLK_GATE&#25511;&#21046;IP&#30340;&#29305;&#27530;&#26102;&#38047;&#12290;
</p>
&#40664;&#35748;&#24773;&#20917;&#19979;&#36825;&#20123;&#26102;&#38047;&#20840;&#37096;&#36873;&#36890;&#12290;
</div>
<div class="sect2" title="18.6. PWM &#23450;&#26102;&#22120;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81490324"></a>18.6. PWM &#23450;&#26102;&#22120;</h3></div></div></div>
<p>
&#22823;&#22810;&#25968;&#30340;SOC CPU&#33258;&#36523;&#37117;&#38598;&#25104;&#26377;&#23450;&#26102;&#22120;&#23376;&#31995;&#32479;&#65292;&#23427;&#26082;&#21487;&#20197;&#20351;&#29992;&#23450;&#26102;&#22120;&#20316;&#20026;&#20869;&#37096;&#26102;&#38047;&#20013;&#26029;&#20351;&#29992;&#65292;&#20063;&#21487;&#20197;&#26681;&#25454;&#22806;&#37096;&#26102;&#38047;&#28304;&#29983;&#25104;&#29305;&#23450;&#30340;&#26102;&#38047;&#24182;&#36755;&#20986;&#32473;&#22806;&#35774;&#20351;&#29992;&#12290;&#26377;&#20123;&#22806;&#37096;&#35774;&#22791;&#38656;&#35201;&#29305;&#27530;&#30340;&#26102;&#38047;&#27874;&#24418;&#65306;&#19981;&#21516;&#30340;&#21344;&#31354;&#27604;&#25110;&#32773;&#21253;&#21547;&#27515;&#21306;&#65292;&#27604;&#22914;LCD&#39537;&#21160;&#21487;&#20197;&#35843;&#25972;&#21344;&#31354;&#27604;&#26469;&#35843;&#33410;LCD&#30340;&#21608;&#26399;&#20869;&#21457;&#20809;&#26102;&#38388;&#21344;&#27604;&#65292;&#20197;&#25913;&#21464;&#20142;&#24230;&#65307;&#30005;&#26426;&#39537;&#21160;&#30005;&#36335;&#36890;&#24120;&#38656;&#35201;&#24102;&#26377;&#27515;&#21306;&#30340;&#26102;&#38047;&#20449;&#21495;&#12290;PWM(Pulse Width Modulation)&#33033;&#20914;&#23485;&#24230;&#35843;&#21046;&#21017;&#21487;&#20197;&#28385;&#36275;&#36825;&#20123;&#38656;&#27714;&#12290;S3C6410&#25552;&#20379;&#20102;5&#20010;&#21253;&#21547;PWM&#35843;&#21046;&#21151;&#33021;&#30340;32&#20301;&#23450;&#26102;&#22120;(Timer)&#12290;
</p>
<p>
</p><div class="figure"><a name="idp81491652"></a><p class="title"><b>&#22270; 106. PWM&#23450;&#26102;&#22120;</b></p><div class="figure-contents"><div><img src="images/time_pwm.gif" alt="PWM&#23450;&#26102;&#22120;"></div></div></div><p><br class="figure-break">
&#22914;&#22270;&#25152;&#31034;&#65292;S3C6410&#30340;&#23450;&#26102;&#22120;&#26377;5&#20010;&#65292;&#23450;&#26102;&#22120;0&#21644;1&#20855;&#26377;&#27515;&#21306;&#35843;&#21046;&#21151;&#33021;&#65292;&#26159;&#26377;&#22806;&#37096;&#36755;&#20986;&#30340;&#65292;2&#12289;3&#21644;4&#20165;&#20379;CPU&#20869;&#37096;&#20351;&#29992;&#65292;&#19981;&#20855;&#26377;&#27515;&#21306;&#35843;&#21046;&#21151;&#33021;&#65292;&#20063;&#27809;&#26377;&#36755;&#20986;&#31649;&#33050;&#12290;PWM&#23450;&#26102;&#22120;&#20027;&#35201;&#26377;&#20197;&#19979;&#37096;&#20998;&#32452;&#25104;&#65306;
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">2&#20010;8&#20301;&#39044;&#20998;&#39057;&#22120;(Prescaler)&#65292;&#23427;&#30340;&#36755;&#20837;&#28304;&#20026;PLCK&#12290;&#36755;&#20986;&#34987;&#20316;&#20026;PWM&#23450;&#26102;&#22120;&#30340;&#31532;&#19968;&#32423;&#12290;</li><li class="listitem">5&#20010;&#26102;&#38047;&#20998;&#39057;&#22120;&#21644;5&#20010;&#22810;&#36335;&#36873;&#25321;&#22120;(MUX)&#25552;&#20379;&#31532;&#20108;&#32423;&#36755;&#20986;&#12290;</li><li class="listitem">5&#20010;&#29420;&#31435;&#30340;&#36923;&#36753;&#25511;&#21046;&#30005;&#36335;&#65292;&#21487;&#20197;&#29992;&#26469;&#37197;&#32622;&#33258;&#21160;&#35013;&#36733;&#21644;&#26102;&#38047;&#21608;&#26399;&#12290;</li><li class="listitem">2&#20010;&#36870;&#21464;&#22120;(Inverter)&#65292;&#29992;&#20110;&#25511;&#21046;&#36755;&#20986;&#26102;&#38047;&#20449;&#21495;&#30340;&#30005;&#24179;&#26497;&#24615;&#65292;&#20316;&#29992;&#22312;0&#21644;1&#23450;&#26102;&#22120;&#12290;</li><li class="listitem">1&#20010;&#27515;&#21306;&#21457;&#29983;&#22120;&#65292;&#23427;&#20316;&#29992;&#22312;0&#21644;1&#23450;&#26102;&#22120;&#12290;</li></ul></div><p>
&#38024;&#23545;&#36825;&#20123;&#32452;&#25104;&#37096;&#20998;&#65292;S3C6410&#25552;&#20379;&#20102;18&#20010;&#29305;&#27530;&#21151;&#33021;&#23492;&#23384;&#22120;&#26469;&#23545;&#23427;&#20204;&#30340;&#21442;&#25968;&#36827;&#34892;&#37197;&#32622;&#12290;&#21478;&#22806;PWM&#23450;&#26102;&#22120;&#26377;&#20004;&#31181;&#24037;&#20316;&#27169;&#24335;&#65306;&#33258;&#21160;&#37325;&#26032;&#36733;&#20837;&#27169;&#24335;&#65307;&#19968;&#27425;&#35302;&#21457;&#33033;&#20914;&#27169;&#24335;&#12290;
</p>
<div class="sect3" title="18.6.1. PWM &#20998;&#39057;&#22120;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81492012"></a>18.6.1. PWM &#20998;&#39057;&#22120;</h4></div></div></div>
PWM&#26377;2&#20010;&#39044;&#20998;&#39057;&#22120;&#65292;&#36890;&#36807;TCFG0&#23492;&#23384;&#22120;&#21487;&#20197;&#37197;&#32622;&#23427;&#20204;&#30340;&#21442;&#25968;&#12290;
<pre class="programlisting">
TCFG0              &#20301;    &#35835;/&#20889;            &#25551;&#36848;                     &#21021;&#22987;&#29366;&#24577;
Reserved         [31:24]   &#35835;             &#20445;&#30041;                      0x00
Dead zone length [23:16]  &#35835;/&#20889;         &#27515;&#21306;&#30340;&#38271;&#24230;                  0x00
Prescaler 1      [15:8]   &#35835;/&#20889;  &#39044;&#23450;&#26631;&#22120;1 &#30340;&#20540;&#65292;&#29992;&#20110;&#23450;&#26102;&#22120;2&#12289;3 &#21644;4 0x01
Prescaler 0      [7:0]    &#35835;/&#20889;  &#39044;&#23450;&#26631;&#22120;0 &#30340;&#20540;&#65292;&#29992;&#20110;&#23450;&#26102;&#22120;0 &#21644;1    0x01
</pre>	
8&#20301;&#39044;&#20998;&#39057;&#22120;&#21487;&#20197;&#35774;&#32622;&#30340;&#33539;&#22260;&#20540;&#20026;0~255&#12290;&#39044;&#20998;&#39057;&#22120;&#30340;&#36755;&#20986;&#20026;&#65306;
<pre class="programlisting">
&#39044;&#20998;&#39057;&#22120;&#36755;&#20986; = PCLK / (&#39044;&#20998;&#39057;&#22120;&#20540; + 1)
&#39044;&#20998;&#39057;&#22120;&#20540; = 0~255
</pre>	
&#39044;&#20998;&#39057;&#22120;&#30340;&#20316;&#29992;&#26174;&#28982;&#26159;&#22312;&#38477;&#39057;&#65292;&#20197;&#22791;&#25552;&#20379;&#21512;&#36866;&#30340;&#20302;&#39057;&#32473;&#22806;&#37096;&#35774;&#22791;&#25110;&#32773;&#20869;&#37096;&#26102;&#38047;&#20013;&#26029;&#20351;&#29992;&#12290;PWM&#21516;&#26102;&#22312;&#39044;&#20998;&#39057;&#22120;&#21518;&#20869;&#32622;&#20102;&#23545;&#24212;&#30340;5&#36335;&#20998;&#39057;&#22120;&#65292;&#20294;&#26159;&#23427;&#20204;&#19981;&#21487;&#35843;&#33410;&#65292;&#20165;&#26377;&#22266;&#23450;&#30340;5&#36335;&#36755;&#20986;&#12290;
<pre class="programlisting">
&#20998;&#39057;&#22120;&#20540; = 1&#65292;2&#65292;4&#65292;8&#65292;16&#12290;
</pre>
&#20998;&#39057;&#22120;&#30340;&#36755;&#20986;&#20026;&#65306;
<pre class="programlisting">
&#20998;&#39057;&#22120;&#36755;&#20986; = PCLK / (&#39044;&#20998;&#39057;&#22120;&#20540; + 1) / &#20998;&#39057;&#22120;&#20540;
</pre>
&#21478;&#22806;&#27880;&#24847;&#27515;&#21306;&#38271;&#24230;&#20063;&#36890;&#36807;TCFG0&#23492;&#23384;&#22120;&#35774;&#23450;&#12290;&#24403;PLCK&#39057;&#29575;&#20026;66MHz&#26102;&#65292;&#20998;&#39057;&#22120;&#20998;&#36776;&#29575;&#33539;&#22260;&#65306;
<div class="figure"><a name="idp81497452"></a><p class="title"><b>&#22270; 107. &#20998;&#39057;&#22120;&#20998;&#36776;&#29575;&#33539;&#22260;</b></p><div class="figure-contents"><div><img src="images/time_pre.gif" alt="&#20998;&#39057;&#22120;&#20998;&#36776;&#29575;&#33539;&#22260;"></div></div></div><br class="figure-break">
</div>
<div class="sect3" title="18.6.2. PWM &#22810;&#36335;&#36873;&#25321;&#22120;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81498140"></a>18.6.2. PWM &#22810;&#36335;&#36873;&#25321;&#22120;</h4></div></div></div>
5&#20010;6&#36873;1&#22810;&#36335;&#36873;&#25321;&#22120;&#30340;&#36755;&#20837;&#38500;&#20102;&#26469;&#33258;&#20998;&#39057;&#22120;&#30340;5&#36335;&#20449;&#21495;&#22806;&#65292;&#36824;&#26377;&#19968;&#36335;&#26469;&#33258;XpwmECLK&#31649;&#33050;&#25552;&#20379;&#30340;&#22806;&#37096;&#26102;&#38047;&#20449;&#21495;&#12290;&#36890;&#36807;TCFG1&#23492;&#23384;&#22120;&#21487;&#20197;&#37197;&#32622;&#23427;&#20204;&#30340;&#21442;&#25968;&#12290; TCFG1&#20351;&#29992;&#27599;4&#20301;&#25511;&#21046;&#36873;&#25321;&#22120;&#30340;&#36755;&#20986;&#12290;
<pre class="programlisting">
[3:0]		MUX0
[7:4]		MUX1
[11:8]		MUX2
[15:12]		MUX3
[19:16]		MUX4
[3:0]		MUX5
</pre>
&#20854;&#20013;&#36825;&#20123;&#20301;&#30340;&#20540;&#21482;&#25509;&#21463;&#22914;&#19979;&#35774;&#32622;&#65306;
<pre class="programlisting">
&#20540;	&#36873;&#25321;&#20449;&#21495;			DMA&#36890;&#36947;&#36873;&#25321;([23:20])
0000	1/1			&#26080;&#36873;&#25321;
0001	1/2			INT0
0010	1/4			INT1
0011	1/8			INT2
0100	1/16			INT3
0101	TCLK&#22806;&#37096;&#26102;&#38047;			INT4
</pre>
TCFG1&#30340;[31:24]&#20301;&#20445;&#30041;&#65292;[23:20]&#20301;&#29992;&#26469;&#25511;&#21046;DMA&#35831;&#27714;&#36890;&#36947;&#12290;
</div>
<div class="sect3" title="18.6.3. &#23450;&#26102;&#22120;&#20013;&#26029;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81499788"></a>18.6.3. &#23450;&#26102;&#22120;&#20013;&#26029;</h4></div></div></div>
&#27599;&#20010;&#23450;&#26102;&#22120;&#22312;&#35745;&#25968;&#33267;0&#21518;&#65292;&#37117;&#21487;&#20197;&#21457;&#20986;&#20013;&#26029;&#35831;&#27714;&#12290;&#23427;&#20204;&#23545;&#24212;&#21040;&#20013;&#26029;&#25511;&#21046;&#22120;&#21644;&#20013;&#26029;&#21495;&#22914;&#19979;&#25152;&#31034;&#65306;
<pre class="programlisting">
&#20013;&#26029;&#21495;	&#20013;&#26029;&#28304;		&#32452;
23	INT_ TIMER0 VIC0
24	INT_ TIMER1 VIC0
25	INT_ TIMER2 VIC0
27	INT_ TIMER3 VIC0
28	INT_ TIMER4 VIC0
</pre>
&#23450;&#26102;&#22120;&#20013;&#26029;&#25511;&#21046;&#21644;&#29366;&#24577;&#23492;&#23384;&#22120;TINT_CSTAT&#29992;&#26469;&#37197;&#32622;PWM&#23450;&#26102;&#22120;&#30340;&#20013;&#26029;&#24320;&#20851;&#65292;&#20197;&#21450;&#28165;&#38500;&#20013;&#26029;&#29366;&#24577;&#20301;&#12290;
<pre class="programlisting">
TINT_CSTAT                  &#20301;    &#35835;/&#20889;    &#25551;&#36848;                &#21021;&#22987;&#29366;&#24577;
Reserved                 [31:10]    &#35835;    &#20445;&#30041;&#20301;                0x00000
Timer 4 Interrupt Status [9]      &#35835;/&#20889;  &#23450;&#26102;&#22120;4 &#20013;&#26029;&#29366;&#24577;&#20301;&#12290;
                                        &#36890;&#36807;&#20889;&#8216;1&#8217;&#28165;&#38500;&#35813;&#20301;       0x0
/*[8/7/6/5] &#20998;&#21035;&#23545;&#24212;&#23450;&#26102;&#22120;3/2/1/0*/
Timer 4 interrupt Enable [4]      &#35835;/&#20889;  &#23450;&#26102;&#22120;4 &#20013;&#26029;&#21551;&#21160;&#12290;
                                         1&#65306;&#21551;&#21160; 0&#65306;&#31105;&#27490;        0x0
/*[3/2/1/0] &#20998;&#21035;&#23545;&#24212;&#23450;&#26102;&#22120;3/2/1/0*/
</pre>
&#21478;&#22806;&#22914;&#26524;&#35201;&#22312;&#20013;&#26029;&#25511;&#21046;&#22120;&#25509;&#25910;&#21040;&#36825;&#20123;&#20013;&#26029;&#35831;&#27714;&#21017;&#38656;&#35201;&#24320;&#21551;&#20013;&#26029;&#21495;&#23545;&#24212;&#30340;&#20013;&#26029;&#20351;&#33021;&#20301;&#12290;&#20013;&#26029;&#20351;&#33021;&#23492;&#23384;&#22120;VICINTENABLE&#23436;&#25104;&#35813;&#37197;&#32622;&#65292;&#20854;&#20013;&#27809;&#19968;&#20301;&#23545;&#24212;&#30456;&#24212;&#30340;&#20013;&#26029;&#21495;&#12290;&#20294;&#26159;&#23545;&#20013;&#26029;&#30340;&#28165;&#38500;&#38656;&#35201;&#36890;&#36807;VICINTENCLEAR &#23492;&#23384;&#22120;&#29992;&#26469;&#28165;&#38500;&#20013;&#26029;&#20351;&#33021;&#12290;&#35814;&#24773;&#21442;&#32771;&#20013;&#26029;&#31456;&#33410;&#12290;
<pre class="programlisting">
&#23492;&#23384;&#22120;            &#22320;&#22336;    &#35835;/&#20889;       &#25551;&#36848;             &#22797;&#20301;&#20540;
VIC0INTENABLE 0x7120_0010 &#35835;/&#20889; &#20013;&#26029;&#20351;&#33021;&#23492;&#23384;&#22120;(VIC0) 0x0000_0000
VIC1INTENABLE 0x7130_0010 &#35835;/&#20889; &#20013;&#26029;&#20351;&#33021;&#23492;&#23384;&#22120;(VIC1) 0x0000_0000
</pre>
</div>
<div class="sect3" title="18.6.4. &#23450;&#26102;&#22120;&#35774;&#32622;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81502700"></a>18.6.4. &#23450;&#26102;&#22120;&#35774;&#32622;</h4></div></div></div>
<p>
&#23545;&#23450;&#26102;&#22120;&#30340;&#35774;&#32622;&#26159;&#23545;PWM&#25805;&#20316;&#30340;&#26680;&#24515;&#65292;&#36890;&#36807;&#37197;&#32622;&#36923;&#36753;&#25511;&#21046;&#30005;&#36335;&#21442;&#25968;&#65292;&#21487;&#20197;&#25913;&#21464;&#23450;&#26102;&#22120;&#30340;&#23450;&#26102;&#21608;&#26399;&#12290;&#38500;&#23450;&#26102;&#22120;4&#20197;&#22806;&#65292;&#27599;&#20010;&#36923;&#36753;&#25511;&#21046;&#30005;&#36335;&#37117;&#21253;&#21547;&#21253;&#25324;TCNTBn, TCNTn, TCMPBn&#21644;TCMPn&#22235;&#20010;&#23492;&#23384;&#22120;&#12290;&#21253;&#21547;B&#30340;&#23492;&#23384;&#22120;&#20026;&#23450;&#26102;&#22120;&#35745;&#25968;&#32531;&#20914;&#23492;&#23384;&#22120;&#65292;&#21487;&#34987;&#22806;&#37096;&#25805;&#20316;&#65292;&#19981;&#21547;B&#30340;&#23492;&#23384;&#22120;&#20026;&#20869;&#37096;&#23492;&#23384;&#22120;&#65292;&#19981;&#21487;&#30452;&#25509;&#25805;&#20316;&#12290;&#24403;&#23450;&#26102;&#22120;&#20498;&#35745;&#26102;&#20026;0&#26102;&#65292;TCNTn&#20026;0&#65292;&#22914;&#26524;&#24320;&#22987;&#20102;&#33258;&#21160;&#37325;&#35013;&#21151;&#33021;&#65292;TCNTBn&#21644;TCMPBn&#23558;&#34987;&#35013;&#20837;TCNTn&#21644;TCMPn&#23492;&#23384;&#22120;&#12290;&#21478;&#22806;&#22914;&#26524;&#20013;&#26029;&#20449;&#21495;&#21551;&#21160;&#65292;&#21017;&#23558;&#20135;&#29983;&#20013;&#26029;&#35831;&#27714;&#12290;
</p>
PWM&#23450;&#26102;&#22120;&#26377;&#20004;&#31181;&#24037;&#20316;&#27169;&#24335;&#65306;&#33258;&#21160;&#37325;&#26032;&#36733;&#20837;&#27169;&#24335;&#65307;&#19968;&#27425;&#35302;&#21457;&#33033;&#20914;&#27169;&#24335;&#12290;&#22312;&#35774;&#32622;&#23436;B&#23492;&#23384;&#22120;&#21518;&#65292;&#22914;&#26524;&#35774;&#32622;&#25163;&#21160;&#26356;&#26032;&#20026;1&#65292;&#23545;&#24212;&#20869;&#37096;&#23492;&#23384;&#22120;&#31435;&#21363;&#35013;&#36733;&#65292;&#21542;&#21017;&#21482;&#26377;&#22312;&#35813;&#21608;&#26399;&#23436;&#25104;&#21518;&#25165;&#20250;&#35013;&#36733;&#12290;
<div class="figure"><a name="idp81504004"></a><p class="title"><b>&#22270; 108. &#23450;&#26102;&#22120;&#35013;&#36733;</b></p><div class="figure-contents"><div><img src="images/time_load.gif" alt="&#23450;&#26102;&#22120;&#35013;&#36733;"></div></div></div><br class="figure-break">
&#23545;&#20110;&#19978;&#22270;&#20013;&#30340;&#35774;&#32622;&#65292;&#35299;&#37322;&#22914;&#19979;&#65306;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">1.&#35774;&#32622;TCNTBn=3&#65292;TCMPBn=1&#12290;</li><li class="listitem">2.&#35774;&#32622;&#33258;&#21160;&#35013;&#36733;(auto-reload)=1&#65292;&#25163;&#21160;&#26356;&#26032;(manual update)=1&#12290;&#24403;&#35774;&#32622;&#25163;&#21160;&#26356;&#26032;&#20026;1&#26102;&#65292;TCNTBn&#21644;TCMPBn&#23558;&#34987;&#35013;&#36733;&#21040;TCNTn&#21644;TCMPn&#12290;</li><li class="listitem">3.&#35774;&#32622;TCNTBn=2&#65292;TCMPBn=0&#12290;&#19979;&#19968;&#20010;&#35745;&#26102;&#21608;&#26399;&#23558;&#20351;&#29992;&#35813;&#21442;&#25968;&#12290;</li><li class="listitem">4.&#35774;&#32622;&#33258;&#21160;&#35013;&#36733;(auto-reload)=1&#65292;&#25163;&#21160;&#26356;&#26032;(manual update)=0&#12290;
&#22914;&#26524;&#22312;&#27492;&#26102;&#35774;&#32622;manual update=1, TCNTn&#23558;&#34987;&#30452;&#25509;&#25913;&#20026;2&#65292;TCMPn&#20063;&#23558;&#34987;&#25913;&#20026;0&#12290;
&#20013;&#26029;&#23558;&#22312;2&#20010;&#21608;&#26399;&#21518;&#20135;&#29983;&#65292;&#32780;&#38750;3&#20010;&#21608;&#26399;&#21518;&#20102;&#12290;
&#21478;&#22806;&#24517;&#39035;&#35774;&#32622;&#33258;&#21160;&#35013;&#36733;(auto-reload=1)&#65292;&#21542;&#21017;&#22312;&#24403;&#21069;&#21608;&#26399;&#35745;&#25968;&#23436;&#21518;&#65292;&#21018;&#21018;&#35774;&#32622;&#30340;TCNTBn=2&#23558;&#19981;&#36215;&#20316;&#29992;&#12290;</li><li class="listitem">5.&#35774;&#32622;&#35813;&#35745;&#26102;&#22120;&#30340;start=1&#24320;&#22987;&#35745;&#26102;&#12290;TCNTn&#30340;&#20540;&#23558;&#36882;&#20943;&#12290;&#24403;TCNTn&#30340;&#20540;&#36882;&#20943;&#21040;TCMPn&#26102;&#65292;TOUTn&#36755;&#20986;&#30340;&#30005;&#24179;&#23558;&#21457;&#29983;&#36339;&#21464;&#65292;&#32780;&#24403;TCNTn&#20026;0&#26102;&#65292;&#20135;&#29983;&#20013;&#26029;&#12290;&#22914;&#26524;auto-reload&#65292;&#37325;&#26032;&#20174;B&#23492;&#23384;&#22120;&#35013;&#36733;&#65292;&#32487;&#32493;&#35745;&#26102;&#24490;&#29615;&#12290;</li><li class="listitem">6.&#22312;&#35745;&#26102;&#22120;&#34987;&#20572;&#27490;&#20043;&#21069;&#65292;TCNTn&#21608;&#32780;&#22797;&#22987;&#30340;&#35013;&#36733;&#21644;&#36882;&#20943;&#12290;</li></ul></div>
&#23545;&#23492;&#23384;&#22120;&#30340;&#24320;&#21551;&#65292;&#21644;&#33258;&#21160;&#35013;&#36733;&#21644;&#25163;&#21160;&#26356;&#26032;&#30340;&#37197;&#32622;&#22343;&#36890;&#36807;TCON&#23450;&#26102;&#25511;&#21046;&#23492;&#23384;&#22120;&#36827;&#34892;&#65306;
<pre class="programlisting">
TCON                          &#20301;    &#35835;/&#20889;        &#25551;&#36848;                            &#21021;&#22987;&#20540;
Reserved                   [31:23]   &#35835;          &#20445;&#30041;&#12290;                          0x000d
Timer 4 Auto Reload on/off  [22]    &#35835;/&#20889;   &#30830;&#23450;&#23450;&#26102;&#22120;4 &#30340;&#33258;&#21160;&#21152;&#36733;&#24320;/&#20851;&#12290;
                                            0 = One-shot 1 = &#38388;&#38548;&#27169;&#24335;(&#33258;&#21160;&#37325;&#36733;)  0x0
Timer 4 Manual Update(note) [21]    &#35835;/&#20889;   &#30830;&#23450;&#23450;&#26102;&#22120;4 &#30340;&#25163;&#21160;&#26356;&#26032;&#12290; 
                                            0 = &#26080;&#25805;&#20316; 1 = &#26356;&#26032; TCNTB4           0x0
Timer 4 Start/Stop          [20]    &#35835;/&#20889;   &#30830;&#23450;&#23450;&#26102;&#22120;4 &#30340;&#21551;&#21160;/&#20572;&#27490;&#12290;
                                            0 = &#20572;&#27490; 1 = &#24320;&#22987;&#23450;&#26102;&#22120;4             0x0
/* for 3/2/1 */
Reserved                    [7:5]   &#35835;/&#20889;        &#20445;&#30041;&#12290;                          0x0
Dead Zone Enable            [4]     &#35835;/&#20889;   &#30830;&#23450;&#27515;&#21306;&#30340;&#25805;&#20316;&#12290;
                                            0 = &#31105;&#29992; 1 = &#20351;&#33021;                    0x0
/* for 0 */
</pre>
&#27880;&#24847;&#21040;TCON&#23492;&#23384;&#22120;&#36824;&#29992;&#26469;&#25511;&#21046;&#27515;&#21306;&#30340;&#20351;&#33021;&#12290;
</div>
<div class="sect3" title="18.6.5. &#23450;&#26102;&#22120;&#33033;&#23485;&#35843;&#21046;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81508716"></a>18.6.5. &#23450;&#26102;&#22120;&#33033;&#23485;&#35843;&#21046;</h4></div></div></div>
<p>
TCNTBn &#20915;&#23450;PWM&#30340;&#39057;&#29575;&#65292;TCMPBn &#21017;&#20915;&#23450;&#20102;PWM &#30340;&#20540;&#65292;&#25110;&#32773;&#35828;&#21344;&#31354;&#27604;&#12290;&#21344;&#31354;&#27604;(Duty Ratio)&#26159;&#25351;&#22312;&#19968;&#20018;&#29702;&#24819;&#30340;&#33033;&#20914;&#21608;&#26399;&#24207;&#21015;&#20013;&#65288;&#22914;&#26041;&#27874;&#65289;&#65292;&#27491;&#33033;&#20914;&#30340;&#25345;&#32493;&#26102;&#38388;&#19982;&#33033;&#20914;&#24635;&#21608;&#26399;&#30340;&#27604;&#20540;&#12290; &#22312;&#19981;&#21551;&#29992;&#36870;&#21464;&#22120;&#26102;&#65292;&#21344;&#31354;&#27604;&#30340;&#20540;&#20026;TCMPBn/TCNTBn&#12290;
</p><div class="figure"><a name="idp81509468"></a><p class="title"><b>&#22270; 109. &#21344;&#31354;&#27604;&#31034;&#24847;&#22270;</b></p><div class="figure-contents"><div><img src="images/time_dr.gif" alt="&#21344;&#31354;&#27604;&#31034;&#24847;&#22270;"></div></div></div><p><br class="figure-break">
</p><pre class="programlisting">
TCNTBn                   &#20301;   &#35835;/&#20889;     &#25551;&#36848;                        &#21021;&#22987;&#29366;&#24577;
Timer n Count Buffer   [31:0] &#35835;/&#20889; &#35774;&#32622;&#23450;&#26102;&#22120;0 &#30340;&#35745;&#25968;&#32531;&#20914;&#22120;&#30340;&#20540;&#12290; 0x00000000
TCMPBn
Timer n Compare Buffer [31:0] &#35835;/&#20889; &#35774;&#32622;&#23450;&#26102;&#22120;0 &#30340;&#27604;&#36739;&#32531;&#20914;&#22120;&#30340;&#20540;&#12290; 0x00000000
</pre><p>
&#23450;&#26102;&#22120;&#30340;&#24403;&#21069;&#35745;&#25968;&#22120;TCNTn&#20540;&#20174;TCNTOn&#23450;&#26102;&#22120;&#35745;&#25968;&#35266;&#23519;&#23492;&#23384;&#22120;&#20013;&#35835;&#21462;&#12290;&#22914;&#26524;&#35835;TCNTBn&#65292;&#36825;&#20010;&#20540;&#26159;&#19979;&#19968;&#20010;&#23450;&#26102;&#22120;&#30340;&#37325;&#36733;&#20540;&#19981;&#26159;&#24403;&#21069;&#35745;&#25968;&#22120;&#30340;&#29366;&#24577;&#12290;
</p><pre class="programlisting">
TCNTOn                      &#20301;   &#35835;/&#20889;     &#25551;&#36848;                        &#21021;&#22987;&#29366;&#24577;
Timer n Count Observation [31:0]   &#35835;  &#35774;&#32622;&#23450;&#26102;&#22120;1 &#35745;&#25968;&#35266;&#23519;&#23492;&#23384;&#22120;&#30340;&#20540; 0x00000000
</pre><p>
</p>
</div>
<div class="sect3" title="18.6.6. &#21551;&#21160;&#23450;&#26102;&#22120;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81511692"></a>18.6.6. &#21551;&#21160;&#23450;&#26102;&#22120;</h4></div></div></div>
<p>
&#30001;&#20110;TCNTn&#22312;&#23450;&#26102;&#22120;&#24320;&#22987;&#26102;&#24182;&#27809;&#26377;&#20540;&#65292;&#25152;&#20197;&#38656;&#35201;&#39318;&#20808;&#35774;&#32622;&#23427;&#12290;&#27492;&#26102;&#65292;&#24517;&#39035;&#24320;&#21551;&#25163;&#21160;&#26356;&#26032;&#20301;&#12290;&#37319;&#21462;&#30340;&#27493;&#39588;&#22914;&#19979;&#65306;
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#20889;&#20837;&#21021;&#22987;&#20540;&#21040;TCNTBn&#21644;TCMPBn&#20013;&#12290;</li><li class="listitem">&#35774;&#23450;&#24403;&#21069;&#23450;&#26102;&#22120;&#30340;&#25163;&#21160;&#26356;&#26032;&#20301;&#12290;</li><li class="listitem">&#26681;&#25454;&#38656;&#35201;&#35774;&#32622;&#36870;&#21464;&#22120;&#12290;</li><li class="listitem">&#35774;&#32622;&#30456;&#24212;&#23450;&#26102;&#22120;&#30340;&#36215;&#22987;&#20301;&#20197;&#21551;&#21160;&#23450;&#26102;&#22120;&#65292;&#26681;&#25454;&#38656;&#35201;&#28165;&#31354;&#25163;&#21160;&#26356;&#26032;&#20301;&#12290;</li></ul></div><p>
</p>
</div>
</div>
<div class="sect2" title="18.7. &#26102;&#38047;&#28304;&#21021;&#22987;&#21270;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81513708"></a>18.7. &#26102;&#38047;&#28304;&#21021;&#22987;&#21270;</h3></div></div></div>
<p>
&#30001;&#20110;S3C6410 CPU&#25317;&#26377;&#38750;&#24120;&#22797;&#26434;&#30340;PLL&#31995;&#32479;&#65292;&#20197;&#21450;&#20854;&#19979;&#23545;&#24212;&#30340;&#21508;&#31867;&#26102;&#38047;&#65292;&#20869;&#26680;&#23545;&#23427;&#30340;&#23450;&#26102;&#22120;&#30340;&#23454;&#29616;&#30456;&#23545;&#22797;&#26434;&#65292;&#30001;&#20110;&#35813;CPU&#27839;&#38761;&#20102;S3C24xx&#31995;&#21015;&#20197;&#21450;S3C6400 CPU&#30340;&#30828;&#20214;&#35774;&#35745;&#65292;&#22312;&#26102;&#38047;&#25511;&#21046;&#36825;&#26041;&#38754;&#26356;&#26159;&#22914;&#27492;&#65292;&#25152;&#20197;&#20869;&#26680;&#20195;&#30721;&#23545;&#30456;&#20851;&#39537;&#21160;&#36827;&#34892;&#20102;&#20849;&#29992;&#12290;&#19982;&#26102;&#38047;&#25511;&#21046;&#30456;&#20851;&#30340;&#20195;&#30721;&#20301;&#20110;&#20197;&#19979;&#20960;&#20010;&#30446;&#24405;&#20869;&#65306;
</p><pre class="programlisting">
arch/arm/
        |-plat-s3c/
        |-plat-s3c64xx/
        \-mach-s3c6410/
</pre><p>	
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">mach-s3c6410&#30446;&#24405;&#25918;&#32622;&#20102;&#19978;s3c6410&#29305;&#26377;&#30340;&#21021;&#22987;&#21270;&#20195;&#30721;&#65292;&#24182;&#19988;&#20063;&#26159;&#25152;&#26377;&#21021;&#22987;&#21270;&#20989;&#25968;&#30340;&#20837;&#21475;&#12290;</li><li class="listitem">plat-s3c64xx&#25552;&#20379;&#20102;s3c64xx&#31995;&#21015;&#20849;&#29992;&#30340;&#20195;&#30721;&#12290;</li><li class="listitem">plat-s3c&#21017;&#26159;&#20174;&#26356;&#39640;&#23618;&#27425;&#23553;&#35013;&#20102;s3c&#31995;&#21015;&#30340;&#20849;&#29992;&#20195;&#30721;&#12290;</li></ul></div><p>
&#20174;&#20197;&#19978;&#30446;&#24405;&#21487;&#20197;&#30475;&#20986;&#65292;&#23545;&#20110;&#20849;&#29992;&#30340;&#20195;&#30721;&#35843;&#29992;&#27969;&#31243;&#36890;&#24120;&#20174;mach-s3c6410&#24320;&#22987;&#65292;&#28982;&#21518;&#32463;&#36807;&#26368;&#39640;&#23618;&#30340;plat-s3c&#23553;&#35013;&#65292;&#26368;&#32456;&#21040;&#36798;plat-s3c64xx&#12290;&#23545;&#20110;&#23450;&#26102;&#22120;&#26469;&#35828;&#65292;&#20195;&#30721;&#27969;&#31243;&#22914;&#19979;&#25152;&#31034;&#65306;
</p><pre class="programlisting">
paging_init--&gt;devicemaps_init--&gt;mdesc-&gt;map_io
</pre><p>
</p><div class="figure"><a name="idp81516644"></a><p class="title"><b>&#22270; 110. &#20869;&#26680;&#23450;&#26102;&#22120;&#23454;&#29616;</b></p><div class="figure-contents"><div><img src="images/time_call.gif" alt="&#20869;&#26680;&#23450;&#26102;&#22120;&#23454;&#29616;"></div></div></div><p><br class="figure-break">
&#20301;&#20110;MACHINE_START&#21644;MACHINE_END&#23439;&#23450;&#20041;&#20102;&#19968;&#20010;struct machine_desc&#32467;&#26500;&#65292;&#20854;&#25104;&#21592;&#28085;&#30422;&#20102;&#19968;&#20010;&#8220;&#26426;&#22120;&#8221;&#25152;&#26377;&#30340;&#21021;&#22987;&#21270;&#20195;&#30721;&#12290;&#32780;&#27880;&#20876;&#26102;&#38047;&#30340;&#20989;&#25968;&#36890;&#24120;&#19981;&#35268;&#33539;&#30340;&#25918;&#32622;&#22312;io_map&#20989;&#25968;&#25351;&#38024;&#25351;&#21521;&#30340;&#20989;&#25968;&#20013;&#65292;&#36825;&#37324;&#23601;&#26159;smdk6410_map_io&#12290;
</p><pre class="programlisting">
MACHINE_START(SMDK6410, "SMDK6410")
  ......
	.init_irq	= s3c6410_init_irq,
	.map_io		= smdk6410_map_io,
	.init_machine	= smdk6410_machine_init,
	.timer		= &amp;s3c64xx_timer,
MACHINE_END
</pre><p>
s3c24xx_init_clocks&#23601;&#26159;&#30495;&#27491;&#30340;&#21021;&#22987;&#21270;&#20837;&#21475;&#65292;&#26174;&#28982;S3C6410&#37325;&#29992;&#20102;S3C24xx&#30340;&#26102;&#38047;&#27880;&#20876;&#20195;&#30721;&#12290;
</p><pre class="programlisting">
arch/arm/mach-s3c6410/mach-smdk6410.c

static void __init smdk6410_map_io(void)
{
	......
	s3c64xx_init_io(smdk6410_iodesc, ARRAY_SIZE(smdk6410_iodesc));
	s3c24xx_init_clocks(12000000);
	......
}
</pre><p>
&#35813;&#20989;&#25968;xtal&#21442;&#25968;&#29992;&#26469;&#25351;&#23450;PLL&#26230;&#25391;&#28304;&#30340;&#39057;&#29575;&#12290;&#22914;&#26524;xtal&#20026;0&#65292;&#21017;&#20351;&#29992;&#40664;&#35748;&#20540;12MHz&#65292;&#21542;&#21017;&#20351;&#29992;&#25351;&#23450;&#30340;&#39057;&#20540;&#12290;
</p><pre class="programlisting">
arch/arm/plat-s3c/init.c

void __init s3c24xx_init_clocks(int xtal)
{
	if (xtal == 0)
		xtal = 12*1000*1000;

	if (cpu-&gt;init_clocks == NULL)
		panic("s3c24xx_init_clocks: cpu has no clock init\n");
	else
		(cpu-&gt;init_clocks)(xtal);
}
</pre><p>
&#20026;&#20102;&#22797;&#29992;&#20195;&#30721;&#65292;&#21516;&#26102;&#25903;&#25345;&#22810;&#20010;S3C64xx&#31995;&#21015;&#30340;CPU&#65292;&#20869;&#26680;&#23450;&#20041;&#20102;struct cpu_table&#32467;&#26500;&#23545;&#19981;&#21516;&#30340;CPU&#26550;&#26500;&#30340;&#21021;&#22987;&#21270;&#20195;&#30721;&#36827;&#34892;&#20102;&#23553;&#35013;&#65306;
</p><pre class="programlisting">
arch/arm/plat-s3c64xx/cpu.c

static const char name_s3c6400[] = "S3C6400";
static const char name_s3c6410[] = "S3C6410";
static struct cpu_table cpu_ids[] __initdata = {
	{
	  .init_clocks	= s3c6400_init_clocks,
    ......
		.name		= name_s3c6400,
	}, {
		.init_clocks	= s3c6410_init_clocks,
		......
		.name		= name_s3c6410,
	},
};
</pre><p>
&#21487;&#20197;&#30475;&#21040;S3C6410&#23545;&#24212;&#30340;init_clocks&#36716;&#21521;&#20102;&#38024;&#23545;&#35813;CPU&#30340;&#26102;&#38047;&#21021;&#22987;&#21270;&#20989;&#25968;s3c6410_init_clocks&#12290;&#23427;&#23601;&#26159;&#25152;&#26377;&#26102;&#38047;&#21021;&#22987;&#21270;&#30340;&#23553;&#35013;&#20989;&#25968;&#12290;
</p><pre class="programlisting">
void __init s3c6410_init_clocks(int xtal)
{
	s3c24xx_register_baseclocks(xtal);
	s3c64xx_register_clocks();
	s3c6400_register_clocks();
	s3c6400_setup_clocks();
#ifdef CONFIG_HAVE_PWM
	s3c24xx_pwmclk_init();
#endif
}
</pre><p>
</p>
<div class="sect3" title="18.7.1. &#26102;&#38047;&#27880;&#20876;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81521164"></a>18.7.1. &#26102;&#38047;&#27880;&#20876;</h4></div></div></div>
&#20174;&#20989;&#25968;&#35843;&#29992;&#22270;&#21487;&#20197;&#30475;&#20986;&#65292;&#26080;&#35770;&#26159;&#21738;&#19968;&#20010;&#21517;&#23383;&#21547;register&#30340;&#20989;&#25968;&#65292;&#23427;&#20204;&#26368;&#32456;&#37117;&#26159;&#35843;&#29992;&#30340;s3c24xx_register_clock&#12290;
<pre class="programlisting">
arch/arm/plat-s3c/clock.c
int s3c24xx_register_clock(struct clk *clk)
{
	clk-&gt;owner = THIS_MODULE;

	if (clk-&gt;enable == NULL)
		clk-&gt;enable = clk_null_enable;
  ......
	spin_lock(&amp;clocks_lock);
	list_add(&amp;clk-&gt;list, &amp;clocks);
	spin_unlock(&amp;clocks_lock);

	return 0;
}
</pre>
&#35813;&#20989;&#25968;&#30340;&#21442;&#25968;&#20026;struct clk&#32467;&#26500;&#20307;&#65292;&#22312;&#22823;&#22810;&#25968;&#20307;&#31995;&#26550;&#26500;&#19978;&#37117;&#23384;&#22312;&#35813;&#32467;&#26500;&#65292;&#21482;&#26159;&#26681;&#25454;&#30828;&#20214;&#26102;&#38047;&#31995;&#32479;&#30340;&#22797;&#26434;&#24230;&#65292;&#23427;&#30340;&#25104;&#21592;&#30340;&#22810;&#23569;&#20063;&#19981;&#21516;&#12290;&#35813;&#20989;&#25968;&#21482;&#26159;&#23558;clk&#21442;&#25968;&#25918;&#20837;&#21517;&#20026;clocks&#30340;&#38142;&#34920;&#20013;&#30340;&#34920;&#22836;&#65292;&#23427;&#21463;clocks_lock&#20445;&#25252;&#12290;
<pre class="programlisting">
arch/arm/plat-s3c/clock.c
static LIST_HEAD(clocks);
DEFINE_SPINLOCK(clocks_lock);
</pre>
&#27880;&#24847;&#21040;&#35813;&#32467;&#26500;&#30001;SPIN&#38145;&#38145;&#23450;&#65292;&#25152;&#31034;&#35813;&#32467;&#26500;&#20307;&#26159;CPU&#20844;&#29992;&#30340;&#65292;&#20063;&#21363;&#31995;&#32479;&#20013;&#30340;&#26102;&#38047;&#22343;&#32479;&#19968;&#25918;&#22312;&#35813;&#38142;&#34920;&#20869;&#31649;&#29702;&#12290;
<pre class="programlisting">
arch/arm/plat-s3c/include/plat/clock.c
struct clk {
	struct list_head      list;
	struct module        *owner;
	struct clk           *parent;
	const char           *name;
	int		      id;
	int		      usage;
	unsigned long         rate;
	unsigned long         ctrlbit;

	int		    (*enable)(struct clk *, int enable);
	int		    (*set_rate)(struct clk *c, unsigned long rate);
	unsigned long	    (*get_rate)(struct clk *c);
	unsigned long	    (*round_rate)(struct clk *c, unsigned long rate);
	int		    (*set_parent)(struct clk *c, struct clk *parent);
};
</pre>
clk&#32467;&#26500;&#20307;&#22312;S3C6410 CPU&#30340;&#23454;&#29616;&#19978;&#35201;&#30456;&#23545;&#22797;&#26434;&#65292;&#20854;&#20013;&#25552;&#20379;&#20102;&#26102;&#38047;&#20351;&#33021;&#65292;&#36895;&#29575;&#35774;&#23450;&#31561;&#30456;&#20851;&#20989;&#25968;&#25351;&#38024;&#65292;&#23545;&#20110;&#19968;&#20123;&#31616;&#21333;&#30340;CPU&#21017;&#27809;&#26377;&#22914;&#27492;&#22797;&#26434;&#12290;&#36890;&#36807;s3c24xx_register_clock&#20869;&#26680;&#27880;&#20876;&#20102;&#23558;&#36817;70&#20010;struct clk&#32467;&#26500;&#20307;&#65292;&#20294;&#26159;&#24182;&#27809;&#26377;&#21551;&#29992;&#23427;&#20204;&#65292;&#22312;&#25509;&#19979;&#26469;&#30340;&#26102;&#38047;&#21551;&#29992;&#20013;&#21482;&#26377;&#37096;&#20998;&#26102;&#38047;&#20250;&#34987;&#21551;&#29992;&#12290;
<p>
s3c64xx_register_clocks&#20989;&#25968;&#27880;&#20876;&#20102;&#20004;&#31867;&#26102;&#38047;&#65292;&#23427;&#20204;&#20998;&#21035;&#23450;&#20041;&#22312;&#25968;&#32452;init_clocks&#21644;init_clocks_disable&#20013;&#65292;init_clocks&#40664;&#35748;&#23601;&#26159;&#21551;&#29992;&#30340;&#65292;&#32780;init_clocks_disable&#20013;&#30340;&#23450;&#26102;&#22120;&#21017;&#38656;&#35201;&#21021;&#22987;&#21270;&#26102;&#26174;&#31034;&#35843;&#29992;clk&#30340;enable&#25104;&#21592;&#20989;&#25968;&#12290;&#20854;&#20013;init_clocks&#20013;&#25552;&#20379;&#20102;PWM&#23450;&#26102;&#30340;&#23450;&#20041;&#65306;
</p><pre class="programlisting">
{
  .name           = "timers",
  .id             = -1,
  .parent         = &amp;clk_p,
  .enable         = s3c64xx_pclk_ctrl,
  .ctrlbit        = S3C_CLKCON_PCLK_PWM,
},
</pre><p>
</p>
</div>
<div class="sect3" title="18.7.2. &#26102;&#38047;&#21551;&#29992;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81525420"></a>18.7.2. &#26102;&#38047;&#21551;&#29992;</h4></div></div></div>
&#30456;&#23545;&#20110;&#26102;&#38047;&#30340;&#27880;&#20876;&#65292;&#26102;&#38047;&#30340;&#20351;&#33021;&#21482;&#20351;&#29992;&#20102;&#19968;&#20010;&#20989;&#25968;s3c6400_setup_clocks&#26469;&#23436;&#25104;&#65306;
<pre class="programlisting">
arch/arm/plat-s3c64xx/s3c6400-clock.c
void __init_or_cpufreq s3c6400_setup_clocks(void)
{
  ......
	clkdiv0 = __raw_readl(S3C_CLK_DIV0);
</pre>
&#23613;&#31649;&#22312;Bootloader&#20869;&#21644;&#31995;&#32479;&#30340;&#26089;&#26399;&#38454;&#27573;&#65292;&#21487;&#20197;&#30452;&#25509;&#23545;&#30828;&#20214;&#22320;&#22336;&#36827;&#34892;&#25805;&#20316;&#65292;&#20294;&#26159;&#22312;&#20869;&#23384;&#31649;&#29702;&#23376;&#31995;&#32479;&#21021;&#22987;&#21270;&#21518;&#65292;&#22343;&#26159;&#36890;&#36807;&#34394;&#22320;&#22336;&#26469;&#23436;&#25104;&#25805;&#20316;&#30340;&#12290;&#25152;&#20197;&#36825;&#37324;&#30340;S3C_CLK_DIV0&#26159;&#34394;&#25511;&#22320;&#22336;&#12290;smdk6410_map_io&#22312;&#21021;&#22987;&#21270;&#26102;&#38047;&#20989;&#25968;&#21069;&#65292;&#39318;&#20808;&#35843;&#29992;&#20102;s3c64xx_init_io&#65292;&#22312;&#35813;&#20989;&#25968;&#20013;&#23436;&#25104;&#20102;&#23454;&#34394;&#22320;&#22336;&#30340;&#26144;&#23556;&#36807;&#31243;&#12290;&#32780;&#26102;&#38047;&#25511;&#21046;&#23492;&#23384;&#22120;&#26159;&#31995;&#32479;&#25511;&#21046;&#23492;&#23384;&#22120;&#30340;&#19968;&#37096;&#20998;&#65292;&#25152;&#20197;&#20854;&#34394;&#22320;&#22336;&#20301;&#20110;S3C_VA_SYS&#20043;&#21518;&#30340;4K&#26144;&#23556;&#21306;&#20869;&#12290;0x7E00F000~0x7E00FFFF&#29992;&#20110;&#31995;&#32479;&#25511;&#21046;&#22120;&#12290;
<pre class="programlisting">
#define S3C64XX_PA_SYSCON       (0x7E00F000)

arch/arm/mach-s3c6410/mach-smdk6410.c
static struct map_desc s3c_iodesc[] __initdata = {
	{
		.virtual	= (unsigned long)S3C_VA_SYS,
		.pfn		= __phys_to_pfn(S3C64XX_PA_SYSCON),
		.length		= SZ_4K,
		.type		= MT_DEVICE,
	}, {
......
</pre>
&#26102;&#38047;&#25511;&#21046;&#23492;&#23384;&#22120;&#30340;&#34394;&#22320;&#22336;&#23450;&#20041;&#22914;&#19979;&#12290;
<pre class="programlisting">
arch/arm/plat-s3c64xx/include/plat/regs-clock.h
#define S3C_CLKREG(x)		(S3C_VA_SYS + (x))
......
#define S3C_CLK_SRC		  S3C_CLKREG(0x1C)
#define S3C_CLK_SRC2    S3C_CLKREG(0x10C)
#define S3C_CLK_DIV0		S3C_CLKREG(0x20)
#define S3C_CLK_DIV1		S3C_CLKREG(0x24)
#define S3C_CLK_DIV2		S3C_CLKREG(0x28)
#define S3C_CLK_OUT		  S3C_CLKREG(0x2C)&#12289;
......
</pre>
&#20197;&#19978;&#34394;&#25311;&#22320;&#22336;&#30340;&#23450;&#20041;&#19982;&#29289;&#29702;&#22320;&#22336;&#30340;&#23450;&#20041;&#26159;&#20445;&#25345;&#26144;&#23556;&#19968;&#33268;&#30340;&#12290;
<pre class="programlisting">
&#23492;&#23384;&#22120;        &#22320;&#22336;    &#35835;/&#20889;         &#25551;&#36848;           &#22797;&#20301;&#20540;
......
CLK_SRC  0x7E00_F01C  &#35835;/&#20889; &#36873;&#25321;&#26102;&#38047;&#28304;&#12290;          0x0000_0000
CLK_DIV0 0x7E00_F020 &#35835;/&#20889; &#35774;&#32622;&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290; 0x0105_1000
CLK_DIV1 0x7E00_F024 &#35835;/&#20889; &#35774;&#32622;&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290; 0x0000_0000
CLK_DIV2 0x7E00_F028 &#35835;/&#20889; &#35774;&#32622;&#26102;&#38047;&#20998;&#39057;&#22120;&#30340;&#27604;&#20363;&#12290; 0x0000_0000
CLK_OUT  0x7E00_F02C &#35835;/&#20889; &#36873;&#25321;&#26102;&#38047;&#36755;&#20986;&#12290;         0x0000_0000
......
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#39318;&#20808;&#35835;&#21462;S3C_CLK_DIV0&#23384;&#20837;clkdiv0&#12290;</li><li class="listitem">clk_get&#36890;&#36807;&#26102;&#38047;&#21517;&#31216;&#26469;&#26597;&#25214;clocks&#38142;&#34920;&#65292;&#24182;&#36820;&#22238;struct clk&#32467;&#26500;&#25351;&#38024;&#12290;</li><li class="listitem">clk_get_rate&#21017;&#36890;&#36807;struct clk&#25351;&#38024;&#25552;&#20379;&#30340;&#21442;&#25968;&#36820;&#22238;clk-&gt;rate&#65292;&#22914;&#26524;&#35813;&#20540;&#20026;0&#65292;&#21017;&#23581;&#35797;&#35745;&#31639;clk-&gt;get_rate&#24182;&#36820;&#22238;&#65292;&#21542;&#21017;&#26377;&#29238;&#33410;&#28857;&#65292;&#21017;&#36820;&#22238;parent&#30340;&#39057;&#29575;&#20540;&#65292;&#21542;&#21017;&#36820;&#22238;0&#12290;</li><li class="listitem">clk_put&#35843;&#29992;module_put&#20197;&#22686;&#21152;clk-&gt;owner&#30340;&#24341;&#29992;&#20540;&#65292;&#21482;&#26377;&#35813;&#26102;&#38047;&#36890;&#36807;&#27169;&#22359;&#26041;&#24335;&#21152;&#36733;&#26102;&#25165;&#20250;&#36827;&#34892;&#27492;&#27493;&#25805;&#20316;&#12290;</li></ul></div>
<pre class="programlisting">
	xtal_clk = clk_get(NULL, "xtal");

	xtal = clk_get_rate(xtal_clk);
	clk_put(xtal_clk);
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">s3c6400_get_epll&#36890;&#36807;xtal&#26102;&#38047;&#25552;&#20379;&#30340;&#39057;&#29575;&#20540;(&#36890;&#24120;&#20026;12MHz)&#35745;&#31639;EPLL&#30340;&#36755;&#20986;&#39057;&#29575;&#12290;&#36825;&#37324;&#31995;&#32479;&#25552;&#20379;&#20102;PLL&#25511;&#21046;&#22120;S3C_EPLL_CON0&#21644;S3C_EPLL_CON1&#65292;&#20174;S3C_EPLL_CON0&#35745;&#31639;&#20986;mdiv&#65292;pdiv&#21644;sdiv&#20540;&#12290;&#20174;S3C_EPLL_CON1&#35745;&#31639;&#20986;kdiv&#12290;&#26681;&#25454;&#36825;&#22235;&#20010;&#21442;&#25968;&#28982;&#21518;&#26681;&#25454;&#20844;&#24335;Fout = (MDIV + KDIV / 2^16) * Fin / (PDIV * 2^SDIV)&#35745;&#31639;&#20986;EPLL&#30340;&#36755;&#20986;&#39057;&#29575;&#12290;</li><li class="listitem">s3c6400_get_pll&#21017;&#26681;&#25454;&#20844;&#24335;Fout = MDIV * Fin / (PDIV * 2SDIV)&#26469;&#35745;&#31639;&#20986;mpll&#21644;apll&#30340;&#36755;&#20986;&#39057;&#29575;&#12290;</li><li class="listitem">&#36890;&#36807;clkdiv0&#33719;&#21462;CLK_DIV0&#23492;&#23384;&#22120;&#30340;&#20540;&#65292;&#28982;&#21518;GET_DIV&#33719;&#21462;S3C6410_CLKDIV0_ARM_MASK&#25351;&#23450;&#30340;ARM_RATIO&#23383;&#27573;&#65292;&#25152;&#20197;fclk&#25165;&#26159;&#30495;&#27491;&#30340;CPU&#20027;&#39057;&#12290;</li></ul></div>
<pre class="programlisting">
#define GET_DIV(clk, field) ((((clk) &amp; field##_MASK) &gt;&gt; field##_SHIFT) + 1)

	epll = s3c6400_get_epll(xtal);
	mpll = s3c6400_get_pll(xtal, __raw_readl(S3C_MPLL_CON));
	apll = s3c6400_get_pll(xtal, __raw_readl(S3C_APLL_CON));

	fclk = apll / GET_DIV(clkdiv0, S3C6410_CLKDIV0_ARM);
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#26597;&#30475;S3C_OTHERS&#23492;&#23384;&#22120;&#30340;S3C_OTHERS_SYNCMUXSEL_SYNC&#20301;&#65292;&#26597;&#30475;&#24403;&#21069;&#31995;&#32479;SYNCMUX&#26102;&#38047;&#28304;&#26159;apll&#36824;&#26159;mpll&#12290;</li><li class="listitem">&#26681;&#25454;&#26102;&#38047;&#28304;&#35745;&#31639;&#21644;S3C6400_CLKDIV0_HCLK2&#35745;&#31639;&#20986;HCLKx2&#12290;</li><li class="listitem">&#26368;&#21518;&#26681;&#25454;hclkx2&#21644;HCLK&#65292;PCLK&#30340;&#20998;&#39057;&#65292;&#35745;&#31639;&#20986;hclk&#21644;pclk&#12290;</li></ul></div>
<pre class="programlisting">
	if(__raw_readl(S3C_OTHERS) &amp; S3C_OTHERS_SYNCMUXSEL_SYNC) {
		/* Synchronous mode */
		hclkx2 = apll / GET_DIV(clkdiv0, S3C6400_CLKDIV0_HCLK2);
	} else {
		/* Asynchronous mode */
		hclkx2 = mpll / GET_DIV(clkdiv0, S3C6400_CLKDIV0_HCLK2);
	}

	hclk = hclkx2 / GET_DIV(clkdiv0, S3C6400_CLKDIV0_HCLK);
	pclk = hclkx2 / GET_DIV(clkdiv0, S3C6400_CLKDIV0_PCLK);
</pre>
&#24403;APLL&#20026;532MHz&#26102;&#65292;&#31995;&#32479;&#30340;&#21508;&#31867;&#26102;&#38047;&#39057;&#29575;&#20540;&#22914;&#19979;&#65306;
<pre class="programlisting">
APLL    532MHz    FCLK    532MHz

MPLL    532MHz    HCLK    133MHz
                  HCLKx2  266MHz
                  PCLK    66MHz
EPLL    24MHz
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#23558;PLL&#39057;&#29575;&#36171;&#20540;&#32473;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#12290;&#27880;&#24847;clk_fout_mpll&#23601;&#26159;clk_mpll&#12290;&#23427;&#20204;&#26159;&#31995;&#32479;&#26368;&#32456;&#20250;&#29992;&#21040;&#30340;&#26102;&#38047;&#25110;&#32773;&#26102;&#38047;&#28304;&#12290;</li><li class="listitem">&#23558;CLK&#39057;&#29575;&#36171;&#20540;&#32473;&#23545;&#24212;&#30340;&#32467;&#26500;&#20307;&#12290;</li></ul></div>
<pre class="programlisting">
#define clk_fout_mpll	clk_mpll
	clk_fout_mpll.rate = mpll;
	clk_fout_epll.rate = epll;
	clk_fout_apll.rate = apll;

	clk_hx2.rate = hclkx2;
	clk_h.rate = hclk;
	clk_p.rate = pclk;
	clk_f.rate = fclk;
	
	/* set Perphial MUX and DIV */
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#22914;&#26524;&#38656;&#35201;&#35843;&#25972;&#22806;&#35774;&#30340;&#26102;&#38047;&#39057;&#29575;&#65292;&#21487;&#20197;&#22312;&#36825;&#37324;&#28155;&#21152;&#65292;&#27604;&#22914;MMC&#25511;&#21046;&#22120;&#30340;&#12290;</li></ul></div>
<pre class="programlisting">	
	for (ptr = 0; ptr &lt; ARRAY_SIZE(init_parents); ptr++)
		s3c6400_set_clksrc(init_parents[ptr]);
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">init_parents&#23450;&#20041;&#20102;&#31995;&#32479;&#20013;&#25152;&#38656;&#35201;&#30340;&#26102;&#38047;&#30340;&#26102;&#38047;&#28304;&#21644;&#36755;&#20986;&#35268;&#21017;&#12290;&#27880;&#20876;&#26102;&#26102;&#38047;&#34987;&#38142;&#25509;&#20837;clocks&#38142;&#34920;&#65292;s3c6400_set_clksrc&#21017;&#24314;&#31435;&#20102;&#23427;&#20204;&#20043;&#38388;&#30340;&#32852;&#31995;&#12290;</li></ul></div>
<div class="figure"><a name="idp81538780"></a><p class="title"><b>&#22270; 111. &#26102;&#38047;&#28304;&#19982;&#26102;&#38047;&#20851;&#31995;</b></p><div class="figure-contents"><div><img src="images/time_src.gif" alt="&#26102;&#38047;&#28304;&#19982;&#26102;&#38047;&#20851;&#31995;"></div></div></div><br class="figure-break">
&#26412;&#36136;&#19978;&#38500;&#20102;&#26368;&#32456;&#30340;&#26102;&#38047;&#20197;&#22806;&#65292;&#26102;&#38047;&#23601;&#26159;&#20316;&#20026;&#26102;&#38047;&#28304;&#32780;&#20351;&#29992;&#65292;&#22312;S3C6410&#31995;&#32479;&#19978;&#65292;&#30001;&#20110;&#26377;PLL&#65292;&#24182;&#19988;&#23427;&#20204;&#20135;&#29983;&#30340;&#26102;&#38047;&#21487;&#20197;&#33258;&#30001;&#35774;&#32622;&#20998;&#39057;&#21644;&#22810;&#36335;&#36873;&#25321;&#65292;&#25152;&#20197;&#20026;&#20102;&#35760;&#24405;&#24403;&#21069;&#26102;&#38047;&#21644;&#23427;&#30340;&#26102;&#38047;&#28304;&#65292;&#20197;&#21450;&#20174;&#26102;&#38047;&#28304;&#33719;&#21462;&#35813;&#26102;&#38047;&#30340;&#35268;&#21017;&#65292;&#31995;&#32479;&#24341;&#20837;&#20102;clksrc_clk&#21644;clk_sources&#32467;&#26500;&#20307;&#12290;clksrc_clk&#23545;&#24403;&#21069;&#26102;&#38047;&#21644;&#26102;&#38047;&#28304;&#20197;&#21450;&#35268;&#21017;&#36827;&#34892;&#20102;&#23553;&#35013;&#65292;&#32780;&#23427;&#30340;sources&#25104;&#21592;&#21017;&#25351;&#21521;&#20102;&#19968;&#20010;clk_sources&#25351;&#38024;&#12290;clk_sources&#21017;&#26159;&#23545;struct clk&#25104;&#21592;&#25968;&#32452;&#30340;&#23553;&#35013;&#12290;
</div>
<p>
</p>
</div>
<div class="sect2" title="18.8. &#20869;&#26680;&#35745;&#26102;&#20307;&#31995;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81540092"></a>18.8. &#20869;&#26680;&#35745;&#26102;&#20307;&#31995;</h3></div></div></div>
Linux&#24635;&#26159;&#20250;&#36873;&#25321;&#19968;&#20010;&#26102;&#38047;&#28304;&#26469;&#21516;&#27493;&#25972;&#20010;&#20869;&#26680;&#21306;&#22495;&#20013;&#30340;&#26102;&#38388;&#35760;&#24405;&#65292;&#32479;&#35745;&#20869;&#26680;&#30456;&#20851;&#20449;&#24687;&#65292;&#24182;&#20026;&#20869;&#26680;&#36719;&#20214;&#23450;&#26102;&#22120;&#25552;&#20379;&#21442;&#32771;&#22522;&#26412;&#12290;&#20869;&#26680;&#36890;&#36807;&#23558;&#30456;&#20851;&#30340;&#22788;&#29702;&#20989;&#25968;&#21644;&#25968;&#25454;&#32467;&#26500;&#30340;&#26356;&#26032;&#21160;&#20316;&#25346;&#36733;&#21040;&#35813;&#26102;&#38047;&#26102;&#38047;&#28304;&#30340;&#20013;&#26029;&#19978;&#65292;&#20197;&#36798;&#21040;&#36825;&#20123;&#30446;&#30340;&#12290;&#20869;&#26680;&#20351;&#29992;&#20102;&#30456;&#24403;&#22810;&#30340;&#25968;&#25454;&#32467;&#26500;&#20197;&#36798;&#21040;&#28165;&#26224;&#32780;&#26377;&#23618;&#27425;&#24863;&#30340;&#22788;&#29702;&#12290;
<div class="sect3" title="18.8.1. jiffies"><div class="titlepage"><div><div><h4 class="title"><a name="idp81540348"></a>18.8.1. jiffies</h4></div></div></div>
jiffies&#21464;&#37327;&#26159;&#19968;&#20010;&#35745;&#25968;&#22120;&#65292;&#29992;&#26469;&#35760;&#24405;&#23376;&#31995;&#32479;&#21551;&#21160;&#20197;&#26469;&#21457;&#29983;&#30340;&#26102;&#38047;&#20013;&#26029;&#25968;&#12290;&#27599;&#27425;&#26102;&#38047;&#20013;&#26029;&#21457;&#29983;&#31216;&#20026;&#19968;&#20010;&#33410;&#25293;&#65292;&#27492;&#26102;jiffies&#23601;&#20250;&#21152;1&#12290;&#26089;&#20123;&#26102;&#20505;&#23427;&#26159;&#19968;&#20010;32&#20301;&#30340;&#21464;&#37327;&#65292;&#22240;&#27492;&#27599;&#20010;&#22823;&#32422;50&#22825;&#23601;&#20250;&#20135;&#29983;&#22238;&#32469;&#12290;&#25152;&#20197;&#20869;&#26680;&#20026;&#20102;&#22312;&#22238;&#32469;&#26102;&#33021;&#22815;&#27604;&#36739;&#23558;&#26576;&#20010;&#20540;&#19982;jiffies&#27604;&#36739;&#65292;&#20197;&#30830;&#23450;&#26102;&#38388;&#30340;&#20808;&#21518;&#65292;&#20869;&#26680;&#25552;&#20379;&#20102;&#22914;&#19979;&#20960;&#20010;&#23439;&#26469;&#36827;&#34892;&#25805;&#20316;&#65292;&#27880;&#24847;&#65306;&#23427;&#20204;&#37117;&#26159;&#23384;&#22312;&#22238;&#32469;&#38382;&#39064;&#30340;&#12290;
	<div class="table"><a name="idp81541580"></a><p class="title"><b>&#34920; 28. &#26102;&#38388;&#27604;&#36739;&#23439;</b></p><div class="table-contents">
	<table summary="&#26102;&#38388;&#27604;&#36739;&#23439;" border="1"><colgroup><col><col></colgroup><thead><tr><th>&#23439;</th><th>&#35828;&#26126;</th></tr></thead><tbody><tr><td>time_after(a, b)</td><td>&#22914;&#26524;&#26102;&#38388;a&#22312;&#26102;&#38388;b&#20043;&#21518;(a &lt; b)&#65292;&#21017;&#36820;&#22238;1&#12290;</td></tr><tr><td>time_after_eq(a, b)</td><td>&#22914;&#26524;&#26102;&#38388;a&#19981;&#22312;&#26102;&#38388;b&#20043;&#21069;(a &lt;= b)&#65292;&#21017;&#36820;&#22238;1&#12290;</td></tr><tr><td>time_before(a, b)</td><td>&#22914;&#26524;&#26102;&#38388;a&#22312;&#26102;&#38388;b&#20043;&#21069;(a &gt; b)&#65292;&#21017;&#36820;&#22238;1&#12290;</td></tr><tr><td>time_before_eq(a, b)</td><td>&#22914;&#26524;&#26102;&#38388;a&#19981;&#22312;&#26102;&#38388;b&#20043;&#21518;(a &gt;= b)&#65292;&#21017;&#36820;&#22238;1&#12290;</td></tr><tr><td>time_in_range(a, b, c)</td><td>&#22914;&#26524;a&#22312;[b, c]&#26102;&#38388;&#38388;&#38548;&#20869;&#65292;&#36820;&#22238;1&#12290;</td></tr></tbody></table>
	</div></div><br class="table-break">
&#21478;&#22806;&#20869;&#26680;&#20026;&#20102;&#26041;&#20415;&#19982;jiffies&#30340;&#27604;&#36739;&#65292;&#23553;&#35013;&#20102;&#19968;&#19979;&#22235;&#20010;&#23439;&#65292;&#23427;&#20204;&#21482;&#38656;&#35201;&#25552;&#20379;&#19968;&#20010;&#21442;&#25968;&#12290;
<pre class="programlisting">
#define time_is_before_jiffies(a) time_after(jiffies, a)
#define time_is_after_jiffies(a) time_before(jiffies, a)
#define time_is_before_eq_jiffies(a) time_after_eq(jiffies, a)
#define time_is_after_eq_jiffies(a) time_before_eq(jiffies, a)
</pre>	
&#23613;&#31649;&#20197;&#19978;&#23439;&#21487;&#20197;&#24456;&#22909;&#30340;&#22788;&#29702;&#26102;&#38388;&#27604;&#36739;&#65292;&#20294;&#26159;&#26377;&#20123;&#26102;&#20505;&#38656;&#35201;&#33258;&#31995;&#32479;&#21551;&#21160;&#20197;&#26469;&#20135;&#29983;&#30340;&#31995;&#32479;&#33410;&#25293;&#25968;&#30340;&#31934;&#30830;&#20540;&#65292;&#25152;&#20197;&#24403;&#21069;jiffies&#21464;&#37327;&#36890;&#36807;&#38142;&#25509;&#22120;&#34987;&#36716;&#25442;&#20026;&#19968;&#20010;64&#20301;&#35745;&#25968;&#22120;&#30340;&#20302;32&#20301;&#12290;&#23545;&#20110;64&#30340;&#31995;&#32479;&#26469;&#35828;jiffies&#23601;&#26159;&#23545;jiffies_64&#30340;&#30452;&#25509;&#24341;&#29992;&#12290;
<pre class="programlisting">
arch/arm/kernel/vmlinux.lds.S
#ifndef __ARMEB__
jiffies = jiffies_64;
#else
jiffies = jiffies_64 + 4;
#endif
</pre>
u64&#23454;&#38469;&#19978;&#23601;&#26159;unsigned long long int&#31867;&#22411;&#12290;&#30001;&#20110;&#22312;32&#20301;&#30340;&#20307;&#31995;&#26550;&#26500;&#19978;&#19981;&#33021;&#33258;&#21160;&#22320;&#23545;64&#20026;&#30340;&#21464;&#37327;&#36827;&#34892;&#35775;&#38382;&#65292;&#22312;&#27599;&#27425;&#25191;&#34892;&#23545;64&#20301;&#25968;&#30340;&#35775;&#38382;&#26102;&#65292;&#38656;&#35201;&#19968;&#20123;&#21516;&#27493;&#26426;&#21046;&#26469;&#20445;&#35777;&#24403;&#20004;&#20010;32&#20301;&#30340;&#35745;&#25968;&#22120;&#30340;&#20540;&#22312;&#34987;&#35835;&#21462;&#26102;&#36825;&#20010;64&#20301;&#30340;&#35745;&#25968;&#22120;&#19981;&#20250;&#34987;&#26356;&#26032;&#65292;&#25152;&#20197;&#22312;32&#20301;&#31995;&#32479;&#19978;&#35835;&#21462;64&#20301;&#30340;&#25968;&#35201;&#24930;&#12290;
<pre class="programlisting">
kernel/timer.c
u64 jiffies_64 __cacheline_aligned_in_smp = INITIAL_JIFFIES;
EXPORT_SYMBOL(jiffies_64);
</pre>
get_jiffies_64&#20989;&#25968;&#29992;&#26469;&#35835;&#21462;jiffies_64&#30340;&#20540;&#65292;&#26174;&#28982;&#23545;&#20110;64&#20301;&#31995;&#32479;&#26469;&#35828;&#65292;&#23601;&#26159;&#35835;&#21462;jiffies&#12290;
<pre class="programlisting">
include/linux/jiffies.h
#if (BITS_PER_LONG &lt; 64)
u64 get_jiffies_64(void);
#else
static inline u64 get_jiffies_64(void)
{
	return (u64)jiffies;
}
#endif
</pre>
&#36825;&#37324;&#30340;xtime_lock&#26159;&#19968;&#20010;&#39034;&#24207;&#38145;&#65292;&#29992;&#26469;&#20445;&#25252;64&#20301;&#30340;&#35835;&#25805;&#20316;&#65306;&#35813;&#20989;&#25968;&#19968;&#30452;&#35835;jiffies_64&#21464;&#37327;&#30693;&#36947;&#30830;&#35748;&#35813;&#21464;&#37327;&#24182;&#27809;&#26377;&#21516;&#26102;&#34987;&#20854;&#20182;&#20869;&#26680;&#25511;&#21046;&#36335;&#24452;&#26356;&#26032;&#26102;&#25165;&#23436;&#25104;&#35835;&#21462;&#24182;&#36820;&#22238;&#12290;&#25152;&#20197;&#22914;&#26524;&#35201;&#26356;&#26032;jiffies_64&#21464;&#37327;&#65292;&#24517;&#39035;&#39318;&#20808;&#20351;&#29992;write_seqlock&#26469;&#38145;&#23450;xtime_lock&#65292;&#24182;&#22312;&#26356;&#26032;&#23436;&#27605;&#21518;&#20351;&#29992;write_sequnlock&#21462;&#28040;&#38145;&#23450;&#12290;&#23545;jiffies_64&#30340;&#25805;&#20316;&#20063;&#20250;&#21516;&#26102;&#26356;&#26032;jiffies&#30340;&#20540;&#65292;&#22240;&#20026;&#23427;&#23545;&#24212;jiffies_64&#30340;&#20302;32&#20301;&#12290;
<pre class="programlisting">
kernel/time.c
#if (BITS_PER_LONG &lt; 64)
u64 get_jiffies_64(void)
{
	unsigned long seq;
	u64 ret;

	do {
		seq = read_seqbegin(&amp;xtime_lock);
		ret = jiffies_64;
	} while (read_seqretry(&amp;xtime_lock, seq));
	return ret;
}
EXPORT_SYMBOL(get_jiffies_64);
#endif
</pre>
&#23601;&#26102;&#38388;&#38388;&#38548;&#32780;&#35328;&#65292;jiffies&#22312;&#22810;&#25968;&#26102;&#20505;&#24182;&#19981;&#34987;&#30452;&#25509;&#20351;&#29992;&#65292;&#32780;&#26159;&#35201;&#36716;&#25442;&#25104;&#20154;&#20204;&#26356;&#29087;&#24713;&#30340;&#26102;&#38388;&#21333;&#20301;&#65306;&#24494;&#31186;&#21644;&#27627;&#31186;&#65292;&#20869;&#26680;&#23553;&#35013;&#20102;&#36825;&#20123;&#20989;&#25968;&#65306;
<pre class="programlisting">
kernel/time.c
unsigned int jiffies_to_msecs(const unsigned long j);
unsigned int jiffies_to_usecs(const unsigned long j);
unsigned long msecs_to_jiffies(const unsigned int m);
unsigned long usecs_to_jiffies(const unsigned int u);
</pre>
</div>
<div class="sect3" title="18.8.2. HZ"><div class="titlepage"><div><div><h4 class="title"><a name="idp81550204"></a>18.8.2. HZ</h4></div></div></div>
Linux&#26680;&#24515;&#27599;&#38548;&#22266;&#23450;&#21608;&#26399;&#20250;&#21457;&#20986;&#26102;&#38047;&#20013;&#26029;&#65292;HZ&#26159;&#29992;&#26469;&#23450;&#20041;&#27599;&#19968;&#31186;&#26377;&#20960;&#27425;&#20013;&#26029;&#12290;&#20030;&#20363;&#26469;&#35828;&#65292;HZ&#20026;1000&#65292;&#20195;&#34920;&#27599;&#31186;&#26377;1000&#27425;&#26102;&#38047;&#20013;&#26029;&#12290; HZ&#21487;&#20197;&#36890;&#36807;&#37197;&#32622;&#36873;&#39033;&#22312;&#32534;&#35793;&#26102;&#35774;&#23450;&#65306;
<pre class="programlisting">
.config
CONFIG_HZ=200
</pre>
&#22312;&#29305;&#23450;&#20307;&#31995;&#26550;&#26500;&#30340;&#20195;&#30721;&#20013;&#65292;&#23558;CONFIG_HZ&#36716;&#21270;&#32473;&#23439;HZ&#12290;&#31995;&#32479;&#20013;&#30340;&#23558;&#30452;&#25509;&#24341;&#29992;HZ&#12290;
<pre class="programlisting">
arch/arm/include/asm/param.h
# define HZ  CONFIG_HZ       /* Internal kernel timer frequency */
</pre>
&#36890;&#24120;&#65292;&#36739;&#39640;&#30340;HZ&#20540;&#20351;&#24471;&#31995;&#32479;&#20855;&#26377;&#26356;&#22909;&#30340;&#20132;&#20114;&#24615;&#21644;&#21709;&#24212;&#36895;&#24230;&#65292;&#29305;&#21035;&#26159;&#65292;&#27599;&#20010;&#26102;&#38047;&#20013;&#26029;&#26102;&#37117;&#20250;&#35843;&#29992;&#35843;&#24230;&#22120;&#12290;&#20294;&#26159;&#65292;&#30001;&#20110;&#23450;&#26102;&#22120;&#20013;&#26029;&#20363;&#31243;&#35843;&#29992;&#24471;&#39057;&#32321;&#65292;&#20869;&#26680;&#30340;&#19968;&#33324;&#24615;&#24320;&#38144;&#20063;&#20250;&#38543;&#20043;&#22686;&#21152;&#12290;&#25152;&#20197;&#65292;&#36739;&#22823;&#30340;HZ&#20540;&#27604;&#36739;&#36866;&#21512;&#20132;&#20114;&#31995;&#32479;&#65292;&#32780;&#36739;&#20302;&#30340;HZ&#20540;&#26356;&#36866;&#21512;&#20110;&#26381;&#21153;&#22120;&#31561;&#38750;&#20132;&#20114;&#31995;&#32479;&#12290;
</div>
<div class="sect3" title="18.8.3. xtime"><div class="titlepage"><div><div><h4 class="title"><a name="idp81552084"></a>18.8.3. xtime</h4></div></div></div>
xtime&#21464;&#37327;&#23384;&#25918;&#24403;&#21069;&#26102;&#38388;&#21644;&#26085;&#26399;&#65292;&#23427;&#26159;&#19968;&#20010;timespec&#31867;&#22411;&#30340;&#25968;&#25454;&#32467;&#26500;&#65292;&#24182;&#19988;&#23545;&#20854;&#21040;16&#23383;&#33410;&#65292;&#36825;&#21152;&#36895;&#20102;&#23545;&#20854;&#30340;&#35775;&#38382;&#12290;
<pre class="programlisting">
kernel/timekeeping.c
struct timespec xtime __attribute__ ((aligned (16)));
</pre>
timespec&#32467;&#26500;&#20307;&#26377;&#20004;&#20010;&#25104;&#21592;&#32452;&#25104;&#65306;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">tv_sec &#23384;&#25918;&#33258;1970&#24180;1&#26376;1&#26085;(UTC)&#20940;&#26216;&#20381;&#36182;&#32463;&#36807;&#30340;&#25551;&#36848;&#12290;</li><li class="listitem">tv_nsec &#23384;&#25918;&#33258;&#19978;&#19968;&#31186;&#24320;&#22987;&#32463;&#36807;&#30340;&#32435;&#31186;&#25968;&#12290;(0 ~ 999 999 999)</li></ul></div>
<pre class="programlisting">
include/linux.h
struct timespec {
	time_t	tv_sec;		/* seconds */
	long	tv_nsec;	/* nanoseconds */
};
</pre>
xtime&#36890;&#24120;&#27599;&#27425;&#26102;&#38047;&#20013;&#26029;&#26102;&#34987;&#26356;&#26032;&#19968;&#27425;&#12290;&#29992;&#25143;&#31243;&#24207;&#20174;xtime&#21464;&#37327;&#25110;&#24471;&#24403;&#21069;&#26102;&#38388;&#21644;&#26085;&#26399;&#65292;&#20869;&#26680;&#20063;&#32463;&#24120;&#24341;&#29992;&#23427;&#65292;&#27604;&#22914;&#22312;&#26356;&#26032;&#25991;&#20214;&#33410;&#28857;&#26102;&#38388;&#25139;&#26102;&#34987;&#24341;&#29992;&#12290;<br>
xtime_lock&#39034;&#24207;&#38145;&#28040;&#38500;&#20102;&#23545;xtime&#21464;&#37327;&#30340;&#21516;&#26102;&#35775;&#38382;&#32780;&#21487;&#33021;&#21457;&#29983;&#30340;&#31454;&#20105;&#26465;&#20214;&#12290;&#19968;&#33324;&#32780;&#35328;&#65292;&#36825;&#20010;&#39034;&#24207;&#38145;&#29992;&#26469;&#23450;&#20041;&#35745;&#26102;&#23376;&#20307;&#31995;&#20013;&#30340;&#19968;&#20123;&#20020;&#30028;&#21306;&#12290;
</div>
<div class="sect3" title="18.8.4. &#20869;&#26680;&#26102;&#38047;&#28304;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81553116"></a>18.8.4. &#20869;&#26680;&#26102;&#38047;&#28304;</h4></div></div></div>
&#20869;&#26680;&#26102;&#38047;&#28304;&#21644;&#30828;&#20214;&#30340;&#26102;&#38047;&#28304;&#26159;&#20004;&#22238;&#20107;&#65292;&#20869;&#26680;&#26102;&#38047;&#28304;&#26159;&#19968;&#31181;&#36719;&#20214;&#26102;&#38047;&#28304;&#12290;&#20869;&#26680;&#26102;&#38047;&#28304;&#22522;&#20110;&#30828;&#20214;&#26102;&#38047;&#28304;&#65292;&#23427;&#36873;&#21462;&#30828;&#20214;&#26102;&#38047;&#28304;&#20043;&#19968;&#20316;&#20026;&#20869;&#26680;&#26102;&#38047;&#28304;&#30340;&#35302;&#21457;&#22522;&#30784;&#65292;&#25152;&#20197;&#38500;&#20102;&#35302;&#21457;&#30340;&#22522;&#30784;&#26159;&#30001;&#30828;&#20214;&#26102;&#38047;&#36890;&#36807;&#26102;&#38047;&#20013;&#26029;&#26469;&#25552;&#20379;&#22806;&#65292;&#20869;&#26680;&#23436;&#20840;&#36890;&#36807;&#36719;&#20214;&#26469;&#27169;&#25311;&#20869;&#26680;&#26102;&#38047;&#28304;&#12290;&#30456;&#20851;&#30340;&#20195;&#30721;&#22343;&#20301;&#20110;kernel/time&#20013;&#12290;&#23427;&#26159;&#20869;&#26680;&#30340;&#36208;&#26102;&#21644;&#23432;&#26102;&#31995;&#32479;&#12290;
<pre class="programlisting">
......
	timekeeping_init();
	time_init();
</pre>
&#22312;start_kernel&#20013;&#35843;&#29992;timekeeping_init&#20989;&#25968;&#26469;&#21021;&#22987;&#21270;&#20869;&#26680;&#26102;&#38047;&#28304;&#12290;&#24182;&#19988;&#23427;&#30340;&#21021;&#22987;&#21270;&#26089;&#20110;&#30828;&#20214;&#26102;&#38047;&#20013;&#26029;&#30340;&#21021;&#22987;&#21270;&#12290;
<pre class="programlisting">
include/linux/clocksource.h
struct clocksource {	
	char *name;
	struct list_head list;
	int rating;
	cycle_t (*read)(void);
	cycle_t mask;
	u32 mult;
	u32 mult_orig;
	u32 shift;
	unsigned long flags;
	cycle_t (*vread)(void);
	void (*resume)(void);
	......
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">name &#23383;&#31526;&#20018;&#25551;&#36848;&#35813;&#26102;&#38047;&#28304;&#65292;&#27604;&#22914;&#8220;jiffies&#8221;&#12290;</li><li class="listitem">list &#29992;&#20110;&#23558;&#26102;&#38047;&#28304;&#38142;&#25509;&#22312;&#19968;&#20010;&#21452;&#21521;&#20869;&#26680;&#38142;&#34920;&#20013;&#12290;</li><li class="listitem">&#30456;&#20851;&#20307;&#31995;&#30340;&#20195;&#30721;&#21487;&#33021;&#20250;&#23450;&#20041;&#19968;&#20010;&#26102;&#38047;&#28304;&#24182;&#36890;&#36807;clocksource_register&#27880;&#20876;&#21040;&#20869;&#26680;&#65292;&#20869;&#26680;&#33258;&#36523;&#20063;&#20250;&#23450;&#20041;&#19968;&#20010;&#21517;&#20026;jiffies&#30340;&#26102;&#38047;&#28304;&#65292;&#20294;&#26159;&#24182;&#19981;&#26159;&#25152;&#26377;&#26102;&#38047;&#30340;&#31934;&#30830;&#24615;&#37117;&#24456;&#22909;&#65292;rating&#23601;&#26159;&#29992;&#26469;&#25351;&#26126;&#26102;&#38047;&#28304;&#30340;&#36136;&#37327;&#12290;&#20540;&#36234;&#23567;&#65292;&#34920;&#26126;&#36136;&#37327;&#36234;&#24046;&#65292;rating&#22312;100~199&#20043;&#38388;&#65292;&#34920;&#26126;&#21487;&#20197;&#20351;&#29992;&#65292;&#20294;&#36136;&#37327;&#19981;&#22909;&#65292;rating&#22312;300~399&#21306;&#38388;&#65292;&#34920;&#31034;&#26102;&#38047;&#28304;&#30456;&#24403;&#24555;&#36895;&#19988;&#20934;&#30830;&#12290;&#22312;1~99&#20043;&#38388;&#35828;&#26126;&#23427;&#38750;&#24120;&#24046;&#65292;&#20165;&#20165;&#29992;&#20110;&#21551;&#21160;&#26399;&#38388;&#12290;&#36229;&#36807;400&#30340;rating&#25351;&#26126;&#36825;&#26159;&#19968;&#20010;&#23436;&#32654;&#30340;&#26102;&#38047;&#28304;&#12290;</li><li class="listitem">read &#20989;&#25968;&#25351;&#38024;&#29992;&#20110;&#35835;&#21462;&#26102;&#38047;&#21608;&#26399;&#30340;&#24403;&#21069;&#35745;&#25968;&#20540;&#12290;&#24182;&#38750;&#25152;&#26377;&#26102;&#38047;&#30340;read&#36820;&#22238;&#20540;&#37117;&#20351;&#29992;&#32479;&#19968;&#30340;&#35745;&#26102;&#21333;&#20301;&#65292;&#22240;&#20026;&#38656;&#35201;&#21333;&#29420;&#36716;&#21270;&#20026;&#32435;&#31186;&#20540;&#12290;</li></ul></div>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">read_persistent_clock&#26377;&#20307;&#31995;&#26550;&#26500;&#20195;&#30721;&#23450;&#20041;&#65292;&#22914;&#26524;&#27809;&#26377;&#21017;&#34987;&#31995;&#32479;&#32479;&#19968;&#23450;&#20041;&#20026;&#36820;&#22238;0&#20540;&#24471;&#31354;&#20989;&#25968;&#12290;&#36890;&#24120;&#23427;&#29992;&#26469;&#35835;&#21462;rtc&#30340;&#31186;&#20540;&#65292;ARM&#19978;&#24182;&#27809;&#26377;&#23450;&#20041;&#35813;&#20989;&#25968;&#12290;</li><li class="listitem">write_seqlock_irqsave&#29992;&#26469;&#38145;&#23450;xtime_lock&#24182;&#31105;&#27490;&#20013;&#26029;&#12290;</li><li class="listitem">ntp_init &#29992;&#26469;&#21021;&#22987;&#21270;&#20869;&#26680;&#26102;&#38388;&#21516;&#27493;&#21327;&#35758;&#30456;&#20851;&#30340;&#25968;&#25454;&#32467;&#26500;&#12290;</li></ul></div>
<pre class="programlisting">
kernel/time/timekeeping.c

struct clocksource *clock;
void __init timekeeping_init(void)
{
	unsigned long flags;
	unsigned long sec = read_persistent_clock();

	write_seqlock_irqsave(&amp;xtime_lock, flags);

	ntp_init();

	clock = clocksource_get_next();
	clocksource_calculate_interval(clock, NTP_INTERVAL_LENGTH);
	clock-&gt;cycle_last = clocksource_read(clock);

	xtime.tv_sec = sec;
	xtime.tv_nsec = 0;
	set_normalized_timespec(&amp;wall_to_monotonic,
		-xtime.tv_sec, -xtime.tv_nsec);
	update_xtime_cache(0);
	total_sleep_time = 0;
	write_sequnlock_irqrestore(&amp;xtime_lock, flags);
}
</pre>
&#20869;&#26680;&#22312;&#27492;&#26102;&#23601;&#20351;&#29992;&#40664;&#35748;&#23450;&#20041;&#30340;jiffies&#26102;&#38047;&#28304;&#65292;&#23427;&#30340;rating&#34987;&#23450;&#20041;&#20026;1&#65292;&#26174;&#28982;&#20248;&#20808;&#32423;&#30456;&#24403;&#30340;&#20302;&#12290;&#22312;time_init&#20013;&#29305;&#23450;&#26550;&#26500;&#20195;&#30721;&#21487;&#20197;&#36890;&#36807;clocksource_register&#27880;&#20876;&#21333;&#29420;&#30340;&#26102;&#38047;&#28304;&#21040;&#20869;&#26680;&#26102;&#38047;&#28304;&#38142;&#34920;clocksource_list&#20013;&#65292;&#24182;&#22312;&#26102;&#38047;&#20013;&#26029;&#26102;&#65292;&#26356;&#26032;&#26102;&#38047;&#28304;&#12290;
<pre class="programlisting">
static cycle_t jiffies_read(void)
{
        return (cycle_t) jiffies;
}

struct clocksource clocksource_jiffies= {
        .name           = "jiffies",
        .rating         = 1, /* lowest valid rating*/
        .read           = jiffies_read,
        .mask           = 0xffffffff, /*32bits*/
        .mult           = NSEC_PER_JIFFY &lt;&lt; JIFFIES_SHIFT, /* details above */
        .mult_orig      = NSEC_PER_JIFFY &lt;&lt; JIFFIES_SHIFT,
        .shift          = JIFFIES_SHIFT,
};
</pre>
&#22312;&#20869;&#26680;&#21021;&#22987;&#21270;&#38454;&#27573;clocksource_get_next&#20250;&#33719;&#21462;clocksource_jiffies&#12290;clocksource_calculate_interval&#29992;&#26469;&#35745;&#31639;&#27599;&#20010;TICK&#32473;xtime&#21464;&#37327;  tv_nsec&#25104;&#21592;&#22686;&#21152;&#30340;&#32435;&#31186;&#20540;&#12290;clock&#29992;&#26469;&#25351;&#21521;&#26368;&#32456;&#36873;&#23450;&#30340;&#20869;&#26680;&#26102;&#38047;&#28304;&#12290;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">clocksource_read&#36890;&#36807;&#35843;&#29992;&#26102;&#38047;&#28304;&#30340;read&#20989;&#25968;&#33719;&#21462;&#26368;&#21518;&#19968;&#27425;&#26356;&#26032;&#30340;&#26102;&#38047;&#28304;&#30340;&#20540;&#12290;</li><li class="listitem">&#25509;&#19979;&#26469;&#21021;&#22987;&#21270;&#22681;&#19978;&#26102;&#38388;xtime&#12290;</li><li class="listitem">set_normalized_timespec&#25226;xtime&#19978;&#30340;&#26102;&#38388;&#35843;&#25972;&#25104;struct timespec&#26684;&#24335;&#65292;&#24182;&#20445;&#23384;&#21040;wall_to_monotonic&#21464;&#37327;&#20013;&#12290;</li><li class="listitem">update_xtime_cache&#29992;&#26469;&#26356;&#26032;&#21517;&#20026;xtime_cache&#30340;timespec&#32467;&#26500;&#20307;&#65292;time&#31995;&#32479;&#35843;&#29992;&#26681;&#25454;&#23427;&#26469;&#33719;&#21462;&#31995;&#32479;&#26102;&#38388;&#12290;</li><li class="listitem">total_sleep_time&#29992;&#26469;&#32479;&#35745;&#26102;&#38047;&#28304;&#30340;&#25346;&#36215;&#26102;&#38388;&#65292;&#27604;&#22914;&#31995;&#32479;&#30561;&#30496;&#21518;&#21487;&#20197;&#20572;&#27490;&#35813;&#26102;&#38047;&#28304;&#20197;&#33410;&#32422;&#30005;&#33021;&#12290;</li><li class="listitem">&#26368;&#21518;&#35843;&#29992;write_sequnlock_irqrestore&#29992;&#26469;&#35299;&#38145;&#65292;&#24182;&#24674;&#22797;&#20013;&#26029;&#12290;</li></ul></div>
clocksource_jiffies&#20013;&#30340;read&#25104;&#21592;&#30340;&#36820;&#22238;&#20540;&#38656;&#35201;&#36716;&#21270;&#20026;&#32435;&#31186;&#20540;&#12290;&#20026;&#27492;&#65292;&#38656;&#35201;&#20998;&#21035;&#20351;&#29992;mult&#21644;shift&#25104;&#21592;&#26469;&#20056;/&#21491;&#31227;&#36820;&#22238;&#30340;&#26102;&#38047;&#21608;&#26399;&#25968;&#12290;&#22914;&#19979;&#65306;
<pre class="programlisting">
include/linux/clocksource.h
static inline s64 cyc2ns(struct clocksource *cs, cycle_t cycles)
{
	u64 ret = (u64)cycles;
	ret = (ret * cs-&gt;mult) &gt;&gt; cs-&gt;shift;
	return ret;
}
</pre>
cycle_t&#34987;&#23450;&#20041;&#20026;u64&#65292;&#22914;&#26524;&#26102;&#38047;&#19981;&#25552;&#20379;64&#20301;&#26159;&#20860;&#32844;&#65292;&#37027;&#20040;mask&#25351;&#23450;&#20102;&#19968;&#20301;&#25513;&#30721;&#65292;&#29992;&#20110;&#36873;&#25321;&#36866;&#24403;&#30340;&#27604;&#29305;&#20301;&#12290;CLOCKSOURCE_MASK&#23439;&#29992;&#20110;&#38024;&#23545;&#32473;&#23450;&#30340;&#27604;&#29305;&#20301;&#25968;&#26500;&#24314;&#36866;&#24403;&#30340;&#25513;&#30721;&#12290;&#20998;&#26512;cyc2ns&#30340;&#23454;&#29616;&#20284;&#20046;&#20808;&#24038;&#31227;JIFFIES_SHIFT&#28982;&#21518;&#20877;&#21491;&#31227;&#30456;&#21516;&#30340;&#20301;&#25968;&#65292;&#20284;&#20046;&#27809;&#26377;&#24847;&#20041;&#12290;&#20294;&#30001;&#20110;NTP&#20195;&#30721;&#19981;&#25509;&#21463;0&#20301;&#30340;&#31227;&#20301;&#25805;&#20316;&#65292;&#25152;&#20197;&#36825;&#37324;&#20351;&#29992;&#20102;&#36825;&#31181;&#22855;&#24618;&#30340;&#26041;&#27861;&#12290;<br><br>
NSEC_PER_JIFFY&#30340;&#23450;&#20041;&#25265;&#21704;&#20102;&#39044;&#22788;&#29702;&#31526;&#21495;ACTHZ&#12290;&#34429;&#28982;HZ&#34920;&#31034;&#32534;&#35793;&#26102;&#36873;&#25321;&#30340;&#20302;&#20998;&#36776;&#29575;&#35745;&#26102;&#39057;&#29575;&#65292;&#20294;&#31995;&#32479;&#23454;&#38469;&#19978;&#25552;&#20379;&#30340;&#35745;&#26102;&#39057;&#29575;&#20250;&#22240;&#30828;&#20214;&#30340;&#36873;&#25321;&#32780;&#26377;&#36731;&#24494;&#24046;&#21035;&#12290;ACTHZ&#34920;&#31034;&#26102;&#38047;&#23454;&#38469;&#19978;&#36816;&#34892;&#30340;&#39057;&#29575;&#12290;
<div class="figure"><a name="idp81565804"></a><p class="title"><b>&#22270; 112. &#26102;&#38047;&#20107;&#20214;&#19982;&#26102;&#38047;&#28304;</b></p><div class="figure-contents"><div><img src="images/time_event.gif" alt="&#26102;&#38047;&#20107;&#20214;&#19982;&#26102;&#38047;&#28304;"></div></div></div><br class="figure-break">
&#23613;&#31649;&#22810;&#25968;&#24773;&#20917;&#19979;&#31995;&#32479;&#21487;&#20197;&#20351;&#29992;&#40664;&#35748;&#30340;jiffies&#26102;&#38047;&#28304;&#65292;&#20294;&#26159;&#23545;&#20110;&#35201;&#27714;&#26356;&#39640;&#31934;&#30830;&#24230;&#30340;&#26102;&#38047;&#20107;&#20214;&#65292;&#38656;&#35201;&#22312;&#31995;&#32479;clock&#30452;&#25509;&#35835;&#21462;&#30828;&#20214;&#26102;&#38047;&#30340;&#23492;&#23384;&#22120;&#20540;&#65292;&#26469;&#30452;&#25509;&#30830;&#23450;jiffies&#12290;&#25152;&#20197;&#23545;&#20110;jiffies_64&#30340;&#26356;&#26032;&#20250;&#20986;&#29616;&#20004;&#31181;&#21487;&#33021;&#65306;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#30452;&#25509;&#20351;&#29992;&#40664;&#35748;&#30340;&#8220;jiffies&#8221;&#26102;&#38047;&#28304;&#65292;&#27492;&#26102;&#22312;&#26102;&#38047;&#20013;&#26029;&#20013;&#30452;&#25509;&#35843;&#29992;do_timer&#24182;&#39318;&#20808;&#26356;&#26032;jiffies_64&#65292;&#24182;&#22312;&#25509;&#19979;&#26469;&#30340;update_wall_time&#20013;&#35843;&#29992;&#26102;&#38047;&#28304;&#30340;&#35835;&#20989;&#25968;&#65292;&#36825;&#37324;&#23601;&#26159;jiffies_read&#65292;&#26174;&#28982;&#35835;&#21462;&#30340;&#23601;&#26159;&#21018;&#21018;&#26356;&#26032;&#36807;&#30340;jiffies_64&#20540;&#12290;&#20294;&#26159;&#22312;&#36825;&#20010;&#36807;&#31243;&#20013;&#26102;&#38047;&#20107;&#20214;&#26126;&#26174;&#20986;&#29616;&#20102;&#24310;&#26102;&#65292;&#36825;&#26159;&#30001;&#20110;&#23545;&#20110;&#32435;&#31186;&#32423;&#30340;&#20107;&#20214;&#24050;&#32463;&#20986;&#29616;&#20102;&#24456;&#22823;&#30340;&#24310;&#36831;&#12290;</li><li class="listitem">&#30452;&#25509;&#27880;&#20876;&#30828;&#20214;&#26102;&#38047;&#28304;&#65292;&#27492;&#26102;&#20013;&#26029;&#21457;&#29983;&#21518;&#36890;&#36807;&#20013;&#26029;&#20107;&#20214;&#35843;&#29992;tick_handle_periodic&#25110;&#32773;&#20043;&#38388;&#35843;&#29992;&#26102;&#38047;&#20107;&#20214;&#20989;&#25968;&#12290;tick_handle_periodic&#26159;&#24517;&#39035;&#35201;&#20854;&#20013;&#19968;&#20010;&#26102;&#38047;&#20013;&#26029;&#22788;&#29702;&#20989;&#25968;&#26469;&#35843;&#29992;&#30340;&#65292;&#22240;&#20026;&#23427;&#35843;&#29992;do_timer&#26469;&#23454;&#29616;&#31995;&#32479;&#26102;&#38047;&#30340;&#26356;&#26032;&#65292;&#20294;&#26159;&#22312;update_wall_time&#20013;&#35835;&#21462;&#30340;&#24403;&#21069;&#26102;&#38047;&#23492;&#23384;&#22120;&#30340;&#20540;&#65292;&#25152;&#20197;&#24310;&#26102;&#23601;&#38750;&#24120;&#23567;&#20102;&#65292;&#31995;&#32479;&#26102;&#38047;&#23601;&#30456;&#24403;&#31934;&#30830;&#12290;</li></ul></div>
S3C6410&#30340;&#26102;&#38047;&#28304;&#39537;&#21160;&#20013;&#27809;&#26377;&#25552;&#20379;&#26102;&#38047;&#20107;&#20214;&#35774;&#22791;&#30340;&#25903;&#25345;&#12290;&#25903;&#25345;&#30340;&#31995;&#32479;&#35201;&#24320;&#21551;CONFIG_GENERIC_CLOCKEVENTS&#21644;CONFIG_GENERIC_TIME&#37197;&#32622;&#21442;&#25968;&#12290;
</div>
</div>
<div class="sect2" title="18.9. &#26102;&#38047;&#20013;&#26029;&#27880;&#20876;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81568396"></a>18.9. &#26102;&#38047;&#20013;&#26029;&#27880;&#20876;</h3></div></div></div>
<p>
&#20869;&#26680;&#23450;&#26102;&#22120;&#30340;&#23454;&#29616;&#23545;&#20110;S3C6410&#26469;&#35828;&#23601;&#26159;PWM&#23450;&#26102;&#22120;&#21333;&#20803;&#30340;&#37197;&#32622;&#21644;&#24212;&#29992;&#12290;&#20869;&#26680;&#30340;&#26102;&#38047;&#20013;&#26029;&#20063;&#26159;&#26377;&#35813;&#23450;&#26102;&#22120;&#21333;&#20803;&#25552;&#20379;&#30340;&#12290;&#22312;&#27880;&#20876;&#23450;&#26102;&#22120;&#26102;&#25552;&#21040;PWM&#23450;&#26102;&#22120;&#34987;&#27880;&#20876;&#20026;&#65306;
</p><pre class="programlisting">
#define S3C_CLKCON_PCLK_PWM		(1&lt;&lt;7)
{
  .name           = "timers",
  .id             = -1,
  .parent         = &amp;clk_p,
  .enable         = s3c64xx_pclk_ctrl,
  .ctrlbit        = S3C_CLKCON_PCLK_PWM,
},
</pre><p>
S3C_CLKCON_PCLK_PWM&#25351;&#23450;&#20102;HCLK_GATE&#30340;&#31532;7&#20301;&#65292;&#23427;&#29992;&#26469;&#25511;&#21046;&#36873;&#36890;PWM&#30340;&#26102;&#38047;&#28304;&#20026;PCLK&#12290;
</p>
<div class="sect3" title="18.9.1. &#23450;&#26102;&#22120;&#21021;&#22987;&#21270;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81569692"></a>18.9.1. &#23450;&#26102;&#22120;&#21021;&#22987;&#21270;</h4></div></div></div>
&#22312;&#26368;&#39640;&#23618;&#30340;&#26495;&#32423;&#25277;&#35937;&#32467;&#26500;&#23553;&#35013;&#20013;&#30340;&#25104;&#21592;timer&#25351;&#21521;&#20102;&#21021;&#22987;&#21270;&#20869;&#26680;&#23450;&#26102;&#22120;&#30340;&#30456;&#20851;&#20989;&#25968;&#65292;&#23545;&#20110;S3C6410&#26469;&#35828;&#23601;&#26159;s3c64xx_timer&#20989;&#25968;&#12290;
<pre class="programlisting">
MACHINE_START(SMDK6410, "SMDK6410")
  ......	
	.timer		= &amp;s3c64xx_timer,
MACHINE_END
</pre>
timer&#23450;&#20041;&#20102;&#19968;&#20010;&#20840;&#23616;&#30340;&#31995;&#32479;&#28404;&#31572;&#26102;&#38047;(Tick Timer)&#65292;&#23545;&#20110;ARM&#26469;&#35828;&#65292;&#23427;&#34987;&#22768;&#26126;&#20026;struct sys_timer&#31867;&#22411;&#12290;
<pre class="programlisting">
struct sys_timer {
	struct sys_device	dev;
	void			(*init)(void);
	void			(*suspend)(void);
	void			(*resume)(void);
#ifndef CONFIG_GENERIC_TIME
	unsigned long		(*offset)(void);
#endif
};
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">init&#29992;&#20110;&#21021;&#22987;&#21270;&#20869;&#26680;jiffy&#26102;&#38047;&#28304;&#12290;&#23427;&#24517;&#39035;&#22312;&#20013;&#26029;&#23376;&#31995;&#32479;&#24050;&#21021;&#22987;&#21270;&#23436;&#27605;&#65292;&#20294;&#26159;&#20869;&#26680;&#20381;&#28982;&#31105;&#29992;&#20013;&#26029;&#26102;&#35843;&#29992;&#12290;</li><li class="listitem">suspend&#29992;&#20110;&#25346;&#36215;&#26102;&#38047;&#20013;&#26029;&#65292;&#36890;&#24120;&#22312;&#25152;&#26377;&#35774;&#22791;&#37117;&#20572;&#27490;&#24037;&#20316;&#21518;&#65292;&#22312;&#31105;&#20013;&#26029;&#20013;&#35843;&#29992;&#35813;&#20989;&#25968;&#65292;&#36890;&#24120;&#20026;NULL&#12290;</li><li class="listitem">resume&#29992;&#20110;&#24674;&#22797;&#25346;&#36215;&#30340;&#26102;&#38047;&#20013;&#26029;&#12290;</li><li class="listitem">offset&#36820;&#22238;&#19978;&#27425;&#20013;&#26029;&#21518;&#32463;&#36807;&#30340;&#26102;&#38388;&#65292;&#21333;&#20301;&#20026;&#24494;&#22937;&#12290;</li></ul></div>
<pre class="programlisting">
struct sys_timer s3c64xx_timer = {
	.init		= s3c64xx_timer_init,
	.offset		= s3c2410_gettimeoffset,
	.resume		= s3c64xx_timer_setup
};
</pre>
&#21021;&#22987;&#21270;&#20989;&#25968;&#26159;&#23545;s3c64xx_timer_setup&#30340;&#23553;&#35013;&#65292;&#21478;&#22806;&#23601;&#26159;&#23433;&#35013;&#20102;&#29992;&#20110;&#26356;&#26032;jiffy&#30340;IRQ_TIMER4&#20013;&#26029;&#20989;&#25968;s3c2410_timer_irq&#12290;
<pre class="programlisting">
static void __init s3c64xx_timer_init(void)
{
	s3c64xx_timer_setup();
	setup_irq(IRQ_TIMER4, &amp;s3c2410_timer_irq);
}
</pre>
&#22312;&#20013;&#26029;&#21021;&#22987;&#21270;&#20989;&#25968;s3c64xx_init_irq&#65292;&#23558;IRQ_TIMER4&#20013;&#26029;&#28304;&#35774;&#32622;&#20026;IRQ_TIMER4_VIC&#65292;&#22788;&#29702;&#20989;&#25968;s3c_irq_demux_timer4&#23436;&#25104;&#20102;&#36339;&#36716;&#12290;
<pre class="programlisting">
	set_irq_chained_handler(IRQ_TIMER4_VIC, s3c_irq_demux_timer4);
</pre>	
&#26368;&#32456;&#36890;&#36807;generic_handle_irq&#35843;&#29992;&#20013;&#26029;ISR&#22788;&#29702;&#20989;&#25968;&#12290;&#25152;&#20197;&#36825;&#37324;&#30340;IRQ_TIMER4&#23454;&#38469;&#19978;&#26159;&#20108;&#32423;&#20013;&#26029;&#21495;&#12290;
<pre class="programlisting">
static void s3c_irq_demux_timer(unsigned int base_irq, unsigned int sub_irq)
{
	generic_handle_irq(sub_irq);
}

static void s3c_irq_demux_timer4(unsigned int irq, struct irq_desc *desc)
{
	s3c_irq_demux_timer(irq, IRQ_TIMER4);
}	
</pre>
s3c64xx_timer_setup&#23436;&#25104;&#20102;PWM&#26102;&#38047;&#28304;&#30340;&#21021;&#22987;&#21270;&#24037;&#20316;&#65306;
<pre class="programlisting">
#define S3C2410_TCFG0	      S3C_TIMERREG(0x00)
#define S3C2410_TCFG1	      S3C_TIMERREG(0x04)
#define S3C2410_TCON	      S3C_TIMERREG(0x08)

static void s3c64xx_timer_setup (void)
{
......
	tcnt = TICK_MAX;  /* default value for tcnt */

	/* read the current timer configuration bits */

	tcon = __raw_readl(S3C2410_TCON);
	tcfg1 = __raw_readl(S3C2410_TCFG1);
	tcfg0 = __raw_readl(S3C2410_TCFG0);
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#39318;&#20808;&#35835;&#21462;PWM&#23450;&#26102;&#22120;&#30340;&#25511;&#21046;&#23492;&#23384;&#22120;TCON&#12290;</li><li class="listitem">&#35835;&#21462;&#37197;&#32622;&#23492;&#23384;&#22120;TCFG0&#21644;TCFG1&#12290;</li></ul></div>
<pre class="programlisting">
	/* configure the system for whichever machine is in use */
	if (use_tclk1_12()) {
......
	} else {
		unsigned long pclk;
		struct clk *clk;

		clk = clk_get(NULL, "timers");

		clk_enable(clk);
		pclk = clk_get_rate(clk);

		timer_usec_ticks = timer_mask_usec_ticks(6, pclk);

		tcfg1 &amp;= ~S3C2410_TCFG1_MUX4_MASK;
		tcfg1 |= S3C2410_TCFG1_MUX4_DIV1;

		tcfg0 &amp;= ~S3C2410_TCFG_PRESCALER1_MASK;
		tcfg0 |= (6) &lt;&lt; S3C2410_TCFG_PRESCALER1_SHIFT;

		tcnt = (pclk / 7) / HZ;
	}
</pre>
&#21482;&#26377;&#29305;&#23450;&#30340;&#31995;&#32479;&#25165;&#20250;&#28385;&#36275;use_tclk1_12&#65292;&#32780;&#36825;&#37324;&#23558;&#20250;&#36827;&#20837;else&#20998;&#25903;&#12290;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">clk_get&#36890;&#36807;PWM&#26102;&#38047;&#28304;timers&#33719;&#21462;&#23545;&#24212;&#30340;clk&#32467;&#26500;&#20307;&#12290;&#22312;&#26412;&#33410;&#30340;&#24320;&#22987;&#24050;&#32463;&#20171;&#32461;&#20102;&#35813;&#32467;&#26500;&#20307;&#30340;&#25104;&#21592;&#12290;</li><li class="listitem">clk_enable&#36890;&#36807;&#35843;&#29992;&#25104;&#21592;enable&#20989;&#25968;&#25351;&#38024;&#65292;&#20351;&#33021;&#26102;&#38047;&#28304;&#12290;&#26174;&#28982;&#36825;&#37324;&#23601;&#26159;s3c64xx_pclk_ctrl&#20989;&#25968;&#12290;</li><li class="listitem">clk_get_rate&#33719;&#21462;&#24403;&#21069;&#30340;PWM&#26102;&#38047;&#28304;&#30340;&#39057;&#29575;&#20540;&#12290;</li><li class="listitem">timer_mask_usec_ticks&#35745;&#31639;1&#24494;&#31186;&#21253;&#21547;&#30340;TICK&#25968;&#30446;&#23384;&#20837;timer_usec_ticks&#12290;timer_usec_ticks&#34987;&#29992;&#22312;timer_ticks_to_usec&#20989;&#25968;&#20013;&#65292;&#23454;&#29616;TICK&#25968;&#21521;&#24494;&#31186;&#30340;&#36716;&#25442;&#12290;</li></ul></div>
HZ&#26159;1&#31186;&#20869;&#21457;&#29983;&#30340;&#26102;&#38047;&#20013;&#26029;&#25968;&#65292;&#32780;TICK&#26159;HZ&#30340;&#20498;&#25968;&#65292;&#21363;&#26102;&#38047;&#20013;&#26029;&#30340;&#38388;&#38548;&#26102;&#38388;&#12290;
<pre class="programlisting">
#define S3C2410_TCFG1_MUX4_DIV1	  (0&lt;&lt;16)
#define S3C2410_TCFG1_MUX4_MASK	  (15&lt;&lt;16)

#define S3C2410_TCFG_PRESCALER1_MASK (255&lt;&lt;8)
#define S3C2410_TCFG_PRESCALER1_SHIFT (8)
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">tcfg1&#36890;&#36807;S3C2410_TCFG1_MUX4_MASK&#21644;S3C2410_TCFG1_MUX4_DIV1&#35774;&#32622;&#36873;&#25321;&#23450;&#26102;&#22120;4&#30340;MUX&#36755;&#20837;&#20026;0b0000&#65292;&#20063;&#21363;1/1&#20998;&#39057;&#12290;</li><li class="listitem">tcfg0&#36890;&#36807;S3C2410_TCFG_PRESCALER1_MASK&#21644;S3C2410_TCFG_PRESCALER1_SHIFT&#35774;&#32622;&#39044;&#20998;&#39057;&#22120;&#30340;&#20540;&#20026;6&#65292;&#26174;&#28982;&#23427;&#25511;&#21046;&#23450;&#26102;&#22120;2&#65292;3&#21644;4&#12290;</li><li class="listitem">&#26681;&#25454;HZ&#21644;pclk&#35745;&#31639;PWM&#30340;&#21608;&#26399;&#25968;&#12290;</li></ul></div>
<pre class="programlisting">
	tcnt--;
......
	__raw_writel(tcfg1, S3C2410_TCFG1);
	__raw_writel(tcfg0, S3C2410_TCFG0);

	timer_startval = tcnt;
	__raw_writel(tcnt, S3C2410_TCNTB(4));
	
	tcon &amp;= ~(7&lt;&lt;20);
	tcon |= S3C2410_TCON_T4RELOAD;
	tcon |= S3C2410_TCON_T4MANUALUPD;

	__raw_writel(tcon, S3C2410_TCON);
	__raw_writel(tcnt, S3C2410_TCNTB(4));
	__raw_writel(tcnt, S3C2410_TCMPB(4));
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#30001;&#20110;&#33258;&#21160;&#35013;&#36733;&#26102;&#65292;&#35745;&#25968;&#22120;&#21487;&#20197;&#25216;&#26415;&#21040;0&#65292;&#25152;&#20197;&#36825;&#37324;&#30340;tcnt&#20877;&#20943;1&#12290;</li><li class="listitem">&#20889;&#22238;&#37197;&#32622;&#20449;&#24687;&#21040;&#23545;&#24212;&#30340;&#23492;&#23384;&#22120;&#12290;</li></ul></div>
<pre class="programlisting">
	/* start the timer running */
	tcon |= S3C2410_TCON_T4START;
	tcon &amp;= ~S3C2410_TCON_T4MANUALUPD;
	__raw_writel(tcon, S3C2410_TCON);

	/* Timer interrupt Enable */
	__raw_writel(__raw_readl(S3C64XX_TINT_CSTAT) | S3C_TINT_CSTAT_T4INTEN , S3C64XX_TINT_CSTAT);
</pre>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#20351;&#33021;PWM&#26102;&#38047;4&#12290;</li><li class="listitem">&#36890;&#36807;CSTAT&#23492;&#23384;&#22120;&#20351;&#33021;&#26102;&#38047;&#20013;&#26029;&#12290;</li></ul></div>
&#27880;&#24847;&#65292;&#27492;&#26102;PWM&#26102;&#38047;4&#24050;&#24320;&#22987;&#21521;&#20013;&#26029;&#25511;&#21046;&#22120;&#25552;&#20132;&#20013;&#26029;&#20449;&#21495;&#65292;&#20013;&#26029;&#25511;&#21046;&#22120;&#20063;&#24050;&#34987;&#21021;&#22987;&#21270;&#65292;&#20294;&#26159;&#27492;&#26102;&#26159;&#31105;&#20013;&#26029;&#30340;&#12290;
</div>
<div class="sect3" title="18.9.2. &#23433;&#35013;&#26102;&#38047;&#20013;&#26029;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81569820"></a>18.9.2. &#23433;&#35013;&#26102;&#38047;&#20013;&#26029;</h4></div></div></div>
&#26102;&#38047;&#20013;&#26029;&#30340;&#22788;&#29702;&#32467;&#26500;irqaction&#20026;s3c2410_timer_irq&#12290;
<pre class="programlisting">
setup_irq(IRQ_TIMER4, &amp;s3c2410_timer_irq);
</pre>
&#36825;&#37324;&#30340;&#22788;&#29702;&#20989;&#25968;&#26159;s3c2410_timer_interrupt&#12290;
<pre class="programlisting">
static struct irqaction s3c2410_timer_irq = {
	.name		= "S3C2410 Timer Tick",
	.flags		= IRQF_DISABLED | IRQF_TIMER | IRQF_IRQPOLL,
	.handler	= s3c2410_timer_interrupt,
};
</pre>
&#35813;&#20989;&#25968;&#26159;&#23545;timer_tick&#30340;&#23553;&#35013;&#65292;
<pre class="programlisting">
static irqreturn_t s3c2410_timer_interrupt(int irq, void *dev_id)
{
	timer_tick();
	return IRQ_HANDLED;
}
</pre>
timer_tick&#26159;&#19968;&#20010;&#38750;&#24120;&#22797;&#26434;&#30340;&#20989;&#25968;&#65292;&#20854;&#20013;&#21253;&#25324;&#26356;&#26032;jiffies&#65292;&#26816;&#27979;&#23450;&#26102;&#22120;&#31561;&#19968;&#20123;&#21015;&#21160;&#20316;&#12290;
</div>
<div class="sect3" title="18.9.3. &#23433;&#35013;&#26102;&#38047;&#20013;&#26029;"><div class="titlepage"><div><div><h4 class="title"><a name="idp81586044"></a>18.9.3. &#23433;&#35013;&#26102;&#38047;&#20013;&#26029;</h4></div></div></div>
&#23613;&#31649;&#26495;&#32423;&#20195;&#30721;&#25552;&#20379;&#20102;timer&#25104;&#21592;&#65292;&#37027;&#20040;&#23427;&#26159;&#20309;&#26102;&#34987;&#24341;&#29992;&#30340;&#21602;&#65311;&#22312;&#20869;&#26680;&#31532;&#19968;&#20010;&#21021;&#22987;&#21270;&#20989;&#25968;start_kernel&#20013;&#35843;&#29992;&#20102;time_init&#65306;
<pre class="programlisting">
arch/arm/kernel/time.c
struct sys_timer *system_timer;
void __init time_init(void)
{
#ifndef CONFIG_GENERIC_TIME
	if (system_timer-&gt;offset == NULL)
		system_timer-&gt;offset = dummy_gettimeoffset;
#endif
	system_timer-&gt;init();
}
</pre>
system_timer&#34987;&#23450;&#20041;&#25104;&#20102;&#20840;&#23616;&#21464;&#37327;&#65292;&#23427;&#26159;&#20309;&#26102;&#34987;&#36171;&#20540;&#30340;&#21602;&#65311;&#22312;&#26550;&#26500;&#29420;&#31435;&#30340;&#24635;&#20989;&#25968;setup_arch&#26102;&#65292;&#23427;&#34987;&#36171;&#20540;&#65306;
<pre class="programlisting">
  init_arch_irq = mdesc-&gt;init_irq;
  system_timer = mdesc-&gt;timer;
  init_machine = mdesc-&gt;init_machine;
</pre>
&#26174;&#28982;&#36825;&#37324;system_timer&#35843;&#29992;&#30340;init&#23601;&#26159;s3c64xx_timer_setup&#12290;time_init&#30340;&#35843;&#29992;&#26202;&#20110;init_IRQ&#65292;&#36825;&#26159;&#24517;&#39035;&#30340;&#65292;&#25152;&#26377;&#38656;&#35201;&#20013;&#26029;&#23376;&#31995;&#32479;&#30340;&#20854;&#20182;&#23376;&#31995;&#32479;&#37117;&#38656;&#35201;&#28385;&#36275;&#36825;&#20010;&#35201;&#27714;&#12290;
</div>
</div>
<div class="sect2" title="18.10. &#26102;&#38047;&#20013;&#26029;&#22788;&#29702;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81587956"></a>18.10. &#26102;&#38047;&#20013;&#26029;&#22788;&#29702;</h3></div></div></div>
<pre class="programlisting">
void timer_tick(void)
{
	profile_tick(CPU_PROFILING);
	do_leds();
	do_set_rtc();
	write_seqlock(&amp;xtime_lock);
	do_timer(1);
	write_sequnlock(&amp;xtime_lock);
#ifndef CONFIG_SMP
	update_process_times(user_mode(get_irq_regs()));
#endif
}
</pre>
timer_tick&#26159;&#20869;&#26680;&#26102;&#38388;&#20013;&#26029;&#22788;&#29702;&#30340;&#26680;&#24515;&#20989;&#25968;&#65292;&#23427;&#23436;&#25104;&#20102;&#20197;&#19979;&#37325;&#35201;&#21151;&#33021;&#65306;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">profile_tick&#36890;&#24120;&#20026;&#31354;&#20989;&#25968;&#65292;&#21482;&#26377;&#23450;&#20041;&#20102;CONFIG_PROFILING&#25165;&#26377;&#25928;&#12290;&#23427;&#20026;&#20869;&#26680;&#20195;&#30721;&#30417;&#31649;&#22120;&#37319;&#38598;&#25968;&#25454;&#12290;&#30417;&#31649;&#26399;&#30830;&#23450;&#20869;&#26680;&#30340;&#8220;&#28909;&#28857;&#8221;&#8212;&#8212;&#25191;&#34892;&#39057;&#29575;&#26368;&#39057;&#32321;&#30340;&#20869;&#26680;&#20195;&#30721;&#29255;&#27573;&#65292;&#20197;&#24471;&#21040;&#20248;&#21270;&#20195;&#30721;&#30340;&#26041;&#21521;&#21644;&#37325;&#28857;&#12290;</li><li class="listitem">do_leds &#29992;&#26469;&#27599;&#38548;HZ/2&#20010;&#26102;&#38047;&#20013;&#26029;&#21608;&#26399;&#21518;&#65292;&#28857;&#20142;&#25351;&#31034;&#26102;&#38388;&#27963;&#21160;&#30340;LED&#28783;&#65292;&#21482;&#26377;&#23450;&#20041;&#20102;CONFIG_LEDS_TIMER&#25165;&#26377;&#25928;&#12290;</li><li class="listitem">do_set_rtc &#29992;&#26469;&#27599;&#38548;11&#20998;&#38047;&#26356;&#26032;rtc&#30340;&#26102;&#38388;&#65292;&#21482;&#26377;&#25552;&#20379;&#20102;set_rtc&#30340;&#38057;&#23376;&#20989;&#25968;&#65292;&#25165;&#20250;&#26356;&#26032;&#12290;</li><li class="listitem">write_seqlock&#21644;write_sequnlock&#29992;&#26469;&#38145;&#23450;xtime_lock&#65292;&#20197;&#20445;&#35777;&#23545;&#26102;&#38388;&#26356;&#26032;&#30340;&#20114;&#26021;&#25191;&#34892;&#12290;</li><li class="listitem">do_timer&#36127;&#36131;&#20840;&#31995;&#32479;&#33539;&#22260;&#30340;&#65292;&#20840;&#23616;&#24615;&#30340;&#20219;&#21153;&#65306;&#26356;&#26032;jiffies&#30340;&#20540;&#65292;&#22788;&#29702;&#36827;&#31243;&#32479;&#35745;&#12290;&#22312;SMP&#19978;&#65292;&#36890;&#24120;&#20250;&#36873;&#25321;&#19968;&#20010;&#29305;&#23450;&#30340;CPU&#26469;&#25191;&#34892;&#36825;&#20004;&#20010;&#20219;&#21153;&#65292;&#32780;&#19981;&#28041;&#21450;&#20854;&#20182;CPU&#12290;</li><li class="listitem">update_process_times&#21482;&#22312;SMP&#20851;&#38381;&#26102;&#26377;&#25928;&#12290;&#38500;&#20102;&#36827;&#31243;&#32479;&#35745;&#20043;&#22806;&#65292;&#23427;&#36824;&#28608;&#27963;&#20102;&#25152;&#26377;&#27880;&#20876;&#30340;&#20302;&#20998;&#36776;&#29575;&#23450;&#26102;&#22120;&#24182;&#20351;&#20043;&#21040;&#26399;&#65292;&#20197;&#35302;&#21457;&#35843;&#24230;&#12290;</li></ul></div>
&#36825;&#37324;&#19981;&#23545;update_process_times&#36827;&#34892;&#28145;&#20837;&#30340;&#25506;&#35752;&#65292;&#20294;&#26159;&#27880;&#24847;&#21040;scheduler_tick&#20989;&#25968;&#65292;schedule_tick&#20989;&#25968;&#29992;&#26469;&#26356;&#26032;&#36827;&#31243;&#30340;&#26102;&#38388;&#29255;&#65292;&#23427;&#22312;&#26412;&#22320;&#20013;&#26029;&#34987;&#31105;&#27490;&#26102;&#35843;&#29992;&#12290;
<pre class="programlisting">
void update_process_times(int user_tick)
{
	struct task_struct *p = current;
	int cpu = smp_processor_id();

	/* Note: this timer irq context must be accounted for as well. */
	account_process_tick(p, user_tick);
	run_local_timers();
	if (rcu_pending(cpu))
		rcu_check_callbacks(cpu, user_tick);
	printk_tick();
	scheduler_tick();
	run_posix_cpu_timers(p);
}
</pre>
&#27599;&#27425;&#26102;&#38047;&#33410;&#25293;&#21040;&#26469;&#26102;&#65292;schedule_tick&#37117;&#34987;&#35843;&#29992;&#20197;&#25191;&#34892;&#21508;&#20010;&#36827;&#31243;&#30340;&#35843;&#24230;&#30456;&#20851;&#30340;&#32479;&#35745;&#37327;&#20197;&#21450;&#28608;&#27963;&#35843;&#24230;&#30456;&#20851;&#30340;&#25805;&#20316;&#30340;&#12290;&#23427;&#25191;&#34892;&#30340;&#20027;&#35201;&#27493;&#39588;&#22914;&#19979;&#65306;
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">&#39318;&#20808;&#36890;&#36807;&#30456;&#24212;&#30340;&#20989;&#25968;&#21644;&#23439;&#33719;&#24471;&#24403;&#21069;&#22788;&#29702;&#22120;&#30340;&#32534;&#21495;&#12289;&#24403;&#21069;&#21487;&#36816;&#34892;&#38431;&#21015;&#21644;&#24403;&#21069;&#36827;&#31243;&#25551;&#36848;&#31526;&#12290;</li><li class="listitem">sched_clock_tick&#25226;&#36716;&#25442;&#20026;&#32435;&#31186;&#30340;TSC&#30340;&#24403;&#21069;&#20540;&#23384;&#20837;&#26412;&#22320;&#36816;&#34892;&#38431;&#21015;&#30340;timestamp_lask_tick&#23383;&#27573;&#12290;&#36825;&#20010;&#26102;&#38388;&#25139;&#26159;&#20174;sched_clock&#33719;&#24471;&#30340;&#12290;</li><li class="listitem">&#30001;&#20110;&#23454;&#26102;&#36827;&#31243;&#21644;&#26222;&#36890;&#36827;&#31243;&#30340;&#35843;&#24230;&#26041;&#27861;&#19981;&#21516;&#65292;&#22240;&#27492;&#36825;&#20004;&#31181;&#36827;&#31243;&#23545;&#26102;&#38388;&#29255;&#30340;&#26356;&#26032;&#26041;&#24335;&#20063;&#26377;&#25152;&#19981;&#21516;&#65292;&#19979;&#38754;&#20165;&#35828;&#26126;&#26222;&#36890;&#36827;&#31243;&#26356;&#26032;&#26102;&#38388;&#29255;&#30340;&#26041;&#24335;&#12290;&#22914;&#26524;&#24403;&#21069;&#36827;&#31243;&#26159;&#26222;&#36890;&#36827;&#31243;&#65292;&#21017;&#36882;&#20943;&#24403;&#21069;&#36827;&#31243;&#30340;&#26102;&#38388;&#29255;&#12290;</li><li class="listitem">&#22914;&#26524;&#24403;&#21069;&#36827;&#31243;&#26102;&#38388;&#29255;&#29992;&#23436;&#65292;&#39318;&#20808;&#20174;&#24403;&#21069;&#27963;&#21160;&#36827;&#31243;&#38598;&#21512;&#20013;&#21024;&#38500;&#35813;&#36827;&#31243;&#65292;&#28982;&#21518;&#36890;&#36807;set_tsk_need_resched&#20989;&#25968;&#35774;&#32622;TIF_NEED_RESCHED&#26631;&#24535;&#12290;</li><li class="listitem"></ul></div>
<pre class="programlisting">
void scheduler_tick(void)
{
	int cpu = smp_processor_id();
	struct rq *rq = cpu_rq(cpu);
	struct task_struct *curr = rq-&gt;curr;

	sched_clock_tick();

	spin_lock(&amp;rq-&gt;lock);
	update_rq_clock(rq);
	update_cpu_load(rq);
	curr-&gt;sched_class-&gt;task_tick(rq, curr, 0);
	spin_unlock(&amp;rq-&gt;lock);

#ifdef CONFIG_SMP
	rq-&gt;idle_at_tick = idle_cpu(cpu);
	trigger_load_balance(rq, cpu);
#endif
}
</pre>
&#21478;&#22806;&#27880;&#24847;&#21040;run_local_timers&#21796;&#37266;&#26102;&#38047;&#36719;&#20013;&#26029;&#65306;
<pre class="programlisting">
void run_local_timers(void)
{
	hrtimer_run_queues();
	raise_softirq(TIMER_SOFTIRQ);
	softlockup_tick();
}
</pre>
<div class="figure"><a name="idp81595740"></a><p class="title"><b>&#22270; 113. &#26102;&#38047;&#20013;&#26029;&#22788;&#29702;&#27969;&#31243;&#22270;</b></p><div class="figure-contents"><div><img src="images/time_tick.gif" alt="&#26102;&#38047;&#20013;&#26029;&#22788;&#29702;&#27969;&#31243;&#22270;"></div></div></div><br class="figure-break">
<div class="sect3" title="18.10.1. do_timer"><div class="titlepage"><div><div><h4 class="title"><a name="idp81596220"></a>18.10.1. do_timer</h4></div></div></div>
do_timer&#39318;&#20808;&#26356;&#26032;jiffies_64&#30340;&#20540;&#65292;&#26174;&#28982;&#36825;&#37324;&#30340;&#25805;&#20316;&#37117;&#22312;&#38145;&#23450;xtime_lock&#20013;&#23436;&#25104;&#12290;
<pre class="programlisting">
kernel/timer.c
void do_timer(unsigned long ticks)
{
	jiffies_64 += ticks;
	update_times(ticks);
}
</pre>
update_times&#23436;&#25104;&#20854;&#20313;&#27599;&#20010;&#26102;&#38047;&#20013;&#26029;&#24517;&#39035;&#23436;&#25104;&#30340;&#25805;&#20316;&#12290;&#23427;&#26356;&#26032;&#22681;&#19978;&#26102;&#38047;(Wall Clock)&#65292;&#23427;&#25351;&#23450;&#20102;&#31995;&#32479;&#24050;&#32463;&#21551;&#21160;&#24182;&#36816;&#34892;&#20102;&#22810;&#38271;&#26102;&#38388;&#12290;&#35813;&#20449;&#24687;&#20063;&#26159;&#30001;jiffies&#25552;&#20379;&#30340;&#65292;Wall Clock &#20174;&#24403;&#21069;&#26102;&#38388;&#28304;&#35835;&#21462;&#26102;&#38388;&#65292;&#24182;&#25454;&#27492;&#26356;&#26032;&#22681;&#19978;&#26102;&#38047;&#12290;&#19982;jiffies&#26426;&#21046;&#30456;&#21453;&#65292;&#23427;&#20351;&#29992;&#20102;&#20154;&#31867;&#21487;&#35835;&#26684;&#24335;&#32435;&#31186;&#21333;&#20301;&#26469;&#34920;&#31034;&#24403;&#21069;&#26102;&#38388;&#12290;
<pre class="programlisting">
static inline void update_times(unsigned long ticks)
{
	update_wall_time();
	calc_load(ticks);
}
</pre>
calc_load&#26356;&#26032;&#31995;&#32479;&#36127;&#36733;&#32479;&#35745;&#65292;&#30830;&#23450;&#22312;&#21069;1&#20998;&#38047;&#65292;5&#20998;&#38047;&#21644;15&#20998;&#38047;&#20869;&#65292;&#24179;&#22343;&#26377;&#22810;&#23569;&#20010;&#23601;&#32490;&#29366;&#24577;&#30340;&#36827;&#31243;&#22312;&#23601;&#32490;&#38431;&#21015;&#19978;&#31561;&#24453;&#65292;&#35813;&#29366;&#24577;&#21487;&#20197;&#36890;&#36807;w&#21629;&#20196;&#33719;&#21462;&#12290;<br>
&#24635;&#20043;xtime&#26159;timespec&#32467;&#26500;&#65292;&#29992;&#26469;&#21521;&#29992;&#25143;&#31354;&#38388;&#25552;&#20379;&#26102;&#38388;&#25903;&#25345;&#65292;clock&#21017;&#26159;&#20869;&#26680;&#30340;&#26102;&#38047;&#28304;&#65292;&#23427;&#35760;&#24405;&#38750;&#24120;&#35814;&#32454;&#30340;&#26102;&#38047;&#25968;&#25454;&#12290;
</div>
</div>
<div class="sect2" title="18.11. RTC&#26102;&#38047;"><div class="titlepage"><div><div><h3 class="title"><a name="idp81598628"></a>18.11. RTC&#26102;&#38047;</h3></div></div></div>
<p>
RTC(Real Time Clock)&#26159;&#23454;&#26102;&#26102;&#38047;&#65292;&#23427;&#36890;&#24120;&#29420;&#31435;&#20110;CPU&#21644;&#20854;&#20182;&#25152;&#26377;&#33455;&#29255;&#65292;&#21363;&#20351;&#24403;&#26495;&#21345;&#34987;&#20999;&#26029;&#30005;&#28304;&#65292;&#23427;&#20381;&#28982;&#21487;&#20197;&#20381;&#38752;&#26495;&#36733;&#30340;&#32445;&#25187;&#30005;&#27744;&#32487;&#32493;&#24037;&#20316;&#12290;&#22312;PC&#19978;&#65292;CMOS RAM&#21644;RTC&#34987;&#38598;&#25104;&#22312;&#19968;&#20010;&#33455;&#29255;&#65292;&#34987;&#31216;&#20026;BIOS&#12290;</p>
<p>
&#23545;&#20110;&#23884;&#20837;&#24335;SOC CPU&#26469;&#35828;&#65292;RTC&#30005;&#36335;&#21487;&#33021;&#34987;&#38598;&#25104;&#21040;CPU&#20869;&#37096;&#65292;&#27492;&#26102;CPU&#23558;&#25552;&#20379;RTC&#30005;&#28304;&#21644;RTC&#20351;&#29992;&#30340;&#22806;&#37096;&#26230;&#25391;&#30340;&#25509;&#20837;&#24341;&#33050;&#12290;&#30001;&#20110;&#23427;&#26159;&#19968;&#20010;&#23436;&#20840;&#29420;&#31435;&#30340;&#35774;&#22791;&#65292;&#25152;&#20197;&#23427;&#30340;&#39537;&#21160;&#20063;&#30456;&#23545;&#29420;&#31435;&#65292;&#36890;&#24120;&#34987;&#25918;&#22312;drivers/rtc&#19979;&#65292;&#27604;&#22914;rtc-s3c.c&#12290;
</p>
<p>
RTC&#24635;&#26159;&#35760;&#24405;&#22806;&#37096;&#19990;&#30028;&#30340;&#26102;&#38388;&#20540;&#65292;&#24182;&#19981;&#20572;&#30340;&#20381;&#38752;&#22806;&#37096;&#26230;&#25391;&#21644;&#30005;&#28304;&#26356;&#26032;&#26102;&#38388;&#12290;Linux&#21482;&#29992;RTC&#26469;&#33719;&#21462;&#22806;&#37096;&#19990;&#30028;&#30340;&#26102;&#38388;&#20197;&#25110;&#24471;&#19982;&#22806;&#30028;&#30340;&#26102;&#38388;&#21516;&#27493;&#12290;&#19968;&#20010;&#21517;&#20026;hwclock&#30340;&#31243;&#24207;&#21487;&#20197;&#36890;&#36807;/dev/rtc&#26469;&#33719;&#21462;&#25110;&#32773;&#35774;&#32622;RTC&#30340;&#26102;&#38388;&#12290;
</p>
<p>
&#20869;&#26680;&#22312;&#21021;&#22987;&#21270;xtime&#26102;&#21487;&#20197;&#23581;&#35797;&#20174;rtc&#35774;&#22791;(&#22914;&#26524;&#27880;&#20876;&#30340;&#35805;)&#26356;&#26032;&#26102;&#38388;&#65292;&#20063;&#21487;&#20197;&#36890;&#36807;NTP&#33719;&#21462;&#26102;&#38388;&#21518;&#21608;&#26399;&#30340;&#26356;&#26032;RTC&#20197;&#23454;&#29616;&#21516;&#27493;&#12290;&#22810;&#25968;&#26102;&#38388;&#20869;&#26680;&#26102;&#38388;&#37117;&#26159;&#19982;RTC&#29420;&#31435;&#30340;&#65292;&#24182;&#19981;&#30456;&#20114;&#21516;&#27493;&#21644;&#35775;&#38382;&#12290;date&#21629;&#20196;&#24182;&#19981;&#20174;RTC&#33719;&#21462;&#26102;&#38388;&#65292;&#23427;&#33719;&#21462;&#30340;&#26159;&#20869;&#26680;xtime&#26102;&#38388;&#65292;&#21516;&#26679;&#23427;&#35774;&#32622;&#30340;&#20063;&#26159;&#20869;&#26680;xtime&#26102;&#38388;&#65292;&#32780;&#38750;RTC&#12290;
</p>
<p>
RTC&#39537;&#21160;&#30340;&#26680;&#24515;&#25991;&#20214;&#22914;&#19979;&#65292;&#20854;&#20013;&#19982;RTC&#33455;&#29255;&#30456;&#20851;&#30340;&#25991;&#20214;&#26159;rtc-s3c.c&#12290;&#31995;&#32479;&#20013;&#38598;&#25104;&#20102;&#30456;&#24403;&#22810;&#30340;RTC&#33455;&#29255;&#39537;&#21160;&#12290;
</p><pre class="programlisting">
-rw-r--r-- 1 root root  73688 2011-12-21 13:49 class.c
-rw-r--r-- 1 root root  66176 2011-12-21 13:49 hctosys.c
-rw-r--r-- 1 root root  80332 2011-12-21 13:49 interface.c
-rw-r--r-- 1 root root 373448 2011-12-21 13:49 rtc-core.c
-rw-r--r-- 1 root root  82712 2011-12-21 13:49 rtc-dev.c
-rw-r--r-- 1 root root  63352 2011-12-21 13:49 rtc-lib.c
-rw-r--r-- 1 root root  70880 2011-12-21 13:49 rtc-proc.c
-rw-r--r-- 1 root root  84844 2011-12-21 16:56 rtc-s3c.c
-rw-r--r-- 1 root root  74140 2011-12-21 13:49 rtc-sysfs.c
</pre><p>
</p>
</div>
</div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s17.html">&#19978;&#19968;&#39029;</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s19.html">&#19979;&#19968;&#39029;</a></td></tr><tr><td width="40%" align="left" valign="top">17. &#20869;&#26680;&#21442;&#25968;&#35299;&#26512; </td><td width="20%" align="center"><a accesskey="h" href="index.html">&#36215;&#22987;&#39029;</a></td><td width="40%" align="right" valign="top"> 19. &#20869;&#26680;&#36890;&#30693;&#38142;</td></tr></table></div></body></html>
